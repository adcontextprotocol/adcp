{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "/schemas/media-buy/get-media-buy-delivery-request.json",
  "title": "Get Media Buy Delivery Request",
  "description": "Request parameters for retrieving comprehensive delivery metrics",
  "type": "object",
  "properties": {
    "account": {
      "$ref": "/schemas/core/account-ref.json",
      "description": "Filter delivery data to a specific account. When omitted, returns data across all accessible accounts."
    },
    "media_buy_ids": {
      "type": "array",
      "description": "Array of publisher media buy IDs to get delivery data for",
      "items": {
        "type": "string"
      },
      "minItems": 1
    },
    "buyer_refs": {
      "type": "array",
      "description": "Array of buyer reference IDs to get delivery data for",
      "items": {
        "type": "string"
      },
      "minItems": 1
    },
    "status_filter": {
      "oneOf": [
        {
          "$ref": "/schemas/enums/media-buy-status.json"
        },
        {
          "type": "array",
          "items": {
            "$ref": "/schemas/enums/media-buy-status.json"
          },
          "minItems": 1
        }
      ],
      "description": "Filter by status. Can be a single status or array of statuses"
    },
    "start_date": {
      "type": "string",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}$",
      "description": "Start date for reporting period (YYYY-MM-DD). When omitted along with end_date, returns campaign lifetime data. Only accepted when the product's reporting_capabilities.date_range_support is 'date_range'."
    },
    "end_date": {
      "type": "string",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}$",
      "description": "End date for reporting period (YYYY-MM-DD). When omitted along with start_date, returns campaign lifetime data. Only accepted when the product's reporting_capabilities.date_range_support is 'date_range'."
    },
    "reporting_dimensions": {
      "type": "object",
      "description": "Request dimensional breakdowns in delivery reporting. Each key enables a specific breakdown dimension within by_package. Omit entirely for no dimensional breakdowns (backward compatible). Unsupported dimensions are silently omitted from the response.",
      "properties": {
        "geo": {
          "type": "object",
          "description": "Request geographic breakdown. Check reporting_capabilities.supports_geo_breakdown for available levels and systems.",
          "properties": {
            "geo_level": {
              "$ref": "/schemas/enums/geo-level.json",
              "description": "Geographic granularity level for the breakdown"
            },
            "system": {
              "type": "string",
              "description": "Classification system for metro or postal_area levels (e.g., 'nielsen_dma', 'us_zip'). Required when geo_level is 'metro' or 'postal_area'."
            },
            "limit": {
              "type": "integer",
              "minimum": 1,
              "description": "Maximum number of geo entries to return. When truncated, by_geo_truncated is true in the response."
            },
            "sort_by": {
              "type": "string",
              "description": "Any numeric field name from delivery-metrics (e.g., 'impressions', 'spend', 'clicks', 'roas', 'conversions'). Falls back to 'spend' if the requested metric is unavailable.",
              "default": "spend"
            }
          },
          "required": ["geo_level"],
          "if": {
            "properties": { "geo_level": { "enum": ["metro", "postal_area"] } }
          },
          "then": {
            "required": ["geo_level", "system"]
          },
          "additionalProperties": true
        },
        "device_type": {
          "type": "object",
          "description": "Request device type breakdown.",
          "properties": {
            "limit": {
              "type": "integer",
              "minimum": 1,
              "description": "Maximum number of entries to return"
            },
            "sort_by": {
              "type": "string",
              "description": "Any numeric field name from delivery-metrics (e.g., 'impressions', 'spend', 'clicks', 'roas', 'conversions'). Falls back to 'spend' if unavailable.",
              "default": "spend"
            }
          },
          "additionalProperties": true
        },
        "device_platform": {
          "type": "object",
          "description": "Request device platform breakdown.",
          "properties": {
            "limit": {
              "type": "integer",
              "minimum": 1,
              "description": "Maximum number of entries to return"
            },
            "sort_by": {
              "type": "string",
              "description": "Any numeric field name from delivery-metrics (e.g., 'impressions', 'spend', 'clicks', 'roas', 'conversions'). Falls back to 'spend' if unavailable.",
              "default": "spend"
            }
          },
          "additionalProperties": true
        },
        "audience": {
          "type": "object",
          "description": "Request audience segment breakdown.",
          "properties": {
            "limit": {
              "type": "integer",
              "minimum": 1,
              "description": "Maximum number of entries to return"
            },
            "sort_by": {
              "type": "string",
              "description": "Any numeric field name from delivery-metrics (e.g., 'impressions', 'spend', 'clicks', 'roas', 'conversions'). Falls back to 'spend' if unavailable.",
              "default": "spend"
            }
          },
          "additionalProperties": true
        },
        "placement": {
          "type": "object",
          "description": "Request placement breakdown.",
          "properties": {
            "limit": {
              "type": "integer",
              "minimum": 1,
              "description": "Maximum number of entries to return"
            },
            "sort_by": {
              "type": "string",
              "description": "Any numeric field name from delivery-metrics (e.g., 'impressions', 'spend', 'clicks', 'roas', 'conversions'). Falls back to 'spend' if unavailable.",
              "default": "spend"
            }
          },
          "additionalProperties": true
        }
      },
      "additionalProperties": true
    },
    "context": {
      "$ref": "/schemas/core/context.json"
    },
    "ext": {
      "$ref": "/schemas/core/ext.json"
    }
  },
  "additionalProperties": true
}
