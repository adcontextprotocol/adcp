{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "/schemas/core/frequency-cap.json",
  "title": "Frequency Cap",
  "description": "Frequency capping settings for package-level application. Two types of frequency control can be used independently or together: suppress enforces a cooldown between consecutive exposures; max_impressions + per + window caps total exposures per entity in a time window. When both suppress and max_impressions are set, an impression is delivered only if both constraints permit it (AND semantics). At least one of suppress, suppress_minutes, or max_impressions must be set.",
  "type": "object",
  "properties": {
    "suppress": {
      "allOf": [{ "$ref": "/schemas/core/duration.json" }],
      "description": "Cooldown period between consecutive exposures to the same entity. Prevents back-to-back ad delivery (e.g. {\"interval\": 60, \"unit\": \"minutes\"} for a 1-hour cooldown). Preferred over suppress_minutes."
    },
    "suppress_minutes": {
      "type": "number",
      "description": "Deprecated â€” use suppress instead. Cooldown period in minutes between consecutive exposures to the same entity (e.g. 60 for a 1-hour cooldown).",
      "minimum": 0
    },
    "max_impressions": {
      "type": "integer",
      "description": "Maximum number of impressions per entity per window. For duration windows, implementations typically use a rolling window; 'campaign' applies a fixed cap across the full flight.",
      "minimum": 1
    },
    "per": {
      "allOf": [{ "$ref": "/schemas/enums/reach-unit.json" }],
      "description": "Entity granularity for impression counting. Required when max_impressions is set."
    },
    "window": {
      "allOf": [{ "$ref": "/schemas/core/duration.json" }],
      "description": "Time window for the max_impressions cap (e.g. {\"interval\": 7, \"unit\": \"days\"} or {\"interval\": 1, \"unit\": \"campaign\"} for the full flight). Required when max_impressions is set."
    }
  },
  "anyOf": [
    { "required": ["suppress"] },
    { "required": ["suppress_minutes"] },
    { "required": ["max_impressions"] }
  ],
  "dependencies": {
    "max_impressions": ["per", "window"],
    "per": ["max_impressions"],
    "window": ["max_impressions"]
  },
  "additionalProperties": true
}
