{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "/schemas/core/webhook-payload.json",
  "title": "Webhook Payload",
  "description": "Payload structure sent to webhook endpoints when async task status changes. Fully adopts A2A Protocol's push notification payload structure (A2A Specification Section 4.3.3). The payload is a StreamResponse object containing exactly one of: task (Task object), message (Message object), statusUpdate (TaskStatusUpdateEvent), or artifactUpdate (TaskArtifactUpdateEvent). ADCP declares only the structure of parts.data (DataPart data field) within Message objects for task-specific payloads.",
  "type": "object",
  "oneOf": [
    {
      "type": "object",
      "properties": {
        "task": {
          "allOf": [
            {
              "$ref": "/schemas/core/a2a-task.json"
            },
            {
              "type": "object",
              "properties": {
                "status": {
                  "allOf": [
                    {
                      "$ref": "/schemas/core/a2a-task-status.json"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "message": {
                          "allOf": [
                            {
                              "$ref": "/schemas/core/a2a-message.json"
                            },
                            {
                              "type": "object",
                              "properties": {
                                "parts": {
                                  "type": "array",
                                  "description": "Parts is the container of the message content. Array of ADCP Part union type with task-specific validation for parts[].data.",
                                  "items": {
                                    "$ref": "/schemas/core/adcp-webhook-part.json"
                                  },
                                  "minItems": 1
                                }
                              }
                            }
                          ]
                        }
                      }
                    }
                  ]
                },
                "history": {
                  "type": "array",
                  "description": "The history of interactions from a task (using ADCP Message with task-specific validation).",
                  "items": {
                    "allOf": [
                      {
                        "$ref": "/schemas/core/a2a-message.json"
                      },
                      {
                        "type": "object",
                        "properties": {
                          "parts": {
                            "type": "array",
                            "description": "Parts is the container of the message content. Array of ADCP Part union type with task-specific validation for parts[].data.",
                            "items": {
                              "$ref": "/schemas/core/adcp-part.json"
                            },
                            "minItems": 1
                          }
                        }
                      }
                    ]
                  }
                }
              }
            }
          ],
          "description": "A Task object containing the current state of the task (A2A Specification Section 4.1.1). Uses ADCP extension with task-specific validation for parts[].data."
        }
      },
      "required": ["task"],
      "additionalProperties": false
    },
    {
      "type": "object",
      "properties": {
        "message": {
          "allOf": [
            {
              "$ref": "/schemas/core/a2a-message.json"
            },
            {
              "type": "object",
              "properties": {
                "parts": {
                  "type": "array",
                  "description": "Parts is the container of the message content. Array of ADCP Part union type with task-specific validation for parts[].data.",
                  "items": {
                    "$ref": "/schemas/core/adcp-part.json"
                  },
                  "minItems": 1
                }
              }
            }
          ],
          "description": "A Message object containing a message response (A2A Specification Section 4.1.4). Uses ADCP extension with task-specific validation for parts[].data (DataPart data field)."
        }
      },
      "required": ["message"],
      "additionalProperties": false
    },
    {
      "type": "object",
      "properties": {
        "statusUpdate": {
          "allOf": [
            {
              "$ref": "/schemas/core/a2a-task-status-update-event.json"
            },
            {
              "type": "object",
              "properties": {
                "status": {
                  "allOf": [
                    {
                      "$ref": "/schemas/core/a2a-task-status.json"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "message": {
                          "allOf": [
                            {
                              "$ref": "/schemas/core/a2a-message.json"
                            },
                            {
                              "type": "object",
                              "properties": {
                                "parts": {
                                  "type": "array",
                                  "description": "Parts is the container of the message content. Array of ADCP Part union type with task-specific validation for parts[].data.",
                                  "items": {
                                    "$ref": "/schemas/core/adcp-webhook-part.json"
                                  },
                                  "minItems": 1
                                }
                              }
                            }
                          ]
                        }
                      }
                    }
                  ]
                }
              }
            }
          ],
          "description": "A TaskStatusUpdateEvent indicating a status change (A2A Specification Section 4.2.1). Uses ADCP extension with task-specific validation for parts[].data."
        }
      },
      "required": ["statusUpdate"],
      "additionalProperties": false
    },
    {
      "type": "object",
      "properties": {
        "artifactUpdate": {
          "allOf": [
            {
              "$ref": "/schemas/core/a2a-task-artifact-update-event.json"
            },
            {
              "type": "object",
              "properties": {
                "artifact": {
                  "allOf": [
                    {
                      "$ref": "/schemas/core/a2a-artifact.json"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "parts": {
                          "type": "array",
                          "description": "Array of parts making up the artifact content (ADCP Part union type with task-specific validation).",
                          "items": {
                            "$ref": "/schemas/core/adcp-part.json"
                          },
                          "minItems": 1
                        }
                      }
                    }
                  ]
                }
              }
            }
          ],
          "description": "A TaskArtifactUpdateEvent indicating artifact update (A2A Specification Section 4.2.2). Uses ADCP extension with task-specific validation for parts[].data."
        }
      },
      "required": ["artifactUpdate"],
      "additionalProperties": false
    }
  ],
  "notes": [
    "Webhooks are ONLY triggered when the initial response status is 'submitted' (long-running operations)",
    "This payload structure fully adopts A2A Protocol's push notification payload format (A2A Specification Section 4.3.3)",
    "The payload is a StreamResponse object (A2A Specification Section 3.2.3) containing exactly one of: task, message, statusUpdate, or artifactUpdate",
    "For status change events (like input-required, failed, working), use statusUpdate: {statusUpdate: {taskId, contextId, status: {state, message: {parts: [...]}, timestamp}, final}}",
    "For final completion with full task state, use task: {task: {id, contextId, status: {state, message: {parts: [...]}, timestamp}, ...}}",
    "Task ID is in statusUpdate.taskId (for statusUpdate) or task.id (for task variant)",
    "Task status state is in statusUpdate.status.state or task.status.state",
    "ADCP declares only the structure of parts[].data (DataPart data field) within Message objects - the task-specific payload",
    "Extract task data from statusUpdate.status.message.parts or task.status.message.parts array: find the DataPart (part with 'data' property) and use its data field",
    "This schema uses ADCP extensions which extend A2A schemas with task-specific validation (inline in this schema)",
    "The parts[].data field is validated as a union of all task-specific async response schemas (see adcp-webhook-part.json)",
    "For create_media_buy, parts.data validates against: create-media-buy-async-response-input-required.json, create-media-buy-async-response-failed.json, create-media-buy-async-response-working.json, or create-media-buy-response.json",
    "TextPart (part with 'text' property) provides human-readable context but is optional",
    "The statusUpdate.final flag indicates if this is the final event in the stream",
    "Your webhook handler receives the complete A2A-compatible StreamResponse structure needed to process the result"
  ],
  "examples": [
    {
      "description": "Webhook for input-required status (human approval needed) - A2A StreamResponse with statusUpdate",
      "data": {
        "statusUpdate": {
          "taskId": "task_456",
          "contextId": "ctx_abc123",
          "status": {
            "state": "input-required",
            "timestamp": "2025-01-22T10:15:00Z",
            "message": {
              "messageId": "msg_456_001",
              "role": "agent",
              "parts": [
                {
                  "text": "Campaign budget $150K requires VP approval to proceed"
                },
                {
                  "data": {
                    "buyer_ref": "nike_q1_campaign_2024",
                    "errors": [
                      {
                        "code": "APPROVAL_REQUIRED",
                        "message": "Budget exceeds auto-approval threshold of $100K. Awaiting VP approval before media buy creation.",
                        "field": "packages[0].budget"
                      }
                    ]
                  }
                }
              ]
            }
          },
          "final": false
        }
      }
    },
    {
      "description": "Webhook for completed create_media_buy - A2A StreamResponse with task object",
      "data": {
        "task": {
          "id": "task_456",
          "contextId": "ctx_abc123",
          "status": {
            "state": "completed",
            "timestamp": "2025-01-22T10:30:00Z",
            "message": {
              "messageId": "msg_456_002",
              "role": "agent",
              "parts": [
                {
                  "text": "Media buy created successfully with 2 packages ready for creative assignment"
                },
                {
                  "data": {
                    "media_buy_id": "mb_12345",
                    "buyer_ref": "nike_q1_campaign_2024",
                    "creative_deadline": "2024-01-30T23:59:59Z",
                    "packages": [
                      {
                        "package_id": "pkg_12345_001",
                        "buyer_ref": "nike_ctv_package",
                        "product_id": "ctv_sports_premium",
                        "budget": 60000,
                        "pacing": "even",
                        "pricing_option_id": "cpm-fixed-sports",
                        "paused": false,
                        "creative_assignments": [],
                        "format_ids_to_provide": [
                          {
                            "agent_url": "https://creative.adcontextprotocol.org",
                            "id": "video_standard_30s"
                          }
                        ]
                      }
                    ]
                  }
                }
              ]
            }
          }
        }
      }
    },
    {
      "description": "Webhook for failed create_media_buy - A2A StreamResponse with statusUpdate",
      "data": {
        "statusUpdate": {
          "taskId": "task_789",
          "contextId": "ctx_abc123",
          "status": {
            "state": "failed",
            "timestamp": "2025-01-22T10:46:00Z",
            "message": {
              "messageId": "msg_789_001",
              "role": "agent",
              "parts": [
                {
                  "text": "Media buy creation failed due to validation errors"
                },
                {
                  "data": {
                    "buyer_ref": "nike_q1_campaign_2024",
                    "errors": [
                      {
                        "code": "PRODUCT_NOT_FOUND",
                        "message": "Product 'prod_invalid' not found",
                        "field": "packages[0].product_id"
                      }
                    ]
                  }
                }
              ]
            }
          },
          "final": true
        }
      }
    }
  ]
}
