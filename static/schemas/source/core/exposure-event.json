{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "/schemas/core/exposure-event.json",
  "title": "Exposure Event",
  "description": "Standardized advertising exposure event delivered to measurement agents. Inspired by Snowplow's thin-event pattern and the Advertising ID Consortium's denormalized log format. User identity is intentionally omitted â€” identity matching is negotiated out-of-band as part of data transport setup.",
  "type": "object",
  "properties": {
    "event_type": {
      "$ref": "/schemas/enums/exposure-event-type.json",
      "description": "Type of exposure event"
    },
    "event_id": {
      "type": "string",
      "description": "Unique event identifier for deduplication"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of the event"
    },
    "media_buy_id": {
      "type": "string",
      "description": "AdCP media buy identifier"
    },
    "creative_id": {
      "type": "string",
      "description": "AdCP creative identifier"
    },
    "buyer_ref": {
      "type": "string",
      "description": "Buyer's reference identifier (alternative to media_buy_id)"
    },
    "channel": {
      "$ref": "/schemas/enums/channels.json",
      "description": "Advertising channel"
    },
    "cost": {
      "type": "object",
      "description": "Cost associated with this event",
      "properties": {
        "amount": {
          "type": "number",
          "minimum": 0,
          "description": "Cost amount"
        },
        "currency": {
          "type": "string",
          "pattern": "^[A-Z]{3}$",
          "description": "ISO 4217 currency code"
        },
        "model": {
          "type": "string",
          "enum": ["cpm", "cpc", "cpa"],
          "description": "Pricing model for this cost"
        }
      },
      "required": ["amount", "currency"],
      "additionalProperties": true
    },
    "geo": {
      "type": "object",
      "description": "Geographic context for this event",
      "properties": {
        "country": {
          "type": "string",
          "description": "ISO 3166-1 alpha-2 country code",
          "pattern": "^[A-Z]{2}$"
        },
        "region": {
          "type": "string",
          "description": "Region or state code"
        },
        "dma": {
          "type": "string",
          "description": "Designated Market Area code (US)"
        }
      },
      "additionalProperties": true
    },
    "impression_id": {
      "type": "string",
      "description": "For click and conversion events, links back to the originating impression"
    },
    "conversion_value": {
      "type": "number",
      "minimum": 0,
      "description": "Value of the conversion (for conversion events). Revenue, order total, or other outcome value."
    },
    "order_id": {
      "type": "string",
      "description": "Order or transaction identifier (for conversion events)"
    },
    "customer_type": {
      "type": "string",
      "enum": ["new", "returning"],
      "description": "Whether this conversion is from a new or returning customer (for conversion events)"
    },
    "ext": {
      "$ref": "/schemas/core/ext.json",
      "description": "Vendor extensions"
    }
  },
  "required": ["event_type", "event_id", "timestamp"],
  "anyOf": [
    { "required": ["media_buy_id"] },
    { "required": ["buyer_ref"] }
  ],
  "additionalProperties": true
}
