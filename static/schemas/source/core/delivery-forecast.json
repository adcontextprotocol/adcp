{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "/schemas/core/delivery-forecast.json",
  "title": "Delivery Forecast",
  "description": "Forecasted delivery metrics for a proposal or product allocation. Publishers attach forecasts to help buyers evaluate expected campaign performance before purchase.",
  "type": "object",
  "properties": {
    "metrics": {
      "type": "object",
      "description": "Forecasted delivery metrics keyed by metric name. Keys should be values from the forecastable-metric enum. Values are ForecastRange objects (low/mid/high). Platform-specific metrics beyond the standard set are allowed.",
      "additionalProperties": {
        "$ref": "/schemas/core/forecast-range.json"
      }
    },
    "budget": {
      "type": "number",
      "description": "Budget amount this forecast was produced for. For allocation-level forecasts, this is the absolute budget for that allocation (not the percentage). For proposal-level forecasts, this is the total proposal budget. When budget_curve is present, this indicates which curve point the top-level metrics correspond to.",
      "minimum": 0
    },
    "method": {
      "$ref": "/schemas/enums/forecast-method.json",
      "description": "Method used to produce this forecast"
    },
    "currency": {
      "type": "string",
      "description": "ISO 4217 currency code for monetary values in this forecast (spend, budget)"
    },
    "demographic_system": {
      "$ref": "/schemas/enums/demographic-system.json",
      "description": "Measurement system for the demographic field. Ensures buyer and seller agree on demographic notation."
    },
    "demographic": {
      "type": "string",
      "description": "Target demographic code within the specified demographic_system. For Nielsen: P18-49, M25-54, W35+. For BARB: ABC1 Adults, 16-34. For AGF: E 14-49.",
      "examples": ["P18-49", "A25-54", "W35+", "M18-34"]
    },
    "reach_unit": {
      "$ref": "/schemas/enums/reach-unit.json",
      "description": "Unit of measurement for reach and audience_size metrics in this forecast. Required for cross-channel forecast comparison."
    },
    "budget_curve": {
      "type": "array",
      "description": "Budget-to-outcome curve showing how delivery metrics scale with spend. Each point pairs a budget level with predicted metric values at that spend. Points should be ordered by ascending budget.",
      "items": {
        "$ref": "/schemas/core/forecast-point.json"
      },
      "minItems": 1
    },
    "generated_at": {
      "type": "string",
      "format": "date-time",
      "description": "When this forecast was computed"
    },
    "valid_until": {
      "type": "string",
      "format": "date-time",
      "description": "When this forecast expires. After this time, the forecast should be refreshed. Forecast expiry does not affect proposal executability."
    },
    "ext": {
      "$ref": "/schemas/core/ext.json"
    }
  },
  "required": ["method", "currency"],
  "additionalProperties": true
}
