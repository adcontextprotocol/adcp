{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "/schemas/core/optimization-goal.json",
  "title": "Optimization Goal",
  "description": "A single optimization target for a package. Packages accept an array of optimization_goals. When multiple goals are present, priority determines which the seller focuses on — 1 is highest priority (primary goal); higher numbers are secondary. Duplicate priority values result in undefined seller behavior.",
  "oneOf": [
    {
      "type": "object",
      "description": "Optimize for a seller-tracked delivery metric. No event source required — the seller tracks clicks, views, and completed views natively.",
      "properties": {
        "kind": { "type": "string", "const": "metric" },
        "metric": {
          "type": "string",
          "enum": ["clicks", "views", "completed_views"],
          "description": "Seller-native metric to optimize for"
        },
        "target": {
          "description": "Target for this metric. When omitted, the seller optimizes for maximum metric volume within budget.",
          "oneOf": [
            {
              "type": "object",
              "description": "Target cost per unit of the metric (e.g., cost per click, cost per view).",
              "properties": {
                "kind": { "type": "string", "const": "cost_per" },
                "value": { "type": "number", "exclusiveMinimum": 0, "description": "Target cost per metric unit in the buy currency" }
              },
              "required": ["kind", "value"],
              "additionalProperties": true
            },
            {
              "type": "object",
              "description": "Target rate for this metric as a proportion of impressions (e.g., CTR of 0.001, video completion rate of 0.85).",
              "properties": {
                "kind": { "type": "string", "const": "rate" },
                "value": { "type": "number", "exclusiveMinimum": 0, "maximum": 1, "description": "Target rate as a decimal (e.g., 0.001 for 0.1% CTR, 0.85 for 85% VCR)" }
              },
              "required": ["kind", "value"],
              "additionalProperties": true
            }
          ]
        },
        "priority": {
          "type": "integer",
          "minimum": 1,
          "description": "Relative priority among all optimization goals on this package. 1 = highest priority (primary goal); higher numbers are lower priority (secondary signals). When omitted, sellers may use array position as priority."
        }
      },
      "required": ["kind", "metric"],
      "additionalProperties": true
    },
    {
      "type": "object",
      "description": "Optimize for an advertiser-tracked conversion event. Requires an event source registered via sync_event_sources.",
      "properties": {
        "kind": { "type": "string", "const": "event" },
        "event_source_id": {
          "type": "string",
          "minLength": 1,
          "description": "Event source to optimize against (must be configured on this account via sync_event_sources)"
        },
        "event_type": {
          "$ref": "/schemas/enums/event-type.json",
          "description": "Event type to optimize for (e.g. purchase, lead, app_install). Use 'custom' with custom_event_name for platform-specific events."
        },
        "custom_event_name": {
          "type": "string",
          "description": "Required when event_type is 'custom'. Platform-specific name for the custom event."
        },
        "value_field": {
          "type": "string",
          "description": "Field on the event's custom_data that carries the monetary value for this goal. Required when target.kind is 'per_ad_spend'. Common values: 'value', 'order_total', 'profit_margin'."
        },
        "target": {
          "description": "Target cost or return for this event. When omitted, the seller optimizes for maximum conversions within budget.",
          "oneOf": [
            {
              "type": "object",
              "description": "Target cost per conversion event.",
              "properties": {
                "kind": { "type": "string", "const": "cost_per" },
                "value": { "type": "number", "exclusiveMinimum": 0, "description": "Target cost per event in the buy currency" }
              },
              "required": ["kind", "value"],
              "additionalProperties": true
            },
            {
              "type": "object",
              "description": "Target return per unit of ad spend, calculated as sum(value_field) / spend. Requires value_field on the goal.",
              "properties": {
                "kind": { "type": "string", "const": "per_ad_spend" },
                "value": { "type": "number", "exclusiveMinimum": 0, "description": "Target return ratio (e.g., 4.0 means $4 of value_field per $1 spent)" }
              },
              "required": ["kind", "value"],
              "additionalProperties": true
            }
          ]
        },
        "attribution_window": {
          "type": "object",
          "description": "Attribution window for this optimization goal. Values must match an option declared in the seller's conversion_tracking.attribution_windows capability. Sellers must reject windows not in their declared capabilities. When omitted, the seller uses their default window.",
          "properties": {
            "click_through": {
              "type": "string",
              "description": "Click-through attribution window (e.g. '7d', '28d', '30d')"
            },
            "view_through": {
              "type": "string",
              "description": "View-through attribution window (e.g. '1d', '7d')"
            }
          },
          "required": ["click_through"],
          "additionalProperties": true
        },
        "priority": {
          "type": "integer",
          "minimum": 1,
          "description": "Relative priority among all optimization goals on this package. 1 = highest priority (primary goal); higher numbers are lower priority (secondary signals). When omitted, sellers may use array position as priority."
        }
      },
      "required": ["kind", "event_source_id", "event_type"],
      "additionalProperties": true
    }
  ]
}
