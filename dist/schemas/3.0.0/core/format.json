{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "/schemas/3.0.0/core/format.json",
  "title": "Format",
  "description": "Represents a creative format with its requirements",
  "type": "object",
  "properties": {
    "format_id": {
      "$ref": "/schemas/3.0.0/core/format-id.json",
      "description": "Structured format identifier with agent URL and format name"
    },
    "name": {
      "type": "string",
      "description": "Human-readable format name"
    },
    "description": {
      "type": "string",
      "description": "Plain text explanation of what this format does and what assets it requires"
    },
    "preview_image": {
      "type": "string",
      "format": "uri",
      "description": "DEPRECATED: Use format_card instead. Optional preview image URL for format browsing/discovery UI. Should be 400x300px (4:3 aspect ratio) PNG or JPG. Used as thumbnail/card image in format browsers. This field is maintained for backward compatibility but format_card provides a more flexible, structured approach."
    },
    "example_url": {
      "type": "string",
      "format": "uri",
      "description": "Optional URL to showcase page with examples and interactive demos of this format"
    },
    "type": {
      "$ref": "/schemas/3.0.0/enums/format-category.json",
      "description": "Media type of this format - determines rendering method and asset requirements"
    },
    "accepts_parameters": {
      "type": "array",
      "description": "List of parameters this format accepts in format_id. Template formats define which parameters (dimensions, duration, etc.) can be specified when instantiating the format. Empty or omitted means this is a concrete format with fixed parameters.",
      "items": {
        "$ref": "/schemas/3.0.0/enums/format-id-parameter.json"
      },
      "uniqueItems": true
    },
    "renders": {
      "type": "array",
      "description": "Specification of rendered pieces for this format. Most formats produce a single render. Companion ad formats (video + banner), adaptive formats, and multi-placement formats produce multiple renders. Each render specifies its role and dimensions.",
      "items": {
        "type": "object",
        "properties": {
          "role": {
            "type": "string",
            "description": "Semantic role of this rendered piece (e.g., 'primary', 'companion', 'mobile_variant')"
          },
          "parameters_from_format_id": {
            "type": "boolean",
            "description": "When true, parameters for this render (dimensions and/or duration) are specified in the format_id. Used for template formats that accept parameters. Mutually exclusive with specifying dimensions object explicitly."
          },
          "dimensions": {
            "type": "object",
            "description": "Dimensions for this rendered piece (in pixels)",
            "properties": {
              "width": {
                "type": "integer",
                "minimum": 1,
                "description": "Fixed width in pixels"
              },
              "height": {
                "type": "integer",
                "minimum": 1,
                "description": "Fixed height in pixels"
              },
              "min_width": {
                "type": "integer",
                "minimum": 1,
                "description": "Minimum width in pixels for responsive renders"
              },
              "min_height": {
                "type": "integer",
                "minimum": 1,
                "description": "Minimum height in pixels for responsive renders"
              },
              "max_width": {
                "type": "integer",
                "minimum": 1,
                "description": "Maximum width in pixels for responsive renders"
              },
              "max_height": {
                "type": "integer",
                "minimum": 1,
                "description": "Maximum height in pixels for responsive renders"
              },
              "responsive": {
                "type": "object",
                "description": "Indicates which dimensions are responsive/fluid",
                "properties": {
                  "width": {
                    "type": "boolean"
                  },
                  "height": {
                    "type": "boolean"
                  }
                },
                "required": [
                  "width",
                  "height"
                ]
              },
              "aspect_ratio": {
                "type": "string",
                "description": "Fixed aspect ratio constraint (e.g., '16:9', '4:3', '1:1')",
                "pattern": "^\\d+:\\d+$"
              }
            }
          }
        },
        "required": [
          "role"
        ],
        "oneOf": [
          {
            "required": [
              "dimensions"
            ],
            "not": {
              "required": [
                "parameters_from_format_id"
              ]
            }
          },
          {
            "required": [
              "parameters_from_format_id"
            ],
            "properties": {
              "parameters_from_format_id": {
                "const": true
              }
            },
            "not": {
              "required": [
                "dimensions"
              ]
            }
          }
        ]
      },
      "minItems": 1
    },
    "assets_required": {
      "type": "array",
      "deprecated": true,
      "description": "DEPRECATED: Use 'assets' instead. Array of required assets or asset groups for this format. Each asset is identified by its asset_id, which must be used as the key in creative manifests. Can contain individual assets or repeatable asset sequences (e.g., carousel products, slideshow frames). This field is maintained for backward compatibility; new implementations should use 'assets' with the 'required' boolean on each asset.",
      "items": {
        "oneOf": [
          {
            "description": "Individual asset requirement",
            "type": "object",
            "properties": {
              "item_type": {
                "type": "string",
                "const": "individual",
                "description": "Discriminator indicating this is an individual asset requirement"
              },
              "asset_id": {
                "type": "string",
                "description": "Unique identifier for this asset. Creative manifests MUST use this exact value as the key in the assets object."
              },
              "asset_type": {
                "$ref": "/schemas/3.0.0/enums/asset-content-type.json",
                "description": "Type of asset"
              },
              "asset_role": {
                "type": "string",
                "description": "Optional descriptive label for this asset's purpose (e.g., 'hero_image', 'logo'). Not used for referencing assets in manifests\u2014use asset_id instead. This field is for human-readable documentation and UI display only."
              },
              "required": {
                "type": "boolean",
                "description": "Whether this asset is required"
              },
              "requirements": {
                "type": "object",
                "description": "Technical requirements for this asset (dimensions, file size, duration, etc.). For template formats, use parameters_from_format_id: true to indicate asset parameters must match the format_id parameters (width/height/unit and/or duration_ms).",
                "additionalProperties": true
              }
            },
            "required": [
              "item_type",
              "asset_id",
              "asset_type"
            ]
          },
          {
            "description": "Repeatable asset group (for carousels, slideshows, playlists, etc.)",
            "type": "object",
            "properties": {
              "item_type": {
                "type": "string",
                "const": "repeatable_group",
                "description": "Discriminator indicating this is a repeatable asset group"
              },
              "asset_group_id": {
                "type": "string",
                "description": "Identifier for this asset group (e.g., 'product', 'slide', 'card')"
              },
              "min_count": {
                "type": "integer",
                "description": "Minimum number of repetitions required",
                "minimum": 1
              },
              "max_count": {
                "type": "integer",
                "description": "Maximum number of repetitions allowed",
                "minimum": 1
              },
              "assets": {
                "type": "array",
                "description": "Assets within each repetition of this group",
                "items": {
                  "type": "object",
                  "properties": {
                    "asset_id": {
                      "type": "string",
                      "description": "Identifier for this asset within the group"
                    },
                    "asset_type": {
                      "$ref": "/schemas/3.0.0/enums/asset-content-type.json",
                      "description": "Type of asset"
                    },
                    "asset_role": {
                      "type": "string",
                      "description": "Optional descriptive label for this asset's purpose (e.g., 'hero_image', 'logo'). Not used for referencing assets in manifests\u2014use asset_id instead. This field is for human-readable documentation and UI display only."
                    },
                    "required": {
                      "type": "boolean",
                      "description": "Whether this asset is required in each repetition"
                    },
                    "requirements": {
                      "type": "object",
                      "description": "Technical requirements for this asset. For template formats, use parameters_from_format_id: true to indicate asset parameters must match the format_id parameters (width/height/unit and/or duration_ms).",
                      "additionalProperties": true
                    }
                  },
                  "required": [
                    "asset_id",
                    "asset_type"
                  ]
                }
              }
            },
            "required": [
              "item_type",
              "asset_group_id",
              "min_count",
              "max_count",
              "assets"
            ]
          }
        ]
      }
    },
    "assets": {
      "type": "array",
      "description": "Array of all assets supported for this format. Each asset is identified by its asset_id, which must be used as the key in creative manifests. Use the 'required' boolean on each asset to indicate whether it's mandatory. This field replaces the deprecated 'assets_required' and enables full asset discovery for buyers and AI agents.",
      "items": {
        "oneOf": [
          {
            "description": "Individual asset specification",
            "type": "object",
            "properties": {
              "item_type": {
                "type": "string",
                "const": "individual",
                "description": "Discriminator indicating this is an individual asset"
              },
              "asset_id": {
                "type": "string",
                "description": "Unique identifier for this asset. Creative manifests MUST use this exact value as the key in the assets object."
              },
              "asset_type": {
                "$ref": "/schemas/3.0.0/enums/asset-content-type.json",
                "description": "Type of asset"
              },
              "asset_role": {
                "type": "string",
                "description": "Optional descriptive label for this asset's purpose (e.g., 'hero_image', 'logo', 'third_party_tracking'). Not used for referencing assets in manifests—use asset_id instead. This field is for human-readable documentation and UI display only."
              },
              "required": {
                "type": "boolean",
                "description": "Whether this asset is required (true) or optional (false). Required assets must be provided for a valid creative. Optional assets enhance the creative but are not mandatory."
              },
              "requirements": {
                "type": "object",
                "description": "Technical requirements for this asset (dimensions, file size, duration, etc.). For template formats, use parameters_from_format_id: true to indicate asset parameters must match the format_id parameters (width/height/unit and/or duration_ms).",
                "additionalProperties": true
              }
            },
            "required": ["item_type", "asset_id", "asset_type", "required"]
          },
          {
            "description": "Repeatable asset group (for carousels, slideshows, playlists, etc.)",
            "type": "object",
            "properties": {
              "item_type": {
                "type": "string",
                "const": "repeatable_group",
                "description": "Discriminator indicating this is a repeatable asset group"
              },
              "asset_group_id": {
                "type": "string",
                "description": "Identifier for this asset group (e.g., 'product', 'slide', 'card')"
              },
              "required": {
                "type": "boolean",
                "description": "Whether this asset group is required. If true, at least min_count repetitions must be provided."
              },
              "min_count": {
                "type": "integer",
                "description": "Minimum number of repetitions required (if group is required) or allowed (if optional)",
                "minimum": 0
              },
              "max_count": {
                "type": "integer",
                "description": "Maximum number of repetitions allowed",
                "minimum": 1
              },
              "assets": {
                "type": "array",
                "description": "Assets within each repetition of this group",
                "items": {
                  "type": "object",
                  "properties": {
                    "asset_id": {
                      "type": "string",
                      "description": "Identifier for this asset within the group"
                    },
                    "asset_type": {
                      "$ref": "/schemas/3.0.0/enums/asset-content-type.json",
                      "description": "Type of asset"
                    },
                    "asset_role": {
                      "type": "string",
                      "description": "Optional descriptive label for this asset's purpose. Not used for referencing assets in manifests—use asset_id instead. This field is for human-readable documentation and UI display only."
                    },
                    "required": {
                      "type": "boolean",
                      "description": "Whether this asset is required within each repetition of the group",
                      "default": false
                    },
                    "requirements": {
                      "type": "object",
                      "description": "Technical requirements for this asset. For template formats, use parameters_from_format_id: true to indicate asset parameters must match the format_id parameters (width/height/unit and/or duration_ms).",
                      "additionalProperties": true
                    }
                  },
                  "required": ["asset_id", "asset_type", "required"]
                }
              }
            },
            "required": ["item_type", "asset_group_id", "required", "min_count", "max_count", "assets"]
          }
        ]
      }
    },
    "delivery": {
      "type": "object",
      "description": "Delivery method specifications (e.g., hosted, VAST, third-party tags)",
      "additionalProperties": true
    },
    "supported_macros": {
      "type": "array",
      "description": "List of universal macros supported by this format (e.g., MEDIA_BUY_ID, CACHEBUSTER, DEVICE_ID). Used for validation and developer tooling.",
      "items": {
        "type": "string"
      }
    },
    "output_format_ids": {
      "type": "array",
      "description": "For generative formats: array of format IDs that this format can generate. When a format accepts inputs like brand_manifest and message, this specifies what concrete output formats can be produced (e.g., a generative banner format might output standard image banner formats).",
      "items": {
        "$ref": "/schemas/3.0.0/core/format-id.json"
      }
    },
    "format_card": {
      "type": "object",
      "description": "Optional standard visual card (300x400px) for displaying this format in user interfaces. Can be rendered via preview_creative or pre-generated.",
      "properties": {
        "format_id": {
          "$ref": "/schemas/3.0.0/core/format-id.json",
          "description": "Creative format defining the card layout (typically format_card_standard)"
        },
        "manifest": {
          "type": "object",
          "description": "Asset manifest for rendering the card, structure defined by the format",
          "additionalProperties": true
        }
      },
      "required": [
        "format_id",
        "manifest"
      ],
      "additionalProperties": true
    },
    "format_card_detailed": {
      "type": "object",
      "description": "Optional detailed card with carousel and full specifications. Provides rich format documentation similar to ad spec pages.",
      "properties": {
        "format_id": {
          "$ref": "/schemas/3.0.0/core/format-id.json",
          "description": "Creative format defining the detailed card layout (typically format_card_detailed)"
        },
        "manifest": {
          "type": "object",
          "description": "Asset manifest for rendering the detailed card, structure defined by the format",
          "additionalProperties": true
        }
      },
      "required": [
        "format_id",
        "manifest"
      ],
      "additionalProperties": true
    }
  },
  "required": [
    "format_id",
    "name",
    "type"
  ],
  "additionalProperties": true
}
