{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "/schemas/3.0.0-beta.3/bundled/media-buy/update-media-buy-response.json",
  "title": "Update Media Buy Response",
  "description": "Response payload for update_media_buy task. Returns either complete success data OR error information, never both. This enforces atomic operation semantics - updates are either fully applied or not applied at all.",
  "type": "object",
  "oneOf": [
    {
      "title": "UpdateMediaBuySuccess",
      "description": "Success response - media buy updated successfully",
      "type": "object",
      "properties": {
        "media_buy_id": {
          "type": "string",
          "description": "Publisher's identifier for the media buy"
        },
        "buyer_ref": {
          "type": "string",
          "description": "Buyer's reference identifier for the media buy"
        },
        "implementation_date": {
          "type": [
            "string",
            "null"
          ],
          "format": "date-time",
          "description": "ISO 8601 timestamp when changes take effect (null if pending approval)"
        },
        "affected_packages": {
          "type": "array",
          "description": "Array of packages that were modified with complete state information",
          "items": {
            "title": "Package",
            "description": "A specific product within a media buy (line item)",
            "type": "object",
            "properties": {
              "package_id": {
                "type": "string",
                "description": "Publisher's unique identifier for the package"
              },
              "buyer_ref": {
                "type": "string",
                "description": "Buyer's reference identifier for this package"
              },
              "product_id": {
                "type": "string",
                "description": "ID of the product this package is based on"
              },
              "budget": {
                "type": "number",
                "description": "Budget allocation for this package in the currency specified by the pricing option",
                "minimum": 0
              },
              "pacing": {
                "title": "Pacing",
                "description": "Budget pacing strategy",
                "type": "string",
                "enum": [
                  "even",
                  "asap",
                  "front_loaded"
                ],
                "enumDescriptions": {
                  "even": "Allocate remaining budget evenly over remaining campaign duration (default)",
                  "asap": "Spend remaining budget as quickly as possible",
                  "front_loaded": "Allocate more remaining budget earlier in the remaining campaign period"
                }
              },
              "pricing_option_id": {
                "type": "string",
                "description": "ID of the selected pricing option from the product's pricing_options array"
              },
              "bid_price": {
                "type": "number",
                "description": "Bid price for auction-based CPM pricing (present if using cpm-auction-option)",
                "minimum": 0
              },
              "impressions": {
                "type": "number",
                "description": "Impression goal for this package",
                "minimum": 0
              },
              "targeting_overlay": {
                "title": "Targeting Overlay",
                "description": "Optional restriction overlays for media buys. Most targeting should be expressed in the brief and handled by the publisher. These fields are for functional restrictions: geographic (RCT testing, regulatory compliance), age verification (alcohol, gambling), device platform (app compatibility), and language (localization).",
                "type": "object",
                "properties": {
                  "geo_countries": {
                    "type": "array",
                    "description": "Restrict delivery to specific countries. ISO 3166-1 alpha-2 codes (e.g., 'US', 'GB', 'DE').",
                    "items": {
                      "type": "string",
                      "pattern": "^[A-Z]{2}$"
                    },
                    "minItems": 1
                  },
                  "geo_countries_exclude": {
                    "type": "array",
                    "description": "Exclude specific countries from delivery. ISO 3166-1 alpha-2 codes (e.g., 'US', 'GB', 'DE').",
                    "items": {
                      "type": "string",
                      "pattern": "^[A-Z]{2}$"
                    },
                    "minItems": 1
                  },
                  "geo_regions": {
                    "type": "array",
                    "description": "Restrict delivery to specific regions/states. ISO 3166-2 subdivision codes (e.g., 'US-CA', 'GB-SCT').",
                    "items": {
                      "type": "string",
                      "pattern": "^[A-Z]{2}-[A-Z0-9]{1,3}$"
                    },
                    "minItems": 1
                  },
                  "geo_regions_exclude": {
                    "type": "array",
                    "description": "Exclude specific regions/states from delivery. ISO 3166-2 subdivision codes (e.g., 'US-CA', 'GB-SCT').",
                    "items": {
                      "type": "string",
                      "pattern": "^[A-Z]{2}-[A-Z0-9]{1,3}$"
                    },
                    "minItems": 1
                  },
                  "geo_metros": {
                    "type": "array",
                    "description": "Restrict delivery to specific metro areas. Each entry specifies the classification system and target values. Seller must declare supported systems in get_adcp_capabilities.",
                    "items": {
                      "type": "object",
                      "properties": {
                        "system": {
                          "title": "Metro Area System",
                          "description": "Metro area classification system (e.g., 'nielsen_dma', 'uk_itl2')",
                          "type": "string",
                          "enum": [
                            "nielsen_dma",
                            "uk_itl1",
                            "uk_itl2",
                            "eurostat_nuts2",
                            "custom"
                          ]
                        },
                        "values": {
                          "type": "array",
                          "description": "Metro codes within the system (e.g., ['501', '602'] for Nielsen DMAs)",
                          "items": {
                            "type": "string"
                          },
                          "minItems": 1
                        }
                      },
                      "required": [
                        "system",
                        "values"
                      ],
                      "additionalProperties": false
                    },
                    "minItems": 1
                  },
                  "geo_metros_exclude": {
                    "type": "array",
                    "description": "Exclude specific metro areas from delivery. Each entry specifies the classification system and excluded values. Seller must declare supported systems in get_adcp_capabilities.",
                    "items": {
                      "type": "object",
                      "properties": {
                        "system": {
                          "title": "Metro Area System",
                          "description": "Metro area classification system (e.g., 'nielsen_dma', 'uk_itl2')",
                          "type": "string",
                          "enum": [
                            "nielsen_dma",
                            "uk_itl1",
                            "uk_itl2",
                            "eurostat_nuts2",
                            "custom"
                          ]
                        },
                        "values": {
                          "type": "array",
                          "description": "Metro codes to exclude within the system (e.g., ['501', '602'] for Nielsen DMAs)",
                          "items": {
                            "type": "string"
                          },
                          "minItems": 1
                        }
                      },
                      "required": [
                        "system",
                        "values"
                      ],
                      "additionalProperties": false
                    },
                    "minItems": 1
                  },
                  "geo_postal_areas": {
                    "type": "array",
                    "description": "Restrict delivery to specific postal areas. Each entry specifies the postal system and target values. Seller must declare supported systems in get_adcp_capabilities.",
                    "items": {
                      "type": "object",
                      "properties": {
                        "system": {
                          "title": "Postal Code System",
                          "description": "Postal code system (e.g., 'us_zip', 'gb_outward'). System name encodes country and precision.",
                          "type": "string",
                          "enum": [
                            "us_zip",
                            "us_zip_plus_four",
                            "gb_outward",
                            "gb_full",
                            "ca_fsa",
                            "ca_full",
                            "de_plz",
                            "fr_code_postal",
                            "au_postcode"
                          ]
                        },
                        "values": {
                          "type": "array",
                          "description": "Postal codes within the system (e.g., ['10001', '10002'] for us_zip)",
                          "items": {
                            "type": "string"
                          },
                          "minItems": 1
                        }
                      },
                      "required": [
                        "system",
                        "values"
                      ],
                      "additionalProperties": false
                    },
                    "minItems": 1
                  },
                  "geo_postal_areas_exclude": {
                    "type": "array",
                    "description": "Exclude specific postal areas from delivery. Each entry specifies the postal system and excluded values. Seller must declare supported systems in get_adcp_capabilities.",
                    "items": {
                      "type": "object",
                      "properties": {
                        "system": {
                          "title": "Postal Code System",
                          "description": "Postal code system (e.g., 'us_zip', 'gb_outward'). System name encodes country and precision.",
                          "type": "string",
                          "enum": [
                            "us_zip",
                            "us_zip_plus_four",
                            "gb_outward",
                            "gb_full",
                            "ca_fsa",
                            "ca_full",
                            "de_plz",
                            "fr_code_postal",
                            "au_postcode"
                          ]
                        },
                        "values": {
                          "type": "array",
                          "description": "Postal codes to exclude within the system (e.g., ['10001', '10002'] for us_zip)",
                          "items": {
                            "type": "string"
                          },
                          "minItems": 1
                        }
                      },
                      "required": [
                        "system",
                        "values"
                      ],
                      "additionalProperties": false
                    },
                    "minItems": 1
                  },
                  "daypart_targets": {
                    "type": "array",
                    "description": "Restrict delivery to specific time windows. Each entry specifies days of week and an hour range.",
                    "items": {
                      "title": "Daypart Target",
                      "description": "A time window for daypart targeting. Specifies days of week and an hour range. start_hour is inclusive, end_hour is exclusive (e.g., 6-10 = 6:00am to 10:00am). Follows the Google Ads AdScheduleInfo / DV360 DayPartTargeting pattern.",
                      "type": "object",
                      "properties": {
                        "days": {
                          "type": "array",
                          "description": "Days of week this window applies to. Use multiple days for compact targeting (e.g., monday-friday in one object).",
                          "items": {
                            "title": "Day of Week",
                            "description": "Days of the week for daypart targeting",
                            "type": "string",
                            "enum": [
                              "monday",
                              "tuesday",
                              "wednesday",
                              "thursday",
                              "friday",
                              "saturday",
                              "sunday"
                            ]
                          },
                          "minItems": 1
                        },
                        "start_hour": {
                          "type": "integer",
                          "description": "Start hour (inclusive), 0-23 in 24-hour format. 0 = midnight, 6 = 6:00am, 18 = 6:00pm.",
                          "minimum": 0,
                          "maximum": 23
                        },
                        "end_hour": {
                          "type": "integer",
                          "description": "End hour (exclusive), 1-24 in 24-hour format. 10 = 10:00am, 24 = midnight. Must be greater than start_hour.",
                          "minimum": 1,
                          "maximum": 24
                        },
                        "label": {
                          "type": "string",
                          "description": "Optional human-readable name for this time window (e.g., 'Morning Drive', 'Prime Time')"
                        }
                      },
                      "required": [
                        "days",
                        "start_hour",
                        "end_hour"
                      ],
                      "additionalProperties": false
                    },
                    "minItems": 1
                  },
                  "axe_include_segment": {
                    "type": "string",
                    "description": "AXE segment ID to include for targeting"
                  },
                  "axe_exclude_segment": {
                    "type": "string",
                    "description": "AXE segment ID to exclude from targeting"
                  },
                  "frequency_cap": {
                    "title": "Frequency Cap",
                    "description": "Frequency capping settings for package-level application",
                    "type": "object",
                    "properties": {
                      "suppress_minutes": {
                        "type": "number",
                        "description": "Minutes to suppress after impression",
                        "minimum": 0
                      }
                    },
                    "required": [
                      "suppress_minutes"
                    ],
                    "additionalProperties": true
                  },
                  "property_list": {
                    "title": "Property List Reference",
                    "description": "Reference to a property list for targeting specific properties within this product. The package runs on the intersection of the product's publisher_properties and this list. Sellers SHOULD return a validation error if the product has property_targeting_allowed: false.",
                    "type": "object",
                    "properties": {
                      "agent_url": {
                        "type": "string",
                        "format": "uri",
                        "description": "URL of the agent managing the property list"
                      },
                      "list_id": {
                        "type": "string",
                        "description": "Identifier for the property list within the agent",
                        "minLength": 1
                      },
                      "auth_token": {
                        "type": "string",
                        "description": "JWT or other authorization token for accessing the list. Optional if the list is public or caller has implicit access."
                      }
                    },
                    "required": [
                      "agent_url",
                      "list_id"
                    ],
                    "additionalProperties": false
                  },
                  "age_restriction": {
                    "type": "object",
                    "description": "Age restriction for compliance. Use for legal requirements (alcohol, gambling), not audience targeting.",
                    "properties": {
                      "min": {
                        "type": "integer",
                        "minimum": 13,
                        "maximum": 99,
                        "description": "Minimum age required"
                      },
                      "verification_required": {
                        "type": "boolean",
                        "default": false,
                        "description": "Whether verified age (not inferred) is required for compliance"
                      },
                      "accepted_methods": {
                        "type": "array",
                        "description": "Accepted verification methods. If omitted, any method the platform supports is acceptable.",
                        "items": {
                          "title": "Age Verification Method",
                          "description": "Methods for verifying user age for compliance. Does not include 'inferred' as it is not accepted for regulatory compliance.",
                          "type": "string",
                          "enum": [
                            "facial_age_estimation",
                            "id_document",
                            "digital_id",
                            "credit_card",
                            "world_id"
                          ]
                        },
                        "minItems": 1
                      }
                    },
                    "required": [
                      "min"
                    ],
                    "additionalProperties": false
                  },
                  "device_platform": {
                    "type": "array",
                    "description": "Restrict to specific platforms. Use for technical compatibility (app only works on iOS). Values from Sec-CH-UA-Platform standard, extended for CTV.",
                    "items": {
                      "title": "Device Platform",
                      "description": "Operating system platforms for device targeting. Browser values from Sec-CH-UA-Platform standard, extended for CTV.",
                      "type": "string",
                      "enum": [
                        "ios",
                        "android",
                        "windows",
                        "macos",
                        "linux",
                        "chromeos",
                        "tvos",
                        "tizen",
                        "webos",
                        "fire_os",
                        "roku_os",
                        "unknown"
                      ]
                    },
                    "minItems": 1
                  },
                  "language": {
                    "type": "array",
                    "description": "Restrict to users with specific language preferences. ISO 639-1 codes (e.g., 'en', 'es', 'fr').",
                    "items": {
                      "type": "string",
                      "pattern": "^[a-z]{2}$"
                    },
                    "minItems": 1
                  }
                },
                "additionalProperties": true
              },
              "creative_assignments": {
                "type": "array",
                "description": "Creative assets assigned to this package",
                "items": {
                  "title": "Creative Assignment",
                  "description": "Assignment of a creative asset to a package with optional placement targeting. Used in create_media_buy and update_media_buy requests. Note: sync_creatives does not support placement_ids - use create/update_media_buy for placement-level targeting.",
                  "type": "object",
                  "properties": {
                    "creative_id": {
                      "type": "string",
                      "description": "Unique identifier for the creative"
                    },
                    "weight": {
                      "type": "number",
                      "description": "Delivery weight for this creative",
                      "minimum": 0,
                      "maximum": 100
                    },
                    "placement_ids": {
                      "type": "array",
                      "description": "Optional array of placement IDs where this creative should run. When omitted, the creative runs on all placements in the package. References placement_id values from the product's placements array.",
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1
                    }
                  },
                  "required": [
                    "creative_id"
                  ],
                  "additionalProperties": true
                }
              },
              "format_ids_to_provide": {
                "type": "array",
                "description": "Format IDs that creative assets will be provided for this package",
                "items": {
                  "title": "Format ID",
                  "description": "Structured format identifier with agent URL and format name. Can reference: (1) a concrete format with fixed dimensions (id only), (2) a template format without parameters (id only), or (3) a template format with parameters (id + dimensions/duration). Template formats accept parameters in format_id while concrete formats have fixed dimensions in their definition. Parameterized format IDs create unique, specific format variants.",
                  "type": "object",
                  "properties": {
                    "agent_url": {
                      "type": "string",
                      "format": "uri",
                      "description": "URL of the agent that defines this format (e.g., 'https://creatives.adcontextprotocol.org' for standard formats, or 'https://publisher.com/.well-known/adcp/sales' for custom formats)"
                    },
                    "id": {
                      "type": "string",
                      "pattern": "^[a-zA-Z0-9_-]+$",
                      "description": "Format identifier within the agent's namespace (e.g., 'display_static', 'video_hosted', 'audio_standard'). When used alone, references a template format. When combined with dimension/duration fields, creates a parameterized format ID for a specific variant."
                    },
                    "width": {
                      "type": "integer",
                      "minimum": 1,
                      "description": "Width in pixels for visual formats. When specified, height must also be specified. Both fields together create a parameterized format ID for dimension-specific variants."
                    },
                    "height": {
                      "type": "integer",
                      "minimum": 1,
                      "description": "Height in pixels for visual formats. When specified, width must also be specified. Both fields together create a parameterized format ID for dimension-specific variants."
                    },
                    "duration_ms": {
                      "type": "number",
                      "minimum": 1,
                      "description": "Duration in milliseconds for time-based formats (video, audio). When specified, creates a parameterized format ID. Omit to reference a template format without parameters."
                    }
                  },
                  "required": [
                    "agent_url",
                    "id"
                  ],
                  "additionalProperties": true,
                  "dependencies": {
                    "width": [
                      "height"
                    ],
                    "height": [
                      "width"
                    ]
                  }
                }
              },
              "optimization_goal": {
                "title": "Optimization Goal",
                "description": "Conversion optimization goal for a package. Tells the seller which event source and event type to optimize delivery against. Provide at most one of target_roas or target_cpa. If neither is provided, the seller optimizes for maximum conversions within budget.",
                "type": "object",
                "properties": {
                  "event_source_id": {
                    "type": "string",
                    "description": "Event source to optimize against (must be configured on this account via sync_event_sources)"
                  },
                  "event_type": {
                    "title": "Event Type",
                    "description": "Event type to optimize for (e.g. purchase, lead)",
                    "type": "string",
                    "enum": [
                      "page_view",
                      "view_content",
                      "select_content",
                      "select_item",
                      "search",
                      "share",
                      "add_to_cart",
                      "remove_from_cart",
                      "viewed_cart",
                      "add_to_wishlist",
                      "initiate_checkout",
                      "add_payment_info",
                      "purchase",
                      "refund",
                      "lead",
                      "qualify_lead",
                      "close_convert_lead",
                      "disqualify_lead",
                      "complete_registration",
                      "subscribe",
                      "start_trial",
                      "app_install",
                      "app_launch",
                      "contact",
                      "schedule",
                      "donate",
                      "submit_application",
                      "custom"
                    ],
                    "enumDescriptions": {
                      "page_view": "User viewed a page",
                      "view_content": "User viewed specific content (product, article, etc.)",
                      "select_content": "User selected or clicked on content (article, video, etc.)",
                      "select_item": "User selected a specific product or item from a list",
                      "search": "User performed a search",
                      "share": "User shared content via social or messaging",
                      "add_to_cart": "User added an item to cart",
                      "remove_from_cart": "User removed an item from cart",
                      "viewed_cart": "User viewed their shopping cart",
                      "add_to_wishlist": "User added an item to a wishlist",
                      "initiate_checkout": "User started checkout process",
                      "add_payment_info": "User added payment information",
                      "purchase": "User completed a purchase",
                      "refund": "A purchase was fully or partially refunded (adjusts ROAS)",
                      "lead": "User expressed interest (form submission, signup, etc.)",
                      "qualify_lead": "Lead qualified by sales or scoring criteria",
                      "close_convert_lead": "Lead converted to a customer or closed deal",
                      "disqualify_lead": "Lead disqualified or marked as not viable",
                      "complete_registration": "User completed account registration",
                      "subscribe": "User subscribed to a service or newsletter",
                      "start_trial": "User started a free trial",
                      "app_install": "User installed an application",
                      "app_launch": "User launched an application",
                      "contact": "User initiated contact (call, message, etc.)",
                      "schedule": "User scheduled an appointment or event",
                      "donate": "User made a donation",
                      "submit_application": "User submitted an application (loan, job, etc.)",
                      "custom": "Custom event type (specify in custom_event_name)"
                    }
                  },
                  "target_roas": {
                    "type": "number",
                    "description": "Target return on ad spend (e.g. 4.0 = $4 conversion value per $1 spent). Mutually exclusive with target_cpa.",
                    "exclusiveMinimum": 0
                  },
                  "target_cpa": {
                    "type": "number",
                    "description": "Target cost per acquisition in the buy currency. Mutually exclusive with target_roas.",
                    "exclusiveMinimum": 0
                  },
                  "attribution_window": {
                    "type": "object",
                    "description": "Attribution window for this optimization goal. Values must match an option declared in the seller's conversion_tracking.attribution_windows capability. When omitted, the seller uses their default window.",
                    "properties": {
                      "click_through": {
                        "type": "string",
                        "description": "Click-through attribution window (e.g. '7d', '28d', '30d')"
                      },
                      "view_through": {
                        "type": "string",
                        "description": "View-through attribution window (e.g. '1d', '7d')"
                      }
                    },
                    "required": [
                      "click_through"
                    ],
                    "additionalProperties": true
                  }
                },
                "required": [
                  "event_source_id",
                  "event_type"
                ],
                "additionalProperties": true
              },
              "paused": {
                "type": "boolean",
                "description": "Whether this package is paused by the buyer. Paused packages do not deliver impressions. Defaults to false.",
                "default": false
              },
              "ext": {
                "title": "Extension Object",
                "description": "Extension object for platform-specific, vendor-namespaced parameters. Extensions are always optional and must be namespaced under a vendor/platform key (e.g., ext.gam, ext.roku). Used for custom capabilities, partner-specific configuration, and features being proposed for standardization.",
                "type": "object",
                "additionalProperties": true
              }
            },
            "required": [
              "package_id"
            ],
            "additionalProperties": true
          }
        },
        "context": {
          "title": "Context Object",
          "description": "Opaque correlation data that is echoed unchanged in responses. Used for internal tracking, UI session IDs, trace IDs, and other caller-specific identifiers that don't affect protocol behavior. Context data is never parsed by AdCP agents - it's simply preserved and returned.",
          "type": "object",
          "additionalProperties": true
        },
        "ext": {
          "title": "Extension Object",
          "description": "Extension object for platform-specific, vendor-namespaced parameters. Extensions are always optional and must be namespaced under a vendor/platform key (e.g., ext.gam, ext.roku). Used for custom capabilities, partner-specific configuration, and features being proposed for standardization.",
          "type": "object",
          "additionalProperties": true
        }
      },
      "required": [
        "media_buy_id",
        "buyer_ref"
      ],
      "additionalProperties": true,
      "not": {
        "required": [
          "errors"
        ]
      }
    },
    {
      "title": "UpdateMediaBuyError",
      "description": "Error response - operation failed, no changes applied",
      "type": "object",
      "properties": {
        "errors": {
          "type": "array",
          "description": "Array of errors explaining why the operation failed",
          "items": {
            "title": "Error",
            "description": "Standard error structure for task-specific errors and warnings",
            "type": "object",
            "properties": {
              "code": {
                "type": "string",
                "description": "Error code for programmatic handling"
              },
              "message": {
                "type": "string",
                "description": "Human-readable error message"
              },
              "field": {
                "type": "string",
                "description": "Field path associated with the error (e.g., 'packages[0].targeting')"
              },
              "suggestion": {
                "type": "string",
                "description": "Suggested fix for the error"
              },
              "retry_after": {
                "type": "number",
                "description": "Seconds to wait before retrying the operation",
                "minimum": 0
              },
              "details": {
                "type": "object",
                "description": "Additional task-specific error details",
                "additionalProperties": true
              }
            },
            "required": [
              "code",
              "message"
            ],
            "additionalProperties": true
          },
          "minItems": 1
        },
        "context": {
          "title": "Context Object",
          "description": "Opaque correlation data that is echoed unchanged in responses. Used for internal tracking, UI session IDs, trace IDs, and other caller-specific identifiers that don't affect protocol behavior. Context data is never parsed by AdCP agents - it's simply preserved and returned.",
          "type": "object",
          "additionalProperties": true
        },
        "ext": {
          "title": "Extension Object",
          "description": "Extension object for platform-specific, vendor-namespaced parameters. Extensions are always optional and must be namespaced under a vendor/platform key (e.g., ext.gam, ext.roku). Used for custom capabilities, partner-specific configuration, and features being proposed for standardization.",
          "type": "object",
          "additionalProperties": true
        }
      },
      "required": [
        "errors"
      ],
      "additionalProperties": true,
      "not": {
        "anyOf": [
          {
            "required": [
              "media_buy_id"
            ]
          },
          {
            "required": [
              "buyer_ref"
            ]
          },
          {
            "required": [
              "affected_packages"
            ]
          }
        ]
      }
    }
  ],
  "_bundled": {
    "generatedAt": "2026-02-12T12:28:49.137Z",
    "note": "This is a bundled schema with all $ref resolved inline. For the modular version with references, use the parent directory."
  }
}