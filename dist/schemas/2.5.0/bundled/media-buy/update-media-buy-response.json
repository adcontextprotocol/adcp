{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "/schemas/2.5.0/bundled/media-buy/update-media-buy-response.json",
  "title": "Update Media Buy Response",
  "description": "Response payload for update_media_buy task. Returns either complete success data OR error information, never both. This enforces atomic operation semantics - updates are either fully applied or not applied at all.",
  "type": "object",
  "oneOf": [
    {
      "title": "UpdateMediaBuySuccess",
      "description": "Success response - media buy updated successfully",
      "type": "object",
      "properties": {
        "media_buy_id": {
          "type": "string",
          "description": "Publisher's identifier for the media buy"
        },
        "buyer_ref": {
          "type": "string",
          "description": "Buyer's reference identifier for the media buy"
        },
        "implementation_date": {
          "type": [
            "string",
            "null"
          ],
          "format": "date-time",
          "description": "ISO 8601 timestamp when changes take effect (null if pending approval)"
        },
        "affected_packages": {
          "type": "array",
          "description": "Array of packages that were modified with complete state information",
          "items": {
            "title": "Package",
            "description": "A specific product within a media buy (line item)",
            "type": "object",
            "properties": {
              "package_id": {
                "type": "string",
                "description": "Publisher's unique identifier for the package"
              },
              "buyer_ref": {
                "type": "string",
                "description": "Buyer's reference identifier for this package"
              },
              "product_id": {
                "type": "string",
                "description": "ID of the product this package is based on"
              },
              "budget": {
                "type": "number",
                "description": "Budget allocation for this package in the currency specified by the pricing option",
                "minimum": 0
              },
              "pacing": {
                "title": "Pacing",
                "description": "Budget pacing strategy",
                "type": "string",
                "enum": [
                  "even",
                  "asap",
                  "front_loaded"
                ],
                "enumDescriptions": {
                  "even": "Allocate remaining budget evenly over remaining campaign duration (default)",
                  "asap": "Spend remaining budget as quickly as possible",
                  "front_loaded": "Allocate more remaining budget earlier in the remaining campaign period"
                }
              },
              "pricing_option_id": {
                "type": "string",
                "description": "ID of the selected pricing option from the product's pricing_options array"
              },
              "bid_price": {
                "type": "number",
                "description": "Bid price for auction-based CPM pricing (present if using cpm-auction-option)",
                "minimum": 0
              },
              "impressions": {
                "type": "number",
                "description": "Impression goal for this package",
                "minimum": 0
              },
              "targeting_overlay": {
                "title": "Targeting Overlay",
                "description": "Optional geographic refinements for media buys. Most targeting should be expressed in the brief and handled by the publisher. These fields are primarily for geographic restrictions (RCT testing, regulatory compliance).",
                "type": "object",
                "properties": {
                  "geo_country_any_of": {
                    "type": "array",
                    "description": "Restrict delivery to specific countries (ISO codes). Use for regulatory compliance or RCT testing.",
                    "items": {
                      "type": "string",
                      "pattern": "^[A-Z]{2}$"
                    }
                  },
                  "geo_region_any_of": {
                    "type": "array",
                    "description": "Restrict delivery to specific regions/states. Use for regulatory compliance or RCT testing.",
                    "items": {
                      "type": "string"
                    }
                  },
                  "geo_metro_any_of": {
                    "type": "array",
                    "description": "Restrict delivery to specific metro areas (DMA codes). Use for regulatory compliance or RCT testing.",
                    "items": {
                      "type": "string"
                    }
                  },
                  "geo_postal_code_any_of": {
                    "type": "array",
                    "description": "Restrict delivery to specific postal/ZIP codes. Use for regulatory compliance or RCT testing.",
                    "items": {
                      "type": "string"
                    }
                  },
                  "axe_include_segment": {
                    "type": "string",
                    "description": "AXE segment ID to include for targeting"
                  },
                  "axe_exclude_segment": {
                    "type": "string",
                    "description": "AXE segment ID to exclude from targeting"
                  },
                  "frequency_cap": {
                    "title": "Frequency Cap",
                    "description": "Frequency capping settings for package-level application",
                    "type": "object",
                    "properties": {
                      "suppress_minutes": {
                        "type": "number",
                        "description": "Minutes to suppress after impression",
                        "minimum": 0
                      }
                    },
                    "required": [
                      "suppress_minutes"
                    ],
                    "additionalProperties": false
                  }
                },
                "additionalProperties": false
              },
              "creative_assignments": {
                "type": "array",
                "description": "Creative assets assigned to this package",
                "items": {
                  "title": "Creative Assignment",
                  "description": "Assignment of a creative asset to a package with optional placement targeting. Used in create_media_buy and update_media_buy requests. Note: sync_creatives does not support placement_ids - use create/update_media_buy for placement-level targeting.",
                  "type": "object",
                  "properties": {
                    "creative_id": {
                      "type": "string",
                      "description": "Unique identifier for the creative"
                    },
                    "weight": {
                      "type": "number",
                      "description": "Delivery weight for this creative",
                      "minimum": 0,
                      "maximum": 100
                    },
                    "placement_ids": {
                      "type": "array",
                      "description": "Optional array of placement IDs where this creative should run. When omitted, the creative runs on all placements in the package. References placement_id values from the product's placements array.",
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1
                    }
                  },
                  "required": [
                    "creative_id"
                  ],
                  "additionalProperties": false
                }
              },
              "format_ids_to_provide": {
                "type": "array",
                "description": "Format IDs that creative assets will be provided for this package",
                "items": {
                  "title": "Format ID",
                  "description": "Structured format identifier with agent URL and format name. Can reference: (1) a concrete format with fixed dimensions (id only), (2) a template format without parameters (id only), or (3) a template format with parameters (id + dimensions/duration). Template formats accept parameters in format_id while concrete formats have fixed dimensions in their definition. Parameterized format IDs create unique, specific format variants.",
                  "type": "object",
                  "properties": {
                    "agent_url": {
                      "type": "string",
                      "format": "uri",
                      "description": "URL of the agent that defines this format (e.g., 'https://creatives.adcontextprotocol.org' for standard formats, or 'https://publisher.com/.well-known/adcp/sales' for custom formats)"
                    },
                    "id": {
                      "type": "string",
                      "pattern": "^[a-zA-Z0-9_-]+$",
                      "description": "Format identifier within the agent's namespace (e.g., 'display_static', 'video_hosted', 'audio_standard'). When used alone, references a template format. When combined with dimension/duration fields, creates a parameterized format ID for a specific variant."
                    },
                    "width": {
                      "type": "integer",
                      "minimum": 1,
                      "description": "Width in pixels for visual formats. When specified, height must also be specified. Both fields together create a parameterized format ID for dimension-specific variants."
                    },
                    "height": {
                      "type": "integer",
                      "minimum": 1,
                      "description": "Height in pixels for visual formats. When specified, width must also be specified. Both fields together create a parameterized format ID for dimension-specific variants."
                    },
                    "duration_ms": {
                      "type": "number",
                      "minimum": 1,
                      "description": "Duration in milliseconds for time-based formats (video, audio). When specified, creates a parameterized format ID. Omit to reference a template format without parameters."
                    }
                  },
                  "required": [
                    "agent_url",
                    "id"
                  ],
                  "additionalProperties": false,
                  "dependencies": {
                    "width": [
                      "height"
                    ],
                    "height": [
                      "width"
                    ]
                  }
                }
              },
              "paused": {
                "type": "boolean",
                "description": "Whether this package is paused by the buyer. Paused packages do not deliver impressions. Defaults to false.",
                "default": false
              },
              "ext": {
                "title": "Extension Object",
                "description": "Extension object for platform-specific, vendor-namespaced parameters. Extensions are always optional and must be namespaced under a vendor/platform key (e.g., ext.gam, ext.roku). Used for custom capabilities, partner-specific configuration, and features being proposed for standardization.",
                "type": "object",
                "additionalProperties": true
              }
            },
            "required": [
              "package_id"
            ],
            "additionalProperties": false
          }
        },
        "context": {
          "title": "Context Object",
          "description": "Opaque correlation data that is echoed unchanged in responses. Used for internal tracking, UI session IDs, trace IDs, and other caller-specific identifiers that don't affect protocol behavior. Context data is never parsed by AdCP agents - it's simply preserved and returned.",
          "type": "object",
          "additionalProperties": true
        },
        "ext": {
          "title": "Extension Object",
          "description": "Extension object for platform-specific, vendor-namespaced parameters. Extensions are always optional and must be namespaced under a vendor/platform key (e.g., ext.gam, ext.roku). Used for custom capabilities, partner-specific configuration, and features being proposed for standardization.",
          "type": "object",
          "additionalProperties": true
        }
      },
      "required": [
        "media_buy_id",
        "buyer_ref"
      ],
      "additionalProperties": false,
      "not": {
        "required": [
          "errors"
        ]
      }
    },
    {
      "title": "UpdateMediaBuyError",
      "description": "Error response - operation failed, no changes applied",
      "type": "object",
      "properties": {
        "errors": {
          "type": "array",
          "description": "Array of errors explaining why the operation failed",
          "items": {
            "title": "Error",
            "description": "Standard error structure for task-specific errors and warnings",
            "type": "object",
            "properties": {
              "code": {
                "type": "string",
                "description": "Error code for programmatic handling"
              },
              "message": {
                "type": "string",
                "description": "Human-readable error message"
              },
              "field": {
                "type": "string",
                "description": "Field path associated with the error (e.g., 'packages[0].targeting')"
              },
              "suggestion": {
                "type": "string",
                "description": "Suggested fix for the error"
              },
              "retry_after": {
                "type": "number",
                "description": "Seconds to wait before retrying the operation",
                "minimum": 0
              },
              "details": {
                "description": "Additional task-specific error details"
              }
            },
            "required": [
              "code",
              "message"
            ],
            "additionalProperties": false
          },
          "minItems": 1
        },
        "context": {
          "title": "Context Object",
          "description": "Opaque correlation data that is echoed unchanged in responses. Used for internal tracking, UI session IDs, trace IDs, and other caller-specific identifiers that don't affect protocol behavior. Context data is never parsed by AdCP agents - it's simply preserved and returned.",
          "type": "object",
          "additionalProperties": true
        },
        "ext": {
          "title": "Extension Object",
          "description": "Extension object for platform-specific, vendor-namespaced parameters. Extensions are always optional and must be namespaced under a vendor/platform key (e.g., ext.gam, ext.roku). Used for custom capabilities, partner-specific configuration, and features being proposed for standardization.",
          "type": "object",
          "additionalProperties": true
        }
      },
      "required": [
        "errors"
      ],
      "additionalProperties": false,
      "not": {
        "anyOf": [
          {
            "required": [
              "media_buy_id"
            ]
          },
          {
            "required": [
              "buyer_ref"
            ]
          },
          {
            "required": [
              "affected_packages"
            ]
          }
        ]
      }
    }
  ],
  "_bundled": {
    "generatedAt": "2025-12-17T19:25:35.448Z",
    "note": "This is a bundled schema with all $ref resolved inline. For the modular version with references, use the parent directory."
  }
}