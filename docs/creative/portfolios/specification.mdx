---
sidebar_position: 2
title: Protocol Specification
---

<Info>
**AdCP 3.0 Proposal** - This specification is under development for AdCP 3.0. Feedback welcome in the [AAO Slack](https://agenticadvertising.org).
</Info>

**Status**: Request for Comments
**Last Updated**: January 2026

## Abstract

The Portfolio Protocol defines a standard Model Context Protocol (MCP) and Agent-to-Agent (A2A) interface for stateful creative management. This protocol enables creative agents to maintain persistent creative workspaces, seller agents to fetch and request creatives on-demand, and both parties to stay synchronized through webhook-based communication.

## Conformance

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in [RFC 2119](https://www.ietf.org/rfc/rfc2119.txt).

## Overview

The Portfolio Protocol provides:

- **Stateful workspaces**: Persistent storage for source assets, brand context, and built creatives
- **On-demand building**: Seller agents can request new formats without orchestrator intervention
- **Webhook synchronization**: Bidirectional communication between creative and seller agents
- **Governance integration**: Optional review of creatives before approval
- **Tracker embedding**: Click and impression trackers baked into ad tags with macro placeholders

## Core Concepts

### Agent Roles

The Portfolio Protocol involves four agent roles. Note that a single platform may play multiple roles - for instance, a platform that generates creatives and delivers them acts as both creative agent and seller agent.

#### Creative Agent
The platform hosting portfolios and building creatives:
- **Responsibilities**: Store source assets, build creatives, serve ad tags
- **Capabilities**: Format building, creative adaptation
- **Authentication**: Issues tokens for seller agent access

#### Seller Agent
The platform receiving media buys and serving ads:
- **Responsibilities**: Accept media buys, fetch creatives, expand macros at serve time
- **Capabilities**: Format discovery, creative requests, approval management
- **Authentication**: Uses tokens from `portfolio_ref` to access portfolios

#### Governance Agent
The platform reviewing creatives for brand safety and compliance:
- **Responsibilities**: Review creatives against brand standards, approve or reject
- **Capabilities**: Content analysis, policy enforcement, compliance reporting
- **Authentication**: Receives webhooks from creative or seller agents

#### Orchestrator (Buyer Agent)
The platform coordinating media buying workflows:
- **Responsibilities**: Create portfolios, build initial creatives, create media buys
- **Capabilities**: Workflow orchestration, budget management, campaign planning
- **Authentication**: Has credentials with creative, seller, and governance agents

### Portfolio

A portfolio is a workspace containing:

| Component | Description | Required |
|-----------|-------------|----------|
| `portfolio_id` | Unique identifier | REQUIRED |
| `name` | Human-readable name | REQUIRED |
| `brand_manifest_url` | URL to live brand manifest | REQUIRED for building |
| `assets` | Source assets (images, videos, copy) | OPTIONAL |
| `trackers` | Tracker URL templates with macros | OPTIONAL |
| `creatives` | Built creatives with ad tags | Generated |
| `generation_prompt` | Default prompt for building | OPTIONAL |

### Portfolio Reference

A `portfolio_ref` in a media buy provides seller agents with access to fetch creatives:

```json
{
  "agent_url": "https://creative.example.com",
  "portfolio_id": "cs_abc123",
  "authentication": {
    "schemes": ["bearer"],
    "credentials": "eyJ..."
  }
}
```

The seller agent MUST use these credentials when calling `get_portfolio`.

### Tracker Configuration

Trackers are URL templates with macro placeholders:

```json
{
  "click": "https://track.brand.com/click?dest={LANDING_URL_ENC}&cb={CACHEBUSTER}",
  "impression": ["https://track.brand.com/imp?cb={CACHEBUSTER}"],
  "viewability": ["https://moat.com/verify.js?cb={CACHEBUSTER}"],
  "vast_events": {
    "start": ["https://track.brand.com/video/start?cb={CACHEBUSTER}"],
    "complete": ["https://track.brand.com/video/complete?cb={CACHEBUSTER}"]
  }
}
```

The creative agent MUST embed these trackers in built creatives. The seller agent MUST expand all macros at serve time.

#### Standard Macros

| Macro | Description | Expansion Responsibility |
|-------|-------------|-------------------------|
| `{CACHEBUSTER}` | Random value for cache busting | Seller |
| `{TIMESTAMP}` | Unix timestamp | Seller |
| `{LANDING_URL}` | Destination URL | Seller |
| `{LANDING_URL_ENC}` | URL-encoded destination | Seller |
| `{CREATIVE_ID}` | Creative identifier | Seller |
| `{MEDIA_BUY_ID}` | Media buy identifier | Seller |
| `{PACKAGE_ID}` | Package identifier | Seller |

## Protocol Flow

### Setup Phase

1. **Orchestrator** calls `create_portfolio` on creative agent
2. **Creative agent** creates workspace, returns `portfolio_id`
3. **Orchestrator** calls `build_creatives` for initial formats
4. **Creative agent** builds creatives, embeds trackers in ad tags

### Media Buy Phase

5. **Orchestrator** calls `create_media_buy` on seller agent with `portfolio_ref`
6. **Seller agent** sends `portfolio-attached` webhook to creative agent
7. **Creative agent** registers seller as subscriber for updates

### Fetch Phase

8. **Seller agent** calls `get_portfolio` to fetch creatives
9. **Creative agent** returns creatives filtered by requested `format_ids`
10. **Seller agent** stores ad tags for serving

### On-Demand Building Phase (Optional)

11. **Seller agent** sends `format-request` webhook for missing format
12. **Creative agent** builds format using `generation_prompt`
13. **Creative agent** sends `format-response` webhook when ready
14. **Seller agent** fetches new creative via `get_portfolio`

### Detachment Phase

15. **Seller agent** sends `portfolio-detached` webhook when media buy ends
16. **Creative agent** unsubscribes seller from updates

## Tasks

### create_portfolio

Creates a new portfolio workspace.

**Request**: See `/schemas/portfolio/create-portfolio-request.json`

**Required Fields**:
- `name`: Human-readable name
- `brand_manifest_url`: URL to live brand manifest

**Optional Fields**:
- `assets`: Source assets for building
- `trackers`: Tracker URL templates
- `push_notification_config`: Webhook config for updates

**Response**: Returns `portfolio_id` and initial state.

### get_portfolio

Retrieves a portfolio with its creatives.

**Request**: See `/schemas/portfolio/get-portfolio-request.json`

**Required Fields**:
- `portfolio_id`: Set to retrieve

**Optional Fields**:
- `format_ids`: Filter to specific formats
- `include_previews`: Include preview URLs (default: true)
- `include_ad_tags`: Include full markup (default: true)

**Response**: Returns portfolio with filtered creatives. Each creative includes a `manifest` with the ad tag as an asset.

**Behavior**:
- If `format_ids` is provided, response MUST include only matching creatives
- If a requested format doesn't exist but `allow_format_requests` is true, creative agent MAY auto-build it
- Creative agent MUST NOT return creatives with `advertiser_status` of `rejected`

### list_portfolios

Queries portfolios with filtering and pagination.

**Request**: See `/schemas/portfolio/list-portfolios-request.json`

**Optional Fields**:
- `filter`: Search, archived status, date range
- `sort`: Field and direction
- `pagination`: Limit and offset

**Response**: Returns array of portfolio summaries (metadata only, no ad tags).

### update_portfolio

Modifies a portfolio.

**Request**: See `/schemas/portfolio/update-portfolio-request.json`

**Required Fields**:
- `portfolio_id`: Set to update

**Optional Fields**:
- `name`, `description`: Update metadata
- `trackers`: Update tracker templates (triggers creative regeneration)
- `archived`: Archive/unarchive the set
- `add_creatives`: New creatives to add
- `remove_creative_ids`: Creatives to remove
- `regenerate_creative_ids`: Creatives to regenerate

**Behavior**:
- If `trackers` is updated, creative agent MUST regenerate all creatives with new trackers
- Creative agent MUST NOT archive a set connected to an active media buy
- Creative agent SHOULD notify subscribed sellers of changes

### delete_portfolio

Archives or permanently deletes a portfolio.

**Request**: See `/schemas/portfolio/delete-portfolio-request.json`

**Required Fields**:
- `portfolio_id`: Set to delete

**Optional Fields**:
- `mode`: `"archive"` (default) or `"permanent"`

**Behavior**:
- `archive` mode MUST preserve data but mark as archived
- `permanent` mode MUST delete all data
- Creative agent MUST NOT delete a set connected to an active media buy

### build_creatives

Builds creatives from source assets for specified formats.

**Request**: See `/schemas/portfolio/build-creatives-request.json`

**Required Fields**:
- `portfolio_id`: Set containing source assets
- `target_formats`: Formats to build

**Optional Fields**:
- `prompt`: Generation guidance (overrides set's `generation_prompt`)
- `asset_ids`: Subset of assets to use
- `auto_approve`: Auto-approve built creatives (default: false)

**Response**: Returns newly built creatives. Each creative MUST have trackers embedded in the ad tag.

## Webhooks

### Seller → Creative Agent

#### portfolio-attached

Sent when seller receives a media buy with `portfolio_ref`.

**Required Fields**:
- `portfolio_id`
- `media_buy_id`
- `seller_agent_url`

**Optional Fields**:
- `format_ids`: Required formats
- `callback_url`: URL for creative agent notifications

**Creative Agent Behavior**:
- MUST register seller as subscriber for this portfolio
- SHOULD store `callback_url` for sending notifications
- MAY auto-build missing formats if `allow_format_requests` is true

#### portfolio-detached

Sent when media buy ends or portfolio is replaced.

**Required Fields**:
- `portfolio_id`
- `media_buy_id`
- `seller_agent_url`

**Creative Agent Behavior**:
- MUST unsubscribe seller from updates for this media buy
- MUST stop sending webhooks to seller's callback URL

#### format-request

Sent when seller needs a format not in the portfolio.

**Required Fields**:
- `portfolio_id`
- `format_id`
- `media_buy_id`
- `seller_agent_url`

**Creative Agent Behavior**:
- MUST check `allow_format_requests` is true
- MUST build format using set's assets and `generation_prompt`
- MUST send `format-response` webhook when complete
- SHOULD respect `priority` field for queue ordering

#### adaptation-request

Sent when seller needs a variation of an existing creative.

**Required Fields**:
- `portfolio_id`
- `source_creative_id`
- `media_buy_id`
- `seller_agent_url`
- `adaptation_type`

**Creative Agent Behavior**:
- MUST check `allow_adaptation_requests` is true
- MUST create adaptation based on `adaptation_type` and `parameters`
- MUST send `adaptation-response` webhook when complete

#### creative-approval-update

Sent when seller's approval status changes for a creative.

**Required Fields**:
- `portfolio_id`
- `creative_id`
- `media_buy_id`
- `seller_agent_url`
- `status`

**Creative Agent Behavior**:
- MUST update `seller_approvals` array on the creative
- MAY notify orchestrator of approval changes

### Creative Agent → Seller

#### format-response

Sent after processing a `format-request`.

**Required Fields**:
- `portfolio_id`
- `format_id`
- `media_buy_id`
- `status`

**Status Values**:
- `ready`: Creative built and available
- `failed`: Build failed (see `error` field)
- `pending_approval`: Built but awaiting approval

**Seller Behavior**:
- If `ready`, SHOULD fetch creative via `get_portfolio`
- If `failed`, SHOULD handle gracefully or retry

#### adaptation-response

Sent after processing an `adaptation-request`.

**Required Fields**:
- `portfolio_id`
- `source_creative_id`
- `adaptation_type`
- `media_buy_id`
- `status`

## Error Handling

### Error Codes

| Code | Description |
|------|-------------|
| `CREATIVE_SET_NOT_FOUND` | Creative set does not exist |
| `CREATIVE_NOT_FOUND` | Creative does not exist in set |
| `FORMAT_NOT_SUPPORTED` | Format cannot be built from available assets |
| `FORMAT_REQUESTS_DISABLED` | `allow_format_requests` is false |
| `ADAPTATION_REQUESTS_DISABLED` | `allow_adaptation_requests` is false |
| `SET_ARCHIVED` | Cannot modify archived portfolio |
| `SET_HAS_ACTIVE_MEDIA_BUYS` | Cannot archive/delete set with active media buys |
| `AUTHENTICATION_FAILED` | Invalid or expired credentials |
| `GOVERNANCE_REJECTED` | Creative rejected by governance agent |

### Webhook Retry Policy

Creative agents SHOULD implement exponential backoff for webhook delivery:
- Initial retry: 1 minute
- Maximum retries: 5
- Backoff factor: 2x
- Maximum delay: 1 hour

Seller agents SHOULD respond with 2xx status to acknowledge receipt. Non-2xx responses SHOULD trigger retry.

## Security Considerations

### Authentication

Creative agents MUST authenticate seller access using the credentials in `portfolio_ref.authentication`. Supported schemes:
- `bearer`: Bearer token in Authorization header
- `basic`: HTTP Basic authentication
- `api_key`: API key in custom header

### Token Scope

Tokens in `portfolio_ref` SHOULD be scoped to:
- The specific `portfolio_id`
- Read-only access (cannot modify the set)
- The specific media buy duration

### Webhook Authentication

Webhook endpoints SHOULD be authenticated. Options:
- HMAC signature in headers
- Bearer token from subscription
- Mutual TLS

## Implementation Notes

### Caching

- Creative agents MAY cache brand manifests
- Seller agents SHOULD cache fetched creatives
- Cache invalidation SHOULD use webhooks, not polling

### Idempotency

- Webhook receivers MUST handle duplicate deliveries
- Use `portfolio_id` + `media_buy_id` + timestamp for deduplication

### Performance

- `get_portfolio` with `format_ids` filter SHOULD be optimized for seller polling
- Large portfolios SHOULD support pagination
- Ad tags SHOULD be pre-rendered for fast serving

## Related Specifications

- [Creative Manifests](/docs/creative/creative-manifests) - Structure of creative assets
- [Universal Macros](/docs/creative/universal-macros) - Macro reference
- [Brand Manifest](/docs/creative/brand-manifest) - Brand context specification
- [Protocol Error Handling](/docs/protocols/error-handling) - Error handling patterns
