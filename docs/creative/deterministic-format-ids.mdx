---
title: Deterministic Format IDs
---

# Deterministic Format IDs

Deterministic format IDs allow a single format definition to support multiple dimension or duration variants without creating separate format definitions for each variant. This eliminates format explosion when publishers support many similar variants.

## The Problem: Format Explosion

Without deterministic IDs, each dimension variant requires a separate format definition and format_id:

```json
{"format_id": {"agent_url": "...", "id": "display_300x250"}}
{"format_id": {"agent_url": "...", "id": "display_300x600"}}
{"format_id": {"agent_url": "...", "id": "display_728x90"}}
{"format_id": {"agent_url": "...", "id": "display_970x250"}}
// ... 50+ more sizes
```

**Publisher with 50 placement sizes** → 50 separate format definitions to create, maintain, and document.

## The Solution: Dimensions in Format ID

A single format definition (`display_static`) combined with dimension fields in the format_id object creates deterministic, unique format identifiers:

### Template Format (Non-Deterministic)

Format definition with dimension references - indicates dimensions can be specified:

```json
{
  "format_id": {
    "agent_url": "https://creative.adcontextprotocol.org",
    "id": "display_static"
  },
  "name": "Static Display Banner",
  "type": "display",
  "accepts_parameters": ["dimensions"],
  "renders": [
    {
      "role": "primary",
      "parameters_from_format_id": true
    }
  ],
  "assets_required": [
    {
      "item_type": "individual",
      "asset_id": "banner_image",
      "asset_type": "image",
      "required": true,
      "requirements": {
        "parameters_from_format_id": true
      }
    },
    {
      "item_type": "individual",
      "asset_id": "clickthrough_url",
      "asset_type": "url",
      "required": true
    }
  ]
}
```

**Key fields:**
- `accepts_parameters: ["dimensions"]` - Format accepts dimensions (width/height/unit) in format_id
- `renders[].parameters_from_format_id: true` - Render parameters come from format_id
- `requirements.parameters_from_format_id: true` - Asset parameters must match format_id

### Deterministic Format ID (Creative Manifest)

Creative specifies exact dimensions in format_id to create a concrete, unique format:

```json
{
  "format_id": {
    "agent_url": "https://creative.adcontextprotocol.org",
    "id": "display_static",
    "width": 300,
    "height": 250,
    "unit": "px"
  },
  "assets": {
    "banner_image": {
      "asset_type": "image",
      "url": "https://cdn.example.com/banner-300x250.png",
      "width": 300,
      "height": 250
    },
    "clickthrough_url": {
      "asset_type": "url",
      "url": "https://example.com/landing"
    }
  }
}
```

**This format_id is deterministic:** Same dimensions always produce the same format_id object, enabling deduplication and caching.

### Placement Constraints

Publishers can specify supported dimensions in two ways:

#### Option 1: List Specific Dimensions

```json
{
  "placement_id": "homepage_banner",
  "name": "Homepage Banner",
  "format_ids": [
    {
      "agent_url": "https://creative.adcontextprotocol.org",
      "id": "display_static",
      "width": 300,
      "height": 250,
      "unit": "px"
    },
    {
      "agent_url": "https://creative.adcontextprotocol.org",
      "id": "display_static",
      "width": 728,
      "height": 90,
      "unit": "px"
    }
  ]
}
```

**Validation:** Creative's format_id must exactly match one of the placement's format_ids.

#### Option 2: Accept Any Dimensions (Template Format)

```json
{
  "placement_id": "flexible_banner",
  "name": "Flexible Banner Slot",
  "format_ids": [
    {
      "agent_url": "https://creative.adcontextprotocol.org",
      "id": "display_static"
    }
  ]
}
```

**Validation:** Any creative with `display_static` format (regardless of dimensions) is accepted.

## Benefits

✅ **Scalability** - One format definition supports unlimited variants
✅ **Deterministic** - Same dimensions = same format_id (enables caching/deduplication)
✅ **Self-contained** - Creatives fully specify their format via format_id
✅ **Portable** - A 300×250 creative works on any placement accepting 300×250
✅ **Publisher control** - Placements specify exact dimension constraints
✅ **Type-safe** - Width/height are numbers, not encoded strings
✅ **Backward compatible** - Non-deterministic formats work unchanged

## Format ID Fields

### Visual Formats (Display, DOOH, Native)

**Fields:**
- `width` (number, minimum: 1) - Width in specified units
- `height` (number, minimum: 1) - Height in specified units
- `unit` (enum) - px, in, cm, mm, pt (defaults to 'px')

**Example:**
```json
{
  "agent_url": "https://creative.adcontextprotocol.org",
  "id": "display_static",
  "width": 300,
  "height": 250,
  "unit": "px"
}
```

### Time-Based Formats (Video, Audio)

**Fields:**
- `duration` (number, minimum: 0) - Duration in seconds

**Example:**
```json
{
  "agent_url": "https://creative.adcontextprotocol.org",
  "id": "video_hosted",
  "duration_ms": 30
}
```

### Combined (Video with Dimensions)

**Fields:**
- `width`, `height`, `unit` - Video frame dimensions
- `duration` - Video length

**Example:**
```json
{
  "agent_url": "https://creative.adcontextprotocol.org",
  "id": "video_hosted",
  "width": 1920,
  "height": 1080,
  "duration_ms": 30,
  "unit": "px"
}
```

## Format Definition Patterns

### Display Format (Flexible Dimensions)

```json
{
  "format_id": {
    "agent_url": "https://creative.adcontextprotocol.org",
    "id": "display_static"
  },
  "name": "Static Display Banner",
  "type": "display",
  "accepts_parameters": ["dimensions"],
  "renders": null,
  "assets_required": [...]
}
```

### Video Format (Flexible Duration)

```json
{
  "format_id": {
    "agent_url": "https://creative.adcontextprotocol.org",
    "id": "video_hosted"
  },
  "name": "Hosted Video",
  "type": "video",
  "accepts_duration": true,
  "renders": null,
  "assets_required": [...]
}
```

### DOOH Format (Physical Dimensions)

```json
{
  "format_id": {
    "agent_url": "https://creative.adcontextprotocol.org",
    "id": "dooh_static"
  },
  "name": "DOOH Static Display",
  "type": "dooh",
  "accepts_parameters": ["dimensions"],
  "renders": null,
  "assets_required": [...]
}
```

**Creative with physical dimensions:**
```json
{
  "format_id": {
    "agent_url": "https://creative.adcontextprotocol.org",
    "id": "dooh_static",
    "width": 48,
    "height": 14,
    "unit": "in"
  },
  "assets": {...}
}
```

## Implementation Guidelines

### For Creative Agents

**Format definitions:**
- Set `accepts_dimensions: true` for formats with flexible dimensions
- Set `accepts_duration: true` for formats with flexible duration
- Omit `renders` array when format accepts dimensions (dimensions come from format_id)
- Include `renders` array for concrete formats with fixed dimensions

**Validation:**
- Validate format_id dimensions against asset dimensions
- Ensure width/height/unit are present together (not partial)
- Return clear errors if format_id doesn't match assets

### For Sales Agents

**Product responses:**
- Reference template formats in `format_ids` array for flexible support:
  ```json
  {"agent_url": "...", "id": "display_static"}
  ```
- OR list specific deterministic formats to constrain dimensions:
  ```json
  [
    {"agent_url": "...", "id": "display_static", "width": 300, "height": 250, "unit": "px"},
    {"agent_url": "...", "id": "display_static", "width": 728, "height": 90, "unit": "px"}
  ]
  ```

**Placement definitions:**
- Use template format_ids for flexible placements
- Use deterministic format_ids to constrain exact dimensions
- Validate creative format_ids match placement constraints

**Creative validation:**
- Ensure creative format_id matches at least one placement format_id
- For template matches, verify base format (id + agent_url) matches
- For deterministic matches, verify exact equality including dimensions

### For Buyers

**Creative manifest construction:**
- Fetch format definitions to check `accepts_dimensions`/`accepts_duration`
- Include dimension/duration fields in format_id for deterministic formats
- Ensure asset dimensions match format_id dimensions
- Validate against placement format_ids before syncing

## Determinism Rules

Two format_ids are **identical** if and only if:
- `agent_url` matches exactly
- `id` matches exactly
- `width` matches exactly (if present)
- `height` matches exactly (if present)
- `unit` matches exactly (if present)
- `duration` matches exactly (if present)

**Example equivalence:**
```json
// These are IDENTICAL format IDs
{"agent_url": "...", "id": "display_static", "width": 300, "height": 250, "unit": "px"}
{"agent_url": "...", "id": "display_static", "width": 300, "height": 250, "unit": "px"}

// These are DIFFERENT format IDs
{"agent_url": "...", "id": "display_static", "width": 300, "height": 250, "unit": "px"}
{"agent_url": "...", "id": "display_static", "width": 728, "height": 90, "unit": "px"}
```

## Matching Logic

### Placement Validation

**Template format in placement:**
```json
// Placement accepts template
{"format_ids": [{"agent_url": "...", "id": "display_static"}]}

// Creative matches if base format matches (any dimensions)
{"format_id": {"agent_url": "...", "id": "display_static", "width": 300, "height": 250}}  // ✅ Match
{"format_id": {"agent_url": "...", "id": "display_static", "width": 728, "height": 90}}   // ✅ Match
{"format_id": {"agent_url": "...", "id": "video_hosted", "duration_ms": 30}}                 // ❌ Different format
```

**Deterministic format in placement:**
```json
// Placement specifies exact dimensions
{"format_ids": [
  {"agent_url": "...", "id": "display_static", "width": 300, "height": 250, "unit": "px"}
]}

// Creative matches only if exact equality
{"format_id": {"agent_url": "...", "id": "display_static", "width": 300, "height": 250, "unit": "px"}}  // ✅ Match
{"format_id": {"agent_url": "...", "id": "display_static", "width": 728, "height": 90, "unit": "px"}}   // ❌ Different dimensions
{"format_id": {"agent_url": "...", "id": "display_static"}}                                              // ❌ Missing dimensions
```

## Migration from Concrete Formats

**Before (format explosion):**
```json
// 50 separate format definitions
{
  "format_id": {"agent_url": "...", "id": "display_300x250"},
  "renders": [{"dimensions": {"width": 300, "height": 250}}]
}
{
  "format_id": {"agent_url": "...", "id": "display_728x90"},
  "renders": [{"dimensions": {"width": 728, "height": 90}}]
}
// ... 48 more
```

**After (single template format):**
```json
{
  "format_id": {"agent_url": "...", "id": "display_static"},
  "accepts_parameters": ["dimensions"],
  "assets_required": [...]
}
```

**Creative manifest change:**
```json
// Before: Format ID encoded dimensions in string
{
  "format_id": {"agent_url": "...", "id": "display_300x250"},
  "assets": {...}
}

// After: Dimensions as structured fields in format_id
{
  "format_id": {
    "agent_url": "...",
    "id": "display_static",
    "width": 300,
    "height": 250,
    "unit": "px"
  },
  "assets": {...}
}
```

## Common Patterns

### IAB Standard Display Sizes

Instead of defining 15 separate formats for IAB sizes, use one template:

```json
{
  "format_id": {"agent_url": "...", "id": "display_static"},
  "accepts_parameters": ["dimensions"]
}
```

Creatives specify their size deterministically:
- 300×250: `{id: "display_static", width: 300, height: 250, unit: "px"}`
- 728×90: `{id: "display_static", width: 728, height: 90, unit: "px"}`
- 160×600: `{id: "display_static", width: 160, height: 600, unit: "px"}`
- etc.

### Video Duration Variants

Instead of separate 15s, 30s, 60s format definitions:

```json
{
  "format_id": {"agent_url": "...", "id": "video_hosted"},
  "accepts_duration": true
}
```

Creatives specify duration: `{id: "video_hosted", duration_ms: 30000}`

### DOOH Screen Sizes

Instead of defining formats for every billboard size:

```json
{
  "format_id": {"agent_url": "...", "id": "dooh_static"},
  "accepts_parameters": ["dimensions"]
}
```

Creatives specify physical dimensions: `{id: "dooh_static", width: 48, height: 14, unit: "in"}`

## See Also

- [Creative Manifests](/docs/creative/creative-manifests) - Complete manifest structure
- [Format Discovery](/docs/creative/formats) - How buyers discover formats
- [Placement Targeting](/docs/media-buy/creatives) - Assigning creatives to placements
