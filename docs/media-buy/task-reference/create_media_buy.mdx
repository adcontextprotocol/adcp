---
title: create_media_buy
sidebar_position: 3
testable: true
---

# create_media_buy

Create a media buy from selected packages. Handles validation, approval if needed, and campaign creation.

**Response Time**: Instant to days (returns `completed`, `working` < 120s, or `submitted` for hours/days)

**Request Schema**: [`/schemas/v2/media-buy/create-media-buy-request.json`](https://adcontextprotocol.org/schemas/v2/media-buy/create-media-buy-request.json)
**Response Schema**: [`/schemas/v2/media-buy/create-media-buy-response.json`](https://adcontextprotocol.org/schemas/v2/media-buy/create-media-buy-response.json)

## Quick Start

Create a simple media buy with two packages:

<CodeGroup>

```javascript JavaScript
import { testAgent } from '@adcp/client/testing';

const result = await testAgent.createMediaBuy({
  buyer_ref: 'summer_campaign_2025',
  brand_manifest: {
    name: 'Nike',
    url: 'https://nike.com'
  },
  packages: [
    {
      buyer_ref: 'display_package_1',
      product_id: 'prod_d979b543',
      pricing_option_id: 'cpm_usd_auction',
      format_ids: [
        {
          agent_url: 'https://creative.adcontextprotocol.org',
          id: 'display_300x250_image'
        }
      ],
      budget: 30000,
      bid_price: 5.00
    },
    {
      buyer_ref: 'display_package_2',
      product_id: 'prod_e8fd6012',
      pricing_option_id: 'cpm_usd_auction',
      format_ids: [
        {
          agent_url: 'https://creative.adcontextprotocol.org',
          id: 'display_300x250_html'
        }
      ],
      budget: 20000,
      bid_price: 4.50
    }
  ],
  start_time: '2025-06-01T00:00:00Z',
  end_time: '2025-08-31T23:59:59Z'
});

// Check for errors (discriminated union response)
if (result.errors) {
  console.error('Failed to create media buy:', result.errors);
} else {
  console.log(`Created media buy ${result.media_buy_id}`);
  console.log(`Upload creatives by: ${result.creative_deadline}`);
  console.log(`Packages created: ${result.packages.length}`);
}
```

```python Python
import asyncio
from adcp import test_agent

async def create_campaign():
    result = await test_agent.simple.create_media_buy(
        buyer_ref='summer_campaign_2025',
        brand_manifest={
            'name': 'Nike',
            'url': 'https://nike.com'
        },
        packages=[
            {
                'buyer_ref': 'ctv_package',
                'product_id': 'prod_d979b543',
                'pricing_option_id': 'cpm_usd_auction',
                'format_ids': [
                    {
                        'agent_url': 'https://creative.adcontextprotocol.org',
                        'id': 'display_300x250_image'
                    }
                ],
                'budget': 30000
            },
            {
                'buyer_ref': 'audio_package',
                'product_id': 'prod_e8fd6012',
                'pricing_option_id': 'cpm_usd_auction',
                'format_ids': [
                    {
                        'agent_url': 'https://creative.adcontextprotocol.org',
                        'id': 'display_300x250_html'
                    }
                ],
                'budget': 20000
            }
        ],
        start_time='2025-06-01T00:00:00Z',
        end_time='2025-08-31T23:59:59Z'
    )

    # Check for errors (discriminated union response)
    if hasattr(result, 'errors') and result.errors:
        print('Failed to create media buy:', result.errors)
    else:
        print(f"Created media buy {result.media_buy_id}")
        print(f"Upload creatives by: {result.creative_deadline}")
        print(f"Packages created: {len(result.packages)}")

asyncio.run(create_campaign())
```

```bash CLI
npx adcp \
  https://test-agent.adcontextprotocol.org/mcp \
  create_media_buy \
  '{"buyer_ref":"summer_campaign_2025","brand_manifest":{"name":"Nike","url":"https://nike.com"},"packages":[{"buyer_ref":"display_package_1","product_id":"prod_d979b543","pricing_option_id":"cpm_usd_auction","format_ids":[{"agent_url":"https://creative.adcontextprotocol.org","id":"display_300x250_image"}],"budget":30000,"bid_price":5.00},{"buyer_ref":"display_package_2","product_id":"prod_e8fd6012","pricing_option_id":"cpm_usd_auction","format_ids":[{"agent_url":"https://creative.adcontextprotocol.org","id":"display_300x250_html"}],"budget":20000,"bid_price":4.50}],"start_time":"2025-06-01T00:00:00Z","end_time":"2025-08-31T23:59:59Z"}' \
  --auth 1v8tAhASaUYYp4odoQ1PnMpdqNaMiTrCRqYo9OJp6IQ
```

</CodeGroup>

## Request Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `buyer_ref` | string | Yes | Your reference identifier for this media buy |
| `packages` | Package[] | Yes | Array of package configurations (see below) |
| `brand_manifest` | BrandManifestRef | Yes | Brand identity - minimal (name/URL) acceptable for sales agents. See [Brand Manifest](/docs/creative/brand-manifest) |
| `start_time` | string | Yes | `"asap"` or ISO 8601 date-time |
| `end_time` | string | Yes | ISO 8601 date-time (UTC unless timezone specified) |
| `po_number` | string | No | Purchase order number |
| `reporting_webhook` | ReportingWebhook | No | Automated reporting delivery configuration |

### Package Object

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `buyer_ref` | string | Yes | Your reference for this package |
| `product_id` | string | Yes | Product ID from `get_products` |
| `pricing_option_id` | string | Yes | Pricing option ID from product's `pricing_options` array |
| `format_ids` | FormatID[] | Yes | Format IDs that will be used - must be supported by product |
| `budget` | number | Yes | Budget in currency specified by pricing option |
| `pacing` | string | No | `"even"` (default), `"asap"`, or `"front_loaded"` |
| `bid_price` | number | No | Bid price for auction pricing (required when `is_fixed` is false) |
| `targeting_overlay` | TargetingOverlay | No | Additional targeting criteria (see [Targeting](/docs/media-buy/advanced-topics/targeting)) |
| `creative_ids` | string[] | No | Existing library creative IDs to assign |
| `creatives` | CreativeAsset[] | No | Full creative objects to upload and assign |

## Response

### Success Response

| Field | Description |
|-------|-------------|
| `media_buy_id` | Publisher's unique identifier |
| `buyer_ref` | Your reference identifier |
| `creative_deadline` | ISO 8601 timestamp for creative upload deadline |
| `packages` | Array of created packages with complete state |

### Error Response

| Field | Description |
|-------|-------------|
| `errors` | Array of error objects explaining failure |

**Note**: Responses use discriminated unions - you get either success fields OR errors, never both. Always check for `errors` before accessing success fields.

## Common Scenarios

### Campaign with Targeting

Add geographic restrictions and frequency capping:

<CodeGroup>

```javascript JavaScript
import { testAgent } from '@adcp/client/testing';

const result = await testAgent.createMediaBuy({
  buyer_ref: 'regional_campaign_2025',
  brand_manifest: {
    name: 'Regional Retailer',
    url: 'https://example-retailer.com'
  },
  packages: [{
    buyer_ref: 'ctv_regional',
    product_id: 'prod_d979b543',
    pricing_option_id: 'cpm_usd_auction',
    format_ids: [{
      agent_url: 'https://creative.adcontextprotocol.org',
      id: 'display_300x250_image'
    }],
    budget: 50000,
    targeting_overlay: {
      geo_country_any_of: ['US'],
      geo_region_any_of: ['CA', 'NY'],
      frequency_cap: {
        suppress_minutes: 60
      }
    }
  }],
  start_time: 'asap',
  end_time: '2025-12-31T23:59:59Z'
});

if (result.errors) {
  console.error('Creation failed:', result.errors);
} else {
  console.log(`Campaign ${result.media_buy_id} created with targeting`);
}
```

```python Python
import asyncio
from adcp import test_agent

async def create_targeted_campaign():
    result = await test_agent.simple.create_media_buy(
        buyer_ref='regional_campaign_2025',
        brand_manifest={
            'name': 'Regional Retailer',
            'url': 'https://example-retailer.com'
        },
        packages=[{
            'buyer_ref': 'ctv_regional',
            'product_id': 'ctv_sports_premium',
            'pricing_option_id': 'cpm-fixed-sports',
            'format_ids': [{
                'agent_url': 'https://creative.adcontextprotocol.org',
                'id': 'video_standard_30s'
            }],
            'budget': 50000,
            'targeting_overlay': {
                'geo_country_any_of': ['US'],
                'geo_region_any_of': ['CA', 'NY'],
                'frequency_cap': {
                    'suppress_minutes': 60
                }
            }
        }],
        start_time='asap',
        end_time='2025-12-31T23:59:59Z'
    )

    if hasattr(result, 'errors') and result.errors:
        print('Creation failed:', result.errors)
    else:
        print(f"Campaign {result.media_buy_id} created with targeting")

asyncio.run(create_targeted_campaign())
```

</CodeGroup>

### Campaign with Inline Creatives

Upload creatives at the same time as creating the campaign:

<CodeGroup>

```javascript JavaScript
import { testAgent } from '@adcp/client/testing';

const result = await testAgent.createMediaBuy({
  buyer_ref: 'campaign_with_creatives',
  brand_manifest: {
    name: 'Nike',
    url: 'https://nike.com'
  },
  packages: [{
    buyer_ref: 'ctv_package',
    product_id: 'prod_d979b543',
    pricing_option_id: 'cpm_usd_auction',
    format_ids: [{
      agent_url: 'https://creative.adcontextprotocol.org',
      id: 'display_300x250_image'
    }],
    budget: 30000,
    creatives: [{
      creative_id: 'hero_video_30s',
      name: 'Hero Video',
      format_id: {
        agent_url: 'https://creative.adcontextprotocol.org',
        id: 'display_300x250_image'
      },
      assets: {
        video: {
          url: 'https://cdn.example.com/hero-30s.mp4',
          width: 1920,
          height: 1080,
          duration_ms: 30000
        }
      }
    }]
  }],
  start_time: 'asap',
  end_time: '2025-12-31T23:59:59Z'
});

if (result.errors) {
  console.error('Creation failed:', result.errors);
} else {
  console.log(`Campaign created with ${result.packages[0].creative_assignments.length} creatives`);
}
```

```python Python
import asyncio
from adcp import test_agent

async def create_with_creatives():
    result = await test_agent.simple.create_media_buy(
        buyer_ref='campaign_with_creatives',
        brand_manifest={
            'name': 'Nike',
            'url': 'https://nike.com'
        },
        packages=[{
            'buyer_ref': 'ctv_package',
            'product_id': 'ctv_sports_premium',
            'pricing_option_id': 'cpm-fixed-sports',
            'format_ids': [{
                'agent_url': 'https://creative.adcontextprotocol.org',
                'id': 'video_standard_30s'
            }],
            'budget': 30000,
            'creatives': [{
                'creative_id': 'hero_video_30s',
                'name': 'Hero Video',
                'format_id': {
                    'agent_url': 'https://creative.adcontextprotocol.org',
                    'id': 'video_standard_30s'
                },
                'assets': {
                    'video': {
                        'url': 'https://cdn.example.com/hero-30s.mp4',
                        'width': 1920,
                        'height': 1080,
                        'duration_ms': 30000
                    }
                }
            }]
        }],
        start_time='asap',
        end_time='2025-12-31T23:59:59Z'
    )

    if hasattr(result, 'errors') and result.errors:
        print('Creation failed:', result.errors)
    else:
        print(f"Campaign created with {len(result.packages[0].creative_assignments)} creatives")

asyncio.run(create_with_creatives())
```

</CodeGroup>

### Campaign with Reporting Webhook

Receive automated reporting notifications:

<CodeGroup>

```javascript JavaScript
import { testAgent } from '@adcp/client/testing';

const result = await testAgent.createMediaBuy({
  buyer_ref: 'campaign_with_reporting',
  brand_manifest: {
    name: 'Nike',
    url: 'https://nike.com'
  },
  packages: [{
    buyer_ref: 'ctv_package',
    product_id: 'prod_d979b543',
    pricing_option_id: 'cpm_usd_auction',
    format_ids: [{
      agent_url: 'https://creative.adcontextprotocol.org',
      id: 'display_300x250_image'
    }],
    budget: 30000
  }],
  start_time: 'asap',
  end_time: '2025-12-31T23:59:59Z',
  reporting_webhook: {
    url: 'https://buyer.example.com/webhooks/reporting',
    authentication: {
      schemes: ['Bearer'],
      credentials: 'secret_token_xyz_minimum_32_chars'
    },
    reporting_frequency: 'daily',
    requested_metrics: ['impressions', 'spend', 'video_completions']
  }
});

if (result.errors) {
  console.error('Creation failed:', result.errors);
} else {
  console.log(`Campaign created - daily reports will be sent to webhook`);
}
```

```python Python
import asyncio
from adcp import test_agent

async def create_with_reporting():
    result = await test_agent.simple.create_media_buy(
        buyer_ref='campaign_with_reporting',
        brand_manifest={
            'name': 'Nike',
            'url': 'https://nike.com'
        },
        packages=[{
            'buyer_ref': 'ctv_package',
            'product_id': 'ctv_sports_premium',
            'pricing_option_id': 'cpm-fixed-sports',
            'format_ids': [{
                'agent_url': 'https://creative.adcontextprotocol.org',
                'id': 'video_standard_30s'
            }],
            'budget': 30000
        }],
        start_time='asap',
        end_time='2025-12-31T23:59:59Z',
        reporting_webhook={
            'url': 'https://buyer.example.com/webhooks/reporting',
            'authentication': {
                'schemes': ['Bearer'],
                'credentials': 'secret_token_xyz_minimum_32_chars'
            },
            'reporting_frequency': 'daily',
            'requested_metrics': ['impressions', 'spend', 'video_completions']
        }
    )

    if hasattr(result, 'errors') and result.errors:
        print('Creation failed:', result.errors)
    else:
        print('Campaign created - daily reports will be sent to webhook')

asyncio.run(create_with_reporting())
```

</CodeGroup>

## Error Handling

Common errors and resolutions:

| Error Code | Description | Resolution |
|------------|-------------|------------|
| `PRODUCT_NOT_FOUND` | Invalid product_id | Verify product exists via `get_products` |
| `FORMAT_INCOMPATIBLE` | Format not supported by product | Check product's `format_ids` field |
| `BUDGET_INSUFFICIENT` | Budget below product minimum | Increase budget or choose different product |
| `TARGETING_TOO_NARROW` | Targeting yields zero inventory | Broaden geographic or audience criteria |
| `POLICY_VIOLATION` | Brand/product violates policy | Review publisher's content policies |
| `INVALID_PRICING_OPTION` | pricing_option_id not found | Use ID from product's `pricing_options` |

Example error response:

```json
{
  "errors": [{
    "code": "FORMAT_INCOMPATIBLE",
    "message": "Product 'prod_d979b543' does not support format 'display_728x90'",
    "field": "packages[0].format_ids",
    "suggestion": "Use display_300x250_image, display_300x250_html, or display_300x250_generative formats"
  }]
}
```

## Key Concepts

### Format Specification

Format IDs are **required** for each package because:
- Publishers create placeholder creatives in ad servers
- Both parties know exactly what creative assets are needed
- Validation ensures products support requested formats
- Progress tracking shows which assets are missing

See [Format Workflow](#format-workflow) below for complete details.

### Brand Manifest

The `brand_manifest` field identifies the advertiser for policy compliance and business purposes.

**Minimal manifests are acceptable** for sales agents:

```json
{
  "brand_manifest": {
    "name": "ACME Corporation",
    "url": "https://acmecorp.com"
  }
}
```

Full manifests with colors, fonts, and product catalogs are only needed for creative generation. See [Brand Manifest](/docs/creative/brand-manifest).

### Pricing & Currency

Each package specifies its `pricing_option_id`, which determines:
- Currency (USD, EUR, etc.)
- Pricing model (CPM, CPCV, CPP, etc.)
- Rate and whether it's fixed or auction-based

Packages can use different currencies when sellers support it. See [Pricing Models](/docs/media-buy/advanced-topics/pricing-models).

### Targeting Overlays

**Use sparingly** - most targeting should be in your brief and handled through product selection.

Use overlays only for:
- Geographic restrictions (RCT testing, regulatory compliance)
- Frequency capping
- AXE segment inclusion/exclusion

See [Targeting](/docs/media-buy/advanced-topics/targeting) for details.

## Format Workflow

### Why Format Specification Matters

When creating a media buy, format specification enables:

1. **Placeholder Creation** - Publisher creates placeholders in ad server with correct specs
2. **Validation** - System validates products support requested formats
3. **Clear Expectations** - Both parties know exactly what's needed
4. **Progress Tracking** - Track which assets are missing vs. required
5. **Technical Setup** - Ad server configured before creatives arrive

### Complete Workflow

```
1. list_creative_formats → Get available format specifications
2. get_products → Find products (returns format_ids they support)
3. Validate compatibility → Ensure products support desired formats
4. create_media_buy → Specify formats (REQUIRED)
   └── Publisher creates placeholders
   └── Clear creative requirements established
5. sync_creatives → Upload actual files matching formats
6. Campaign activation → Replace placeholders with real creatives
```

### Format Validation

Publishers MUST validate:
- All formats are supported by the product
- Format specifications match `list_creative_formats` output
- Creative requirements can be fulfilled within timeline

Invalid format example:

```json
{
  "errors": [{
    "code": "FORMAT_INCOMPATIBLE",
    "message": "Product 'ctv_sports_premium' does not support format 'audio_standard_30s'",
    "field": "packages[0].format_ids",
    "supported_formats": [
      { "agent_url": "https://creative.adcontextprotocol.org", "id": "video_standard_30s" },
      { "agent_url": "https://creative.adcontextprotocol.org", "id": "video_standard_15s" }
    ]
  }]
}
```

## Asynchronous Operations

This operation can complete instantly or take days depending on complexity and approval requirements.

### Response Patterns

**Synchronous (completed immediately)**:
```json
{
  "media_buy_id": "mb_12345",
  "buyer_ref": "summer_campaign_2025",
  "packages": []
}
```

**Asynchronous (processing)**:
```json
{
  "status": "working",
  "message": "Creating media buy..."
}
```
Poll for completion or use webhooks/streaming.

**Manual Approval Required**:
```json
{
  "status": "submitted",
  "message": "Large budget requires sales approval (2-4 hours)"
}
```
Will take hours to days.

### Protocol-Specific Handling

AdCP tasks work across multiple protocols (MCP, A2A, REST). Each protocol handles async operations differently:

- **Status checking**: Polling, webhooks, or streaming
- **Updates**: Protocol-specific mechanisms
- **Long-running tasks**: Different timeout and notification patterns

See [Task Management](/docs/protocols/task-management) for protocol-specific async patterns and examples.

## Webhook Payloads (Async Updates)

When `create_media_buy` returns `status: "submitted"`, webhooks are triggered for status changes. The webhook payload follows **A2A Protocol's push notification payload structure** (A2A Specification Section 4.3.3). The payload is a **StreamResponse object** containing exactly one of: `statusUpdate` (for status changes), `task` (for final completion), `message`, or `artifactUpdate`.

ADCP declares only the structure of `parts[].data` (DataPart data field) within Message objects. The following specifies what `parts.data` should contain for each status in `create_media_buy` webhook payloads:

**Important**: `buyer_ref` is required in all webhook payloads for `create_media_buy` tool (all statuses) to enable media buy identification. This allows buyers to correlate webhook notifications with their internal systems without needing to store `taskId` mappings.

**Schema References:**

**Top-Level Webhook Payload Schema:**
- [`/schemas/v2/core/webhook-payload.json`](https://adcontextprotocol.org/schemas/v2/core/webhook-payload.json) - Complete A2A StreamResponse structure containing `statusUpdate`, `task`, `message`, or `artifactUpdate`

### Status: `input-required`

**Schema**: [`/schemas/v2/media-buy/create-media-buy-async-response-input-required.json`](https://adcontextprotocol.org/schemas/v2/media-buy/create-media-buy-async-response-input-required.json) - Defines the structure of `parts[].data` for this status.

When additional input or fixes are required (e.g., bid price too low, budget below minimum), the webhook uses `statusUpdate` with `parts.data` containing:

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `buyer_ref` | string | Yes | Buyer's reference identifier for the media buy requiring input or fixes |
| `errors` | Error[] | Yes | Array of error objects explaining what input or fixes are needed |

**Example `parts.data` for `input-required`:**
```json
{
  "buyer_ref": "nike_q1_campaign_2024",
  "errors": [
    {
      "code": "BID_PRICE_TOO_LOW",
      "message": "Bid price $2.50 is below the minimum floor of $5.00 for this auction-based product. Please increase bid_price to at least $5.00.",
      "field": "packages[0].bid_price",
      "suggestion": "Set bid_price to at least $5.00 to participate in the auction"
    }
  ]
}
```

**Full webhook payload example:**
```json
{
  "statusUpdate": {
    "taskId": "task_456",
    "contextId": "ctx_abc123",
    "status": {
      "state": "input-required",
      "timestamp": "2025-01-22T10:15:00Z",
      "message": {
        "messageId": "msg_456_001",
        "role": "agent",
        "parts": [
          {
            "text": "Bid price $2.50 is below the minimum floor. Please increase to at least $5.00."
          },
          {
            "data": {
              "buyer_ref": "nike_q1_campaign_2024",
              "errors": [
                {
                  "code": "BID_PRICE_TOO_LOW",
                  "message": "Bid price $2.50 is below the minimum floor of $5.00 for this auction-based product. Please increase bid_price to at least $5.00.",
                  "field": "packages[0].bid_price",
                  "suggestion": "Set bid_price to at least $5.00 to participate in the auction"
                }
              ]
            }
          }
        ]
      }
    },
    "final": false
  }
}
```

### Status: `completed`

**Schema**: [`/schemas/v2/media-buy/create-media-buy-response.json`](https://adcontextprotocol.org/schemas/v2/media-buy/create-media-buy-response.json) - Defines the structure of `parts[].data` for this status.

When the media buy is successfully created, the webhook may use either `statusUpdate` or `task` variant. The `parts.data` contains the full success response matching the synchronous response schema:

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `media_buy_id` | string | Yes | Publisher's unique identifier for the created media buy |
| `buyer_ref` | string | Yes | Buyer's reference identifier for this media buy |
| `creative_deadline` | string | Yes | ISO 8601 timestamp for creative upload deadline |
| `packages` | Package[] | Yes | Array of created packages with complete state information |
| `context` | Context | No | Application-level context (if provided in request) |
| `ext` | object | No | Extension fields (if provided in request) |

**Example `parts.data` for `completed`:**
```json
{
  "media_buy_id": "mb_12345",
  "buyer_ref": "nike_q1_campaign_2024",
  "creative_deadline": "2024-01-30T23:59:59Z",
  "packages": [
    {
      "package_id": "pkg_12345_001",
      "buyer_ref": "nike_ctv_package",
      "product_id": "ctv_sports_premium",
      "budget": 60000,
      "pacing": "even",
      "pricing_option_id": "cpm-fixed-sports",
      "paused": false,
      "creative_assignments": [],
      "format_ids_to_provide": [
        {
          "agent_url": "https://creative.adcontextprotocol.org",
          "id": "video_standard_30s"
        }
      ]
    }
  ]
}
```

**Full webhook payload example (using `task` variant):**
```json
{
  "task": {
    "id": "task_456",
    "contextId": "ctx_abc123",
    "status": {
      "state": "completed",
      "timestamp": "2025-01-22T10:30:00Z",
      "message": {
        "messageId": "msg_456_002",
        "role": "agent",
        "parts": [
          {
            "text": "Media buy created successfully with 2 packages ready for creative assignment"
          },
          {
            "data": {
              "media_buy_id": "mb_12345",
              "buyer_ref": "nike_q1_campaign_2024",
              "creative_deadline": "2024-01-30T23:59:59Z",
              "packages": [
                {
                  "package_id": "pkg_12345_001",
                  "buyer_ref": "nike_ctv_package",
                  "product_id": "ctv_sports_premium",
                  "budget": 60000,
                  "pacing": "even",
                  "pricing_option_id": "cpm-fixed-sports",
                  "paused": false,
                  "creative_assignments": [],
                  "format_ids_to_provide": [
                    {
                      "agent_url": "https://creative.adcontextprotocol.org",
                      "id": "video_standard_30s"
                    }
                  ]
                }
              ]
            }
          }
        ]
      }
    }
  }
}
```

### Status: `failed`

**Schema**: [`/schemas/v2/media-buy/create-media-buy-async-response-failed.json`](https://adcontextprotocol.org/schemas/v2/media-buy/create-media-buy-async-response-failed.json) - Defines the structure of `parts[].data` for this status.

When the operation fails, the webhook uses `statusUpdate` with `parts.data` containing:

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `buyer_ref` | string | Yes | Buyer's reference identifier for the media buy that failed (required for identification) |
| `errors` | Error[] | Yes | Array of error objects explaining why the operation failed |

**Example `parts.data` for `failed`:**
```json
{
  "buyer_ref": "nike_q1_campaign_2024",
  "errors": [
    {
      "code": "PRODUCT_NOT_FOUND",
      "message": "Product 'prod_invalid' not found",
      "field": "packages[0].product_id"
    },
    {
      "code": "FORMAT_INCOMPATIBLE",
      "message": "Product 'prod_d979b543' does not support format 'display_728x90'",
      "field": "packages[0].format_ids",
      "suggestion": "Use display_300x250_image, display_300x250_html, or display_300x250_generative formats"
    }
  ]
}
```

**Full webhook payload example:**
```json
{
  "statusUpdate": {
    "taskId": "task_789",
    "contextId": "ctx_abc123",
    "status": {
      "state": "failed",
      "timestamp": "2025-01-22T10:46:00Z",
      "message": {
        "messageId": "msg_789_001",
        "role": "agent",
        "parts": [
          {
            "text": "Media buy creation failed due to validation errors"
          },
          {
            "data": {
              "buyer_ref": "nike_q1_campaign_2024",
              "errors": [
                {
                  "code": "PRODUCT_NOT_FOUND",
                  "message": "Product 'prod_invalid' not found",
                  "field": "packages[0].product_id"
                }
              ]
            }
          }
        ]
      }
    },
    "final": true
  }
}
```

### Status: `working`

**Schema**: [`/schemas/v2/media-buy/create-media-buy-async-response-working.json`](https://adcontextprotocol.org/schemas/v2/media-buy/create-media-buy-async-response-working.json) - Defines the structure of `parts[].data` for this status.

When the operation is actively processing (typically < 120 seconds), the webhook uses `statusUpdate` with `parts.data` containing:

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `buyer_ref` | string | Yes | Buyer's reference identifier for the media buy being processed. Required for identifying which media buy is being processed. |

**Example webhook payload:**
```json
{
  "statusUpdate": {
    "taskId": "task_456",
    "contextId": "ctx_abc123",
    "status": {
      "state": "working",
      "timestamp": "2025-01-22T10:20:00Z",
      "message": {
        "messageId": "msg_456_003",
        "role": "agent",
        "parts": [
          {
            "text": "Validating packages and creating media buy..."
          },
          {
            "data": {
              "buyer_ref": "nike_q1_campaign_2024"
            }
          }
        ]
      }
    },
    "final": false
  }
}
```

**Note**: `buyer_ref` is required in `parts.data` for `working` status to enable operation identification. The TextPart provides human-readable progress information.

### Status: `submitted`

When the operation is submitted for long-running processing (hours to days), the initial response returns `status: "submitted"`. Webhooks will be triggered for subsequent status changes (`input-required`, `completed`, `failed`). The `submitted` status itself does not trigger a webhook.

### Summary

| Status | StreamResponse Variant | `parts.data` Contents | Required Fields |
|--------|----------------------|----------------------|----------------|
| `input-required` | `statusUpdate` | `buyer_ref`, `errors[]` | Both required |
| `completed` | `task` or `statusUpdate` | Full success response matching `create-media-buy-response.json` | `media_buy_id`, `buyer_ref`, `packages` |
| `failed` | `statusUpdate` | `buyer_ref`, `errors[]` | Both required |
| `working` | `statusUpdate` | `buyer_ref` | `buyer_ref` required |
| `submitted` | N/A (initial response only) | N/A | N/A |

**Important**: `buyer_ref` is required in all webhook payloads for `create_media_buy` tool to enable media buy identification and correlation with the buyer's internal systems. This applies to all statuses: `input-required`, `failed`, `working`, and etc.

**Reference**: See [Webhook Payload Schema](/schemas/v2/core/webhook-payload.json) and [Task Management](/docs/protocols/task-management) for complete webhook handling examples.

## Usage Notes

- Total budget is distributed across packages based on individual `budget` values
- Both media buys and packages have `buyer_ref` fields for tracking
- Creative assets must be uploaded before deadline for campaign activation
- AXE segments enable advanced audience targeting
- Pending states (`working`, `submitted`) are normal, not errors
- Orchestrators MUST handle pending states as part of normal workflow

## Policy Compliance

Brand and products are validated during creation. Policy violations return errors:

```json
{
  "errors": [{
    "code": "POLICY_VIOLATION",
    "message": "Brand or product category not permitted on this publisher",
    "field": "brand_manifest",
    "suggestion": "Contact publisher for category approval process"
  }]
}
```

Publishers should ensure:
- Brand/products align with selected packages
- Creatives match declared brand/products
- Campaign complies with all advertising policies

## Next Steps

After creating a media buy:

1. **Upload Creatives**: Use [`sync_creatives`](/docs/media-buy/task-reference/sync_creatives) before deadline
2. **Monitor Status**: Use [`get_media_buy_delivery`](/docs/media-buy/task-reference/get_media_buy_delivery)
3. **Optimize**: Use [`provide_performance_feedback`](/docs/media-buy/task-reference/provide_performance_feedback)
4. **Update**: Use [`update_media_buy`](/docs/media-buy/task-reference/update_media_buy) to modify campaign

## Learn More

- [Media Buy Lifecycle](/docs/media-buy/media-buys/) - Complete campaign workflow
- [get_products](/docs/media-buy/task-reference/get_products) - Discover inventory
- [Targeting](/docs/media-buy/advanced-topics/targeting) - Targeting strategies
- [Pricing Models](/docs/media-buy/advanced-topics/pricing-models) - Currency and pricing
