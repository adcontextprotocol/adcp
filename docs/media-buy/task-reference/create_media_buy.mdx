---
title: create_media_buy
sidebar_position: 3
---

# create_media_buy

Create a media buy from selected products. Handles validation, optional approval workflows, and campaign creation.

**Response Time**: Instant to days (status: `completed`, `working` < 120s, or `submitted` for manual review)

**Format Specification Required**: Each package must specify creative formats for placeholder creation and asset requirements.

**Request Schema**: [`/schemas/v1/media-buy/create-media-buy-request.json`](https://adcontextprotocol.org/schemas/v1/media-buy/create-media-buy-request.json)
**Response Schema**: [`/schemas/v1/media-buy/create-media-buy-response.json`](https://adcontextprotocol.org/schemas/v1/media-buy/create-media-buy-response.json)

## Quick Start

Create a media buy from a discovered product:

<CodeGroup>

```javascript JavaScript test=true
import { ADCPMultiAgentClient } from '@adcp/client';

const client = new ADCPMultiAgentClient([{
  id: 'test-agent',
  agent_uri: 'https://test-agent.adcontextprotocol.org/mcp',
  protocol: 'mcp',
  auth: {
    type: 'bearer',
    token: '1v8tAhASaUYYp4odoQ1PnMpdqNaMiTrCRqYo9OJp6IQ'
  }
}]);

const agent = client.agent('test-agent');

// First, discover products
const discovery = await agent.getProducts({
  brief: 'Premium video inventory for athletic footwear',
  brand_manifest: {
    name: 'Nike',
    url: 'https://nike.com'
  }
});

// Create media buy with first product
const product = discovery.products[0];
const mediaBuy = await agent.createMediaBuy({
  buyer_ref: 'nike-q1-2024',
  brand_manifest: {
    name: 'Nike',
    url: 'https://nike.com'
  },
  packages: [{
    buyer_ref: 'package-1',
    product_id: product.product_id,
    pricing_option_id: product.pricing_options[0].pricing_option_id,
    format_ids: product.format_ids,
    budget: 10000
  }],
  start_time: 'asap',
  end_time: '2024-12-31T23:59:59Z'
});

console.log(`Media buy created: ${mediaBuy.media_buy_id}`);
```

```python Python test=true
from adcp import ADCPMultiAgentClient

client = ADCPMultiAgentClient([{
    'id': 'test-agent',
    'agent_uri': 'https://test-agent.adcontextprotocol.org/mcp',
    'protocol': 'mcp',
    'auth': {
        'type': 'bearer',
        'token': '1v8tAhASaUYYp4odoQ1PnMpdqNaMiTrCRqYo9OJp6IQ'
    }
}])

agent = client.agent('test-agent')

# First, discover products
discovery = agent.get_products(
    brief='Premium video inventory for athletic footwear',
    brand_manifest={
        'name': 'Nike',
        'url': 'https://nike.com'
    }
)

# Create media buy with first product
product = discovery['products'][0]
media_buy = agent.create_media_buy(
    buyer_ref='nike-q1-2024',
    brand_manifest={
        'name': 'Nike',
        'url': 'https://nike.com'
    },
    packages=[{
        'buyer_ref': 'package-1',
        'product_id': product['product_id'],
        'pricing_option_id': product['pricing_options'][0]['pricing_option_id'],
        'format_ids': product['format_ids'],
        'budget': 10000
    }],
    start_time='asap',
    end_time='2024-12-31T23:59:59Z'
)

print(f"Media buy created: {media_buy['media_buy_id']}")
```

</CodeGroup>

## Request Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `buyer_ref` | string | Yes | Buyer's reference identifier |
| `packages` | Package[] | Yes | Package configurations (see below) |
| `brand_manifest` | BrandManifest | Yes | Brand information. See [Brand Manifest](/docs/creative/brand-manifest) |
| `promoted_products` | PromotedProducts | No | Products being promoted (for reporting/policy compliance) |
| `po_number` | string | No | Purchase order number |
| `start_time` | string | Yes | `"asap"` or ISO 8601 date-time |
| `end_time` | string | Yes | ISO 8601 date-time (UTC unless timezone specified) |
| `reporting_webhook` | ReportingWebhook | No | Optional webhook for automated reporting delivery |

### Package Object

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `buyer_ref` | string | Yes | Buyer's package reference |
| `product_id` | string | Yes | Product ID from discovery |
| `pricing_option_id` | string | Yes | Pricing option from product. See [Pricing Models](/docs/media-buy/advanced-topics/pricing-models) |
| `format_ids` | FormatID[] | Yes | Creative formats to use (must be supported by product) |
| `budget` | number | Yes | Budget in pricing option's currency |
| `pacing` | string | No | `"even"` (default), `"asap"`, or `"front_loaded"` |
| `bid_price` | number | No | Bid price for auction products |
| `targeting_overlay` | TargetingOverlay | No | Additional targeting (geographic restrictions, frequency caps). See [Targeting](/docs/media-buy/advanced-topics/targeting) |
| `creative_ids` | string[] | No | Existing creative IDs to assign |
| `creatives` | CreativeAsset[] | No | Upload and assign new creatives (max 100 per package) |

## Response

Returns a media buy with status indicating next steps:

| Field | Description |
|-------|-------------|
| `media_buy_id` | Unique identifier for this media buy |
| `status` | `"completed"`, `"working"`, or `"submitted"` |
| `packages` | Array of created packages with IDs and statuses |
| `message` | Human-readable status description |

**Status meanings:**
- **`completed`**: Media buy is active and ready
- **`working`**: Processing asynchronously (< 120 seconds expected)
- **`submitted`**: Requires manual approval (hours to days)

See [schema](https://adcontextprotocol.org/schemas/v1/media-buy/create-media-buy-response.json) for complete field list.

## Common Scenarios

### Multi-Package Campaign

<CodeGroup>

```javascript JavaScript test=true
import { ADCPMultiAgentClient } from '@adcp/client';

const client = new ADCPMultiAgentClient([{
  id: 'test-agent',
  agent_uri: 'https://test-agent.adcontextprotocol.org/mcp',
  protocol: 'mcp',
  auth: {
    type: 'bearer',
    token: '1v8tAhASaUYYp4odoQ1PnMpdqNaMiTrCRqYo9OJp6IQ'
  }
}]);

const agent = client.agent('test-agent');

// Discover multiple products
const discovery = await agent.getProducts({
  filters: {
    format_types: ['video', 'audio'],
    delivery_type: 'guaranteed'
  }
});

// Find video and audio products
const videoProduct = discovery.products.find(p =>
  p.format_ids.some(f => f.id.includes('video'))
);
const audioProduct = discovery.products.find(p =>
  p.format_ids.some(f => f.id.includes('audio'))
);

// Create campaign with multiple packages
const mediaBuy = await agent.createMediaBuy({
  buyer_ref: `multi-package-${Date.now()}`,
  brand_manifest: {
    name: 'Nike',
    url: 'https://nike.com'
  },
  packages: [
    {
      buyer_ref: 'video-package',
      product_id: videoProduct.product_id,
      pricing_option_id: videoProduct.pricing_options[0].pricing_option_id,
      format_ids: [videoProduct.format_ids[0]],
      budget: 30000
    },
    {
      buyer_ref: 'audio-package',
      product_id: audioProduct.product_id,
      pricing_option_id: audioProduct.pricing_options[0].pricing_option_id,
      format_ids: [audioProduct.format_ids[0]],
      budget: 20000
    }
  ],
  start_time: 'asap',
  end_time: '2024-12-31T23:59:59Z'
});

console.log(`Created ${mediaBuy.packages.length}-package media buy`);
```

```python Python test=true
from adcp import ADCPMultiAgentClient

client = ADCPMultiAgentClient([{
    'id': 'test-agent',
    'agent_uri': 'https://test-agent.adcontextprotocol.org/mcp',
    'protocol': 'mcp',
    'auth': {
        'type': 'bearer',
        'token': '1v8tAhASaUYYp4odoQ1PnMpdqNaMiTrCRqYo9OJp6IQ'
    }
}])

agent = client.agent('test-agent')

# Discover multiple products
discovery = agent.get_products(
    filters={
        'format_types': ['video', 'audio'],
        'delivery_type': 'guaranteed'
    }
)

# Find video and audio products
video_product = next((p for p in discovery['products']
    if any('video' in f['id'] for f in p['format_ids'])), None)
audio_product = next((p for p in discovery['products']
    if any('audio' in f['id'] for f in p['format_ids'])), None)

# Create campaign with multiple packages
import time
media_buy = agent.create_media_buy(
    buyer_ref=f"multi-package-{int(time.time() * 1000)}",
    brand_manifest={
        'name': 'Nike',
        'url': 'https://nike.com'
    },
    packages=[
        {
            'buyer_ref': 'video-package',
            'product_id': video_product['product_id'],
            'pricing_option_id': video_product['pricing_options'][0]['pricing_option_id'],
            'format_ids': [video_product['format_ids'][0]],
            'budget': 30000
        },
        {
            'buyer_ref': 'audio-package',
            'product_id': audio_product['product_id'],
            'pricing_option_id': audio_product['pricing_options'][0]['pricing_option_id'],
            'format_ids': [audio_product['format_ids'][0]],
            'budget': 20000
        }
    ],
    start_time='asap',
    end_time='2024-12-31T23:59:59Z'
)

print(f"Created {len(media_buy['packages'])}-package media buy")
```

</CodeGroup>

### Geographic Targeting

<CodeGroup>

```javascript JavaScript test=true
import { ADCPMultiAgentClient } from '@adcp/client';

const client = new ADCPMultiAgentClient([{
  id: 'test-agent',
  agent_uri: 'https://test-agent.adcontextprotocol.org/mcp',
  protocol: 'mcp',
  auth: {
    type: 'bearer',
    token: '1v8tAhASaUYYp4odoQ1PnMpdqNaMiTrCRqYo9OJp6IQ'
  }
}]);

const agent = client.agent('test-agent');

const discovery = await agent.getProducts({
  brief: 'Video campaign for US launch',
  brand_manifest: {
    name: 'Nike',
    url: 'https://nike.com'
  }
});

const product = discovery.products[0];

// Campaign with geographic restrictions
const mediaBuy = await agent.createMediaBuy({
  buyer_ref: `geo-targeted-${Date.now()}`,
  brand_manifest: {
    name: 'Nike',
    url: 'https://nike.com'
  },
  packages: [{
    buyer_ref: 'us-package',
    product_id: product.product_id,
    pricing_option_id: product.pricing_options[0].pricing_option_id,
    format_ids: product.format_ids,
    budget: 50000,
    targeting_overlay: {
      geo_country_any_of: ['US'],
      geo_region_any_of: ['CA', 'NY', 'TX']
    }
  }],
  start_time: 'asap',
  end_time: '2024-12-31T23:59:59Z'
});

console.log(`Created geo-targeted media buy: ${mediaBuy.media_buy_id}`);
```

```python Python test=true
from adcp import ADCPMultiAgentClient
import time

client = ADCPMultiAgentClient([{
    'id': 'test-agent',
    'agent_uri': 'https://test-agent.adcontextprotocol.org/mcp',
    'protocol': 'mcp',
    'auth': {
        'type': 'bearer',
        'token': '1v8tAhASaUYYp4odoQ1PnMpdqNaMiTrCRqYo9OJp6IQ'
    }
}])

agent = client.agent('test-agent')

discovery = agent.get_products(
    brief='Video campaign for US launch',
    brand_manifest={
        'name': 'Nike',
        'url': 'https://nike.com'
    }
)

product = discovery['products'][0]

# Campaign with geographic restrictions
media_buy = agent.create_media_buy(
    buyer_ref=f"geo-targeted-{int(time.time() * 1000)}",
    brand_manifest={
        'name': 'Nike',
        'url': 'https://nike.com'
    },
    packages=[{
        'buyer_ref': 'us-package',
        'product_id': product['product_id'],
        'pricing_option_id': product['pricing_options'][0]['pricing_option_id'],
        'format_ids': product['format_ids'],
        'budget': 50000,
        'targeting_overlay': {
            'geo_country_any_of': ['US'],
            'geo_region_any_of': ['CA', 'NY', 'TX']
        }
    }],
    start_time='asap',
    end_time='2024-12-31T23:59:59Z'
)

print(f"Created geo-targeted media buy: {media_buy['media_buy_id']}")
```

</CodeGroup>

### Campaign with Inline Creatives

<CodeGroup>

```javascript JavaScript test=true
import { ADCPMultiAgentClient } from '@adcp/client';

const client = new ADCPMultiAgentClient([{
  id: 'test-agent',
  agent_uri: 'https://test-agent.adcontextprotocol.org/mcp',
  protocol: 'mcp',
  auth: {
    type: 'bearer',
    token: '1v8tAhASaUYYp4odoQ1PnMpdqNaMiTrCRqYo9OJp6IQ'
  }
}]);

const agent = client.agent('test-agent');

const discovery = await agent.getProducts({
  brief: 'Display campaign',
  brand_manifest: {
    name: 'Nike',
    url: 'https://nike.com'
  }
});

const product = discovery.products[0];

// Create media buy with creatives in single operation
const mediaBuy = await agent.createMediaBuy({
  buyer_ref: `inline-creative-${Date.now()}`,
  brand_manifest: {
    name: 'Nike',
    url: 'https://nike.com'
  },
  packages: [{
    buyer_ref: 'display-package',
    product_id: product.product_id,
    pricing_option_id: product.pricing_options[0].pricing_option_id,
    format_ids: product.format_ids,
    budget: 15000,
    creatives: [{
      creative_id: 'summer-2024-display',
      format_id: product.format_ids[0],
      assets: [{
        asset_id: 'hero-image',
        asset_type: 'image',
        url: 'https://nike.com/creatives/summer-2024.jpg'
      }]
    }]
  }],
  start_time: 'asap',
  end_time: '2024-12-31T23:59:59Z'
});

console.log(`Media buy created with inline creatives: ${mediaBuy.media_buy_id}`);
```

```python Python test=true
from adcp import ADCPMultiAgentClient
import time

client = ADCPMultiAgentClient([{
    'id': 'test-agent',
    'agent_uri': 'https://test-agent.adcontextprotocol.org/mcp',
    'protocol': 'mcp',
    'auth': {
        'type': 'bearer',
        'token': '1v8tAhASaUYYp4odoQ1PnMpdqNaMiTrCRqYo9OJp6IQ'
    }
}])

agent = client.agent('test-agent')

discovery = agent.get_products(
    brief='Display campaign',
    brand_manifest={
        'name': 'Nike',
        'url': 'https://nike.com'
    }
)

product = discovery['products'][0]

# Create media buy with creatives in single operation
media_buy = agent.create_media_buy(
    buyer_ref=f"inline-creative-{int(time.time() * 1000)}",
    brand_manifest={
        'name': 'Nike',
        'url': 'https://nike.com'
    },
    packages=[{
        'buyer_ref': 'display-package',
        'product_id': product['product_id'],
        'pricing_option_id': product['pricing_options'][0]['pricing_option_id'],
        'format_ids': product['format_ids'],
        'budget': 15000,
        'creatives': [{
            'creative_id': 'summer-2024-display',
            'format_id': product['format_ids'][0],
            'assets': [{
                'asset_id': 'hero-image',
                'asset_type': 'image',
                'url': 'https://nike.com/creatives/summer-2024.jpg'
            }]
        }]
    }],
    start_time='asap',
    end_time='2024-12-31T23:59:59Z'
)

print(f"Media buy created with inline creatives: {media_buy['media_buy_id']}")
```

</CodeGroup>

## Async Workflows

### Handling `working` Status

When a media buy returns `status: "working"`, check status periodically:

```javascript
// If status is "working", poll for completion
if (mediaBuy.status === 'working') {
  // Wait a few seconds, then check status
  await new Promise(resolve => setTimeout(resolve, 5000));

  // Check status (implementation depends on protocol)
  // MCP: call get_media_buy or polling endpoint
  // A2A: status updates via SSE
}
```

### Handling `submitted` Status

When status is `"submitted"`, manual approval is required (hours to days):

```javascript
if (mediaBuy.status === 'submitted') {
  console.log('Media buy submitted for manual review');
  console.log(`Message: ${mediaBuy.message}`);
  // Set up webhook or periodic status checks
}
```

See [Task Management](/docs/protocols/task-management) for protocol-specific async patterns.

## Error Handling

| Error Code | Description | Resolution |
|------------|-------------|------------|
| `AUTH_REQUIRED` | Authentication needed | Provide credentials |
| `INVALID_REQUEST` | Missing required fields or invalid values | Check request parameters against schema |
| `PRODUCT_NOT_FOUND` | Product ID doesn't exist | Verify product_id from discovery |
| `FORMAT_NOT_SUPPORTED` | Format not supported by product | Check product.format_ids |
| `POLICY_VIOLATION` | Content policy restriction | Review policy message and adjust |
| `BUDGET_INSUFFICIENT` | Budget too low for product minimums | Increase budget or choose different product |

## Format Requirements

Each package must specify `format_ids` to enable:
- **Placeholder creation** in ad servers
- **Clear asset expectations** for creative teams
- **Format validation** before trafficking

See [Creative Formats](/docs/creative/formats) for format specifications.

## Policy Compliance

Media buys undergo policy review for:
- Advertiser category restrictions
- Content guidelines
- Platform-specific policies

Policy violations may result in `submitted` status requiring manual approval or rejection. See [Policy Compliance](/docs/media-buy/media-buys/policy-compliance) for details.

## Next Steps

After creating a media buy:

1. **Upload Creatives**: Use [`sync_creatives`](/docs/media-buy/task-reference/sync_creatives) to provide creative assets
2. **Monitor Delivery**: Use [`get_media_buy_delivery`](/docs/media-buy/task-reference/get_media_buy_delivery) to track performance
3. **Optimize**: Use [`provide_performance_feedback`](/docs/media-buy/task-reference/provide_performance_feedback) for optimization
4. **Update**: Use [`update_media_buy`](/docs/media-buy/task-reference/update_media_buy) to modify campaigns

## Learn More

- [Media Buy Lifecycle](/docs/media-buy/media-buys/) - Complete campaign workflow
- [Pricing Models](/docs/media-buy/advanced-topics/pricing-models) - CPM, CPCV, CPP explained
- [Targeting](/docs/media-buy/advanced-topics/targeting) - Targeting overlays and restrictions
- [Task Management](/docs/protocols/task-management) - Async patterns and status checking
