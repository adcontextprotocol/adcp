---
title: create_media_buy
sidebar_position: 3
testable: true
---

# create_media_buy

Create a media buy from selected packages. Handles validation, approval if needed, and campaign creation.

**Response Time**: Instant to days (returns `completed`, `working` < 120s, or `submitted` for hours/days)

**Request Schema**: [`/schemas/v2/media-buy/create-media-buy-request.json`](https://adcontextprotocol.org/schemas/v2/media-buy/create-media-buy-request.json)
**Response Schema**: [`/schemas/v2/media-buy/create-media-buy-response.json`](https://adcontextprotocol.org/schemas/v2/media-buy/create-media-buy-response.json)

## Quick Start

Create a simple media buy with two packages:

<CodeGroup>

```javascript JavaScript
import { testAgent } from '@adcp/client/testing';

const result = await testAgent.createMediaBuy({
  buyer_ref: 'summer_campaign_2025',
  brand_manifest: {
    name: 'Nike',
    url: 'https://nike.com'
  },
  packages: [
    {
      buyer_ref: 'display_package_1',
      product_id: 'prod_d979b543',
      pricing_option_id: 'cpm_usd_auction',
      format_ids: [
        {
          agent_url: 'https://creative.adcontextprotocol.org',
          id: 'display_300x250_image'
        }
      ],
      budget: 30000,
      bid_price: 5.00
    },
    {
      buyer_ref: 'display_package_2',
      product_id: 'prod_e8fd6012',
      pricing_option_id: 'cpm_usd_auction',
      format_ids: [
        {
          agent_url: 'https://creative.adcontextprotocol.org',
          id: 'display_300x250_html'
        }
      ],
      budget: 20000,
      bid_price: 4.50
    }
  ],
  start_time: '2025-06-01T00:00:00Z',
  end_time: '2025-08-31T23:59:59Z'
});

// Check for errors (discriminated union response)
if (result.errors) {
  console.error('Failed to create media buy:', result.errors);
} else {
  console.log(`Created media buy ${result.media_buy_id}`);
  console.log(`Upload creatives by: ${result.creative_deadline}`);
  console.log(`Packages created: ${result.packages.length}`);
}
```

```python Python
import asyncio
from adcp import test_agent

async def create_campaign():
    result = await test_agent.simple.create_media_buy(
        buyer_ref='summer_campaign_2025',
        brand_manifest={
            'name': 'Nike',
            'url': 'https://nike.com'
        },
        packages=[
            {
                'buyer_ref': 'ctv_package',
                'product_id': 'prod_d979b543',
                'pricing_option_id': 'cpm_usd_auction',
                'format_ids': [
                    {
                        'agent_url': 'https://creative.adcontextprotocol.org',
                        'id': 'display_300x250_image'
                    }
                ],
                'budget': 30000
            },
            {
                'buyer_ref': 'audio_package',
                'product_id': 'prod_e8fd6012',
                'pricing_option_id': 'cpm_usd_auction',
                'format_ids': [
                    {
                        'agent_url': 'https://creative.adcontextprotocol.org',
                        'id': 'display_300x250_html'
                    }
                ],
                'budget': 20000
            }
        ],
        start_time='2025-06-01T00:00:00Z',
        end_time='2025-08-31T23:59:59Z'
    )

    # Check for errors (discriminated union response)
    if hasattr(result, 'errors') and result.errors:
        print('Failed to create media buy:', result.errors)
    else:
        print(f"Created media buy {result.media_buy_id}")
        print(f"Upload creatives by: {result.creative_deadline}")
        print(f"Packages created: {len(result.packages)}")

asyncio.run(create_campaign())
```

```bash CLI
npx adcp \
  https://test-agent.adcontextprotocol.org/mcp \
  create_media_buy \
  '{"buyer_ref":"summer_campaign_2025","brand_manifest":{"name":"Nike","url":"https://nike.com"},"packages":[{"buyer_ref":"display_package_1","product_id":"prod_d979b543","pricing_option_id":"cpm_usd_auction","format_ids":[{"agent_url":"https://creative.adcontextprotocol.org","id":"display_300x250_image"}],"budget":30000,"bid_price":5.00},{"buyer_ref":"display_package_2","product_id":"prod_e8fd6012","pricing_option_id":"cpm_usd_auction","format_ids":[{"agent_url":"https://creative.adcontextprotocol.org","id":"display_300x250_html"}],"budget":20000,"bid_price":4.50}],"start_time":"2025-06-01T00:00:00Z","end_time":"2025-08-31T23:59:59Z"}' \
  --auth 1v8tAhASaUYYp4odoQ1PnMpdqNaMiTrCRqYo9OJp6IQ
```

</CodeGroup>

## Request Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `buyer_ref` | string | Yes | Your reference identifier for this media buy |
| `packages` | Package[] | Yes | Array of package configurations (see below) |
| `brand_manifest` | BrandManifestRef | Yes | Brand identity - minimal (name/URL) acceptable for sales agents. See [Brand Manifest](/docs/creative/brand-manifest) |
| `start_time` | string | Yes | `"asap"` or ISO 8601 date-time |
| `end_time` | string | Yes | ISO 8601 date-time (UTC unless timezone specified) |
| `po_number` | string | No | Purchase order number |
| `reporting_webhook` | ReportingWebhook | No | Automated reporting delivery configuration |

### Package Object

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `buyer_ref` | string | Yes | Your reference for this package |
| `product_id` | string | Yes | Product ID from `get_products` |
| `pricing_option_id` | string | Yes | Pricing option ID from product's `pricing_options` array |
| `format_ids` | FormatID[] | Yes | Format IDs that will be used - must be supported by product |
| `budget` | number | Yes | Budget in currency specified by pricing option |
| `pacing` | string | No | `"even"` (default), `"asap"`, or `"front_loaded"` |
| `bid_price` | number | No | Bid price for auction pricing (required when `is_fixed` is false) |
| `targeting_overlay` | TargetingOverlay | No | Additional targeting criteria (see [Targeting](/docs/media-buy/advanced-topics/targeting)) |
| `creative_ids` | string[] | No | Existing library creative IDs to assign |
| `creatives` | CreativeAsset[] | No | Full creative objects to upload and assign |

## Response

### Success Response

| Field | Description |
|-------|-------------|
| `media_buy_id` | Publisher's unique identifier |
| `buyer_ref` | Your reference identifier |
| `creative_deadline` | ISO 8601 timestamp for creative upload deadline |
| `packages` | Array of created packages with complete state |

### Error Response

| Field | Description |
|-------|-------------|
| `errors` | Array of error objects explaining failure |

**Note**: Responses use discriminated unions - you get either success fields OR errors, never both. Always check for `errors` before accessing success fields.

## Common Scenarios

### Campaign with Targeting

Add geographic restrictions and frequency capping:

<CodeGroup>

```javascript JavaScript
import { testAgent } from '@adcp/client/testing';

The message is returned differently in each protocol:
- **MCP**: Returned as a `message` field in the JSON response
- **A2A**: Returned as a text part in the artifact

## Response (Payload)

```json
{
  "media_buy_id": "string",
  "buyer_ref": "string",
  "creative_deadline": "string",
  "packages": [
    {
      "package_id": "string",
      "buyer_ref": "string",
      "product_id": "string",
      "budget": 50000,
      "pacing": "even",
      "pricing_option_id": "string",
      "status": "active",
      "creative_assignments": [],
      "format_ids_to_provide": []
    }
  ]
}
```

### Field Descriptions

- **media_buy_id**: Publisher's unique identifier for the created media buy
- **buyer_ref**: Buyer's reference identifier for this media buy
- **creative_deadline**: ISO 8601 timestamp for creative upload deadline
- **packages**: Array of created packages with complete state information (full Package objects)
  - **package_id**: Publisher's unique identifier for the package
  - **buyer_ref**: Buyer's reference identifier for the package
  - **product_id**: ID of the product this package is based on
  - **budget**: Budget allocation for this package
  - **pacing**: Pacing strategy (even, asap, front_loaded)
  - **pricing_option_id**: Selected pricing option ID
  - **status**: Current package status
  - **creative_assignments**: Array of creative assignments for this package
  - **format_ids_to_provide**: Format IDs that will be provided for this package

## Protocol-Specific Examples

The AdCP payload is identical across protocols. Only the request/response wrapper differs.

### MCP Request
```json
{
  "tool": "create_media_buy",
  "arguments": {
    "buyer_ref": "nike_q1_campaign_2024",
    "packages": [
      {
        "buyer_ref": "nike_ctv_sports_package",
        "product_id": "ctv_sports_premium",
        "format_ids": [
          {
            "agent_url": "https://creative.adcontextprotocol.org",
            "id": "video_standard_30s"
          },
          {
            "agent_url": "https://creative.adcontextprotocol.org",
            "id": "video_standard_15s"
          }
        ],
        "budget": 60000,
        "pacing": "even",
        "pricing_option_id": "cpm-fixed-sports",
        "targeting_overlay": {
          "geo_country_any_of": ["US"],
          "geo_region_any_of": ["CA", "NY"],
          "axe_include_segment": "x8dj3k"
        },
        "creative_ids": ["creative_abc123", "creative_def456"]
      },
      {
        "buyer_ref": "nike_audio_drive_package",
        "product_id": "audio_drive_time",
        "format_ids": [
          {
            "agent_url": "https://creative.adcontextprotocol.org",
            "id": "audio_standard_30s"
          }
        ],
        "budget": 40000,
        "pacing": "front_loaded",
        "pricing_option_id": "cpm-fixed-audio",
        "targeting_overlay": {
          "geo_country_any_of": ["US"],
          "geo_region_any_of": ["CA"],
          "axe_exclude_segment": "x9m2p"
        }
      }
    ],
    "brand_manifest": {
      "name": "Nike",
      "url": "https://nike.com"
    },
    "po_number": "PO-2024-Q1-001",
    "start_time": "2024-02-01T00:00:00Z",
    "end_time": "2024-03-31T23:59:59Z",
    "reporting_webhook": {
      "url": "https://buyer.example.com/webhooks/reporting",
      "auth_type": "bearer",
      "auth_token": "secret_reporting_token_xyz",
      "reporting_frequency": "daily",
      "requested_metrics": ["impressions", "spend", "video_completions", "completion_rate"]
    }
  }
}
```

### MCP Response (Synchronous)
```json
{
  "message": "Successfully created $100,000 media buy. Upload creatives by Jan 30. Campaign will run from Feb 1 to Mar 31.",
  "status": "completed",
  "media_buy_id": "mb_12345",
  "buyer_ref": "nike_q1_campaign_2024",
  "creative_deadline": "2024-01-30T23:59:59Z",
  "packages": [
    {
      "package_id": "pkg_12345_001",
      "buyer_ref": "nike_ctv_sports_package"
    },
    {
      "package_id": "pkg_12345_002",
      "buyer_ref": "nike_audio_drive_package"
    }
  ]
}
```

### MCP Response (Partial Success with Errors)
```json
{
  "message": "Media buy created but some packages had issues. Review targeting for best performance.",
  "media_buy_id": "mb_12346",
  "buyer_ref": "nike_q1_campaign_2024",
  "creative_deadline": "2024-01-30T23:59:59Z",
  "packages": [
    {
      "package_id": "pkg_12346_001",
      "buyer_ref": "nike_ctv_sports_package"
    }
  ],
  "errors": [
    {
      "code": "TARGETING_TOO_NARROW",
      "message": "Package targeting yielded 0 available impressions",
      "field": "packages[1].targeting_overlay",
      "suggestion": "Broaden geographic targeting or remove segment exclusions",
      "details": {
        "requested_budget": 40000,
        "available_impressions": 0,
        "affected_package": "nike_audio_drive_package"
      }
    }
  ]
}
```

### MCP Response (Asynchronous)
```json
{
  "task_id": "task_456",
  "status": "working",
  "message": "Creating media buy...",
  "poll_url": "/tasks/task_456"
}
```

### A2A Request

#### Natural Language Invocation
```javascript
await a2a.send({
  message: {
    parts: [{
      kind: "text",
      text: "Create a $100K Nike campaign from Feb 1 to Mar 31. Use the CTV sports and audio drive time products we discussed. Split budget 60/40."
    }]
  }
});
```

#### Explicit Skill Invocation
```javascript
await a2a.send({
  message: {
    parts: [
      {
        kind: "text",
        text: "Creating Nike Q1 campaign"  // Optional context
      },
      {
        kind: "data",
        data: {
          skill: "create_media_buy",  // Must match skill name in Agent Card
          parameters: {
            "buyer_ref": "nike_q1_campaign_2024",
            "packages": [
              {
                "buyer_ref": "nike_ctv_sports_package",
                "product_id": "ctv_sports_premium",
                "format_ids": [
                  {
                    "agent_url": "https://creative.adcontextprotocol.org",
                    "id": "video_standard_30s"
                  },
                  {
                    "agent_url": "https://creative.adcontextprotocol.org",
                    "id": "video_standard_15s"
                  }
                ],
                "budget": 60000,
                "pacing": "even",
                "pricing_option_id": "cpm-fixed-sports",
                "targeting_overlay": {
                  "geo_country_any_of": ["US"],
                  "geo_region_any_of": ["CA", "NY"],
                  "axe_include_segment": "x8dj3k"
                },
                "creative_ids": ["creative_abc123", "creative_def456"]
              },
              {
                "buyer_ref": "nike_audio_drive_package",
                "product_id": "audio_drive_time",
                "format_ids": [
                  {
                    "agent_url": "https://creative.adcontextprotocol.org",
                    "id": "audio_standard_30s"
                  }
                ],
                "budget": 40000,
                "pacing": "front_loaded",
                "pricing_option_id": "cpm-fixed-audio",
                "targeting_overlay": {
                  "geo_country_any_of": ["US"],
                  "geo_region_any_of": ["CA"],
                  "axe_exclude_segment": "x9m2p"
                }
              }
            ],
            "brand_manifest": {
              "name": "Nike",
              "url": "https://nike.com"
            },
            "po_number": "PO-2024-Q1-001",
            "start_time": "2024-02-01T00:00:00Z",
            "end_time": "2024-03-31T23:59:59Z"
          }
        }
      }
    ]
  }
});
```

### A2A Response (with streaming)
Initial response:
```json
{
  "taskId": "task-mb-001",
  "status": { "state": "working" }
}
```

Then via Server-Sent Events:
```
data: {"message": "Validating packages..."}
data: {"message": "Checking inventory availability..."}
data: {"message": "Creating campaign in ad server..."}
data: {"status": {"state": "completed"}, "artifacts": [{
  "artifactId": "artifact-mb-conf-abc123",
  "name": "media_buy_confirmation",
  "parts": [
    {"kind": "text", "text": "Successfully created $100,000 media buy. Upload creatives by Jan 30."},
    {"kind": "data", "data": {
      "media_buy_id": "mb_12345",
      "buyer_ref": "nike_q1_campaign_2024",
      "creative_deadline": "2024-01-30T23:59:59Z",
      "packages": [
        {"package_id": "pkg_12345_001", "buyer_ref": "nike_ctv_sports_package"},
        {"package_id": "pkg_12345_002", "buyer_ref": "nike_audio_drive_package"}
      ]
    }}
  ]
}]}
```

### Key Differences
- **MCP**: May return synchronously or asynchronously with updates via:
  - Polling (calling status endpoints)
  - Webhooks (push notifications to callback URLs)
  - Streaming (WebSockets or SSE)
- **A2A**: Always returns task with updates via:
  - Server-Sent Events (SSE) for real-time streaming
  - Webhooks (push notifications) for long-running tasks
- **Payload**: The `parameters` field in A2A contains the exact same structure as MCP's `arguments`

## Human-in-the-Loop Examples

### MCP with Manual Approval (Polling Example)

This example shows polling, but MCP implementations may also support webhooks or streaming for real-time updates.

**Initial Request:**
```json
{
  "tool": "create_media_buy",
  "arguments": {
    "buyer_ref": "large_campaign_2024",
    "packages": [...],
    "brand_manifest": {
      "name": "ACME Corporation",
      "url": "https://acmecorp.com"
    },
    "po_number": "PO-2024-LARGE-001",
    "start_time": "2024-02-01T00:00:00Z",
    "end_time": "2024-06-30T23:59:59Z"
  }
}
```

**Response (Asynchronous):**
```json
{
  "task_id": "task_456",
  "status": "working",
  "message": "Large budget requires sales team approval. Expected review time: 2-4 hours.",
  "context_id": "ctx-mb-456"
}
```

**Client checks status (via polling in this example):**
```json
{
  "tool": "create_media_buy_status",
  "arguments": {
    "context_id": "ctx-mb-456"
  }
}
```

**Status Response (Still pending):**
```json
{
  "status": "working",
  "message": "Awaiting manual approval. Sales team reviewing. 1 of 2 approvals received.",
  "context_id": "ctx-mb-456",
  "responsible_party": "publisher",
  "estimated_completion": "2024-01-15T16:00:00Z"
}
```

**Status Response (Approved):**
```json
{
  "status": "completed",
  "message": "Media buy approved and created. Upload creatives by Jan 30.",
  "media_buy_id": "mb_789456",
  "buyer_ref": "large_campaign_2024",
  "creative_deadline": "2024-01-30T23:59:59Z",
  "packages": [...]
}
```

### A2A with Manual Approval (SSE Example)

A2A can use Server-Sent Events for real-time streaming or webhooks for push notifications.

**Initial Request with SSE:**
```json
{
  "message": {
    "parts": [{
      "kind": "data",
      "data": {
        "skill": "create_media_buy",
        "parameters": {
          "buyer_ref": "large_campaign_2024",
          "packages": [...],
          "brand_manifest": {
            "name": "ACME Corporation",
            "url": "https://acmecorp.com"
          },
          "po_number": "PO-2024-LARGE-001",
          "start_time": "2024-02-01T00:00:00Z",
          "end_time": "2024-06-30T23:59:59Z"
        }
      }
    }]
  }
}
```

**Initial Response:**
```json
{
  "taskId": "task-mb-large-001",
  "contextId": "ctx-conversation-xyz",
  "status": { 
    "state": "working",
    "message": "Large budget requires sales team approval"
  }
}
```

**SSE Updates (Human approval process):**
```
data: {"message": "Validating campaign requirements..."}
data: {"message": "Budget exceeds auto-approval threshold. Routing to sales team..."}
data: {"message": "Sales team notified. Expected review time: 2-4 hours"}
data: {"message": "First approval received from regional manager"}
data: {"message": "Second approval received from finance team"}
data: {"status": {"state": "completed"}, "artifacts": [{
  "artifactId": "artifact-mb-approval-xyz789",
  "name": "media_buy_confirmation",
  "parts": [
    {"kind": "text", "text": "Media buy approved and created successfully. $500,000 campaign scheduled Feb 1 - Jun 30. Upload creatives by Jan 30."},
    {"kind": "data", "data": {
      "media_buy_id": "mb_789456",
      "buyer_ref": "large_campaign_2024",
      "creative_deadline": "2024-01-30T23:59:59Z",
      "packages": [...]
    }}
  ]
}]}
```

### A2A with Webhooks (Long-Running Task)

**Initial Request with Webhook Configuration:**
```json
{
  "message": {
    "parts": [{
      "kind": "data",
      "data": {
        "skill": "create_media_buy",
        "parameters": {
          "buyer_ref": "large_campaign_2024",
          "packages": [...],
          "brand_manifest": {
            "name": "ACME Corporation",
            "url": "https://acmecorp.com"
          },
          "po_number": "PO-2024-LARGE-001",
          "start_time": "2024-02-01T00:00:00Z",
          "end_time": "2024-06-30T23:59:59Z"
        }
      }
    }]
  },
  "configuration": {
    "pushNotificationConfig": {
      "url": "https://buyer.example.com/webhooks/adcp",
      "authType": "bearer",
      "authToken": "secret-token-xyz"
    }
  }
}
```

```python Python
import asyncio
from adcp import test_agent

async def create_targeted_campaign():
    result = await test_agent.simple.create_media_buy(
        buyer_ref='regional_campaign_2025',
        brand_manifest={
            'name': 'Regional Retailer',
            'url': 'https://example-retailer.com'
        },
        packages=[{
            'buyer_ref': 'ctv_regional',
            'product_id': 'ctv_sports_premium',
            'pricing_option_id': 'cpm-fixed-sports',
            'format_ids': [{
                'agent_url': 'https://creative.adcontextprotocol.org',
                'id': 'video_standard_30s'
            }],
            'budget': 50000,
            'targeting_overlay': {
                'geo_country_any_of': ['US'],
                'geo_region_any_of': ['CA', 'NY'],
                'frequency_cap': {
                    'suppress_minutes': 60
                }
            }
        }],
        start_time='asap',
        end_time='2025-12-31T23:59:59Z'
    )

    if hasattr(result, 'errors') and result.errors:
        print('Creation failed:', result.errors)
    else:
        print(f"Campaign {result.media_buy_id} created with targeting")

asyncio.run(create_targeted_campaign())
```

</CodeGroup>

### Campaign with Inline Creatives

Upload creatives at the same time as creating the campaign:

<CodeGroup>

```javascript JavaScript
import { testAgent } from '@adcp/client/testing';

const result = await testAgent.createMediaBuy({
  buyer_ref: 'campaign_with_creatives',
  brand_manifest: {
    name: 'Nike',
    url: 'https://nike.com'
  },
  packages: [{
    buyer_ref: 'ctv_package',
    product_id: 'prod_d979b543',
    pricing_option_id: 'cpm_usd_auction',
    format_ids: [{
      agent_url: 'https://creative.adcontextprotocol.org',
      id: 'display_300x250_image'
    }],
    budget: 30000,
    creatives: [{
      creative_id: 'hero_video_30s',
      name: 'Hero Video',
      format_id: {
        agent_url: 'https://creative.adcontextprotocol.org',
        id: 'display_300x250_image'
      },
      assets: {
        video: {
          url: 'https://cdn.example.com/hero-30s.mp4',
          width: 1920,
          height: 1080,
          duration_ms: 30000
        }
      }
    }]
  }],
  start_time: 'asap',
  end_time: '2025-12-31T23:59:59Z'
});

if (result.errors) {
  console.error('Creation failed:', result.errors);
} else {
  console.log(`Campaign created with ${result.packages[0].creative_assignments.length} creatives`);
}
```

```python Python
import asyncio
from adcp import test_agent

async def create_with_creatives():
    result = await test_agent.simple.create_media_buy(
        buyer_ref='campaign_with_creatives',
        brand_manifest={
            'name': 'Nike',
            'url': 'https://nike.com'
        },
        packages=[{
            'buyer_ref': 'ctv_package',
            'product_id': 'ctv_sports_premium',
            'pricing_option_id': 'cpm-fixed-sports',
            'format_ids': [{
                'agent_url': 'https://creative.adcontextprotocol.org',
                'id': 'video_standard_30s'
            }],
            'budget': 30000,
            'creatives': [{
                'creative_id': 'hero_video_30s',
                'name': 'Hero Video',
                'format_id': {
                    'agent_url': 'https://creative.adcontextprotocol.org',
                    'id': 'video_standard_30s'
                },
                'assets': {
                    'video': {
                        'url': 'https://cdn.example.com/hero-30s.mp4',
                        'width': 1920,
                        'height': 1080,
                        'duration_ms': 30000
                    }
                }
            }]
        }],
        start_time='asap',
        end_time='2025-12-31T23:59:59Z'
    )

    if hasattr(result, 'errors') and result.errors:
        print('Creation failed:', result.errors)
    else:
        print(f"Campaign created with {len(result.packages[0].creative_assignments)} creatives")

asyncio.run(create_with_creatives())
```

</CodeGroup>

### Campaign with Reporting Webhook

Receive automated reporting notifications:

<CodeGroup>

```javascript JavaScript
import { testAgent } from '@adcp/client/testing';

const result = await testAgent.createMediaBuy({
  buyer_ref: 'campaign_with_reporting',
  brand_manifest: {
    name: 'Nike',
    url: 'https://nike.com'
  },
  packages: [{
    buyer_ref: 'ctv_package',
    product_id: 'prod_d979b543',
    pricing_option_id: 'cpm_usd_auction',
    format_ids: [{
      agent_url: 'https://creative.adcontextprotocol.org',
      id: 'display_300x250_image'
    }],
    budget: 30000
  }],
  start_time: 'asap',
  end_time: '2025-12-31T23:59:59Z',
  reporting_webhook: {
    url: 'https://buyer.example.com/webhooks/reporting',
    authentication: {
      schemes: ['Bearer'],
      credentials: 'secret_token_xyz_minimum_32_chars'
    },
    reporting_frequency: 'daily',
    requested_metrics: ['impressions', 'spend', 'video_completions']
  }
});

if (result.errors) {
  console.error('Creation failed:', result.errors);
} else {
  console.log(`Campaign created - daily reports will be sent to webhook`);
}
```

```python Python
import asyncio
from adcp import test_agent

async def create_with_reporting():
    result = await test_agent.simple.create_media_buy(
        buyer_ref='campaign_with_reporting',
        brand_manifest={
            'name': 'Nike',
            'url': 'https://nike.com'
        },
        packages=[{
            'buyer_ref': 'ctv_package',
            'product_id': 'ctv_sports_premium',
            'pricing_option_id': 'cpm-fixed-sports',
            'format_ids': [{
                'agent_url': 'https://creative.adcontextprotocol.org',
                'id': 'video_standard_30s'
            }],
            'budget': 30000
        }],
        start_time='asap',
        end_time='2025-12-31T23:59:59Z',
        reporting_webhook={
            'url': 'https://buyer.example.com/webhooks/reporting',
            'authentication': {
                'schemes': ['Bearer'],
                'credentials': 'secret_token_xyz_minimum_32_chars'
            },
            'reporting_frequency': 'daily',
            'requested_metrics': ['impressions', 'spend', 'video_completions']
        }
    )

    if hasattr(result, 'errors') and result.errors:
        print('Creation failed:', result.errors)
    else:
        print('Campaign created - daily reports will be sent to webhook')

asyncio.run(create_with_reporting())
```

</CodeGroup>

## Error Handling

Common errors and resolutions:

| Error Code | Description | Resolution |
|------------|-------------|------------|
| `PRODUCT_NOT_FOUND` | Invalid product_id | Verify product exists via `get_products` |
| `FORMAT_INCOMPATIBLE` | Format not supported by product | Check product's `format_ids` field |
| `BUDGET_INSUFFICIENT` | Budget below product minimum | Increase budget or choose different product |
| `TARGETING_TOO_NARROW` | Targeting yields zero inventory | Broaden geographic or audience criteria |
| `POLICY_VIOLATION` | Brand/product violates policy | Review publisher's content policies |
| `INVALID_PRICING_OPTION` | pricing_option_id not found | Use ID from product's `pricing_options` |

Example error response:

```json
{
  "taskId": "task-mb-webhook-001",
  "contextId": "ctx-conversation-xyz",
  "status": {"state": "completed"},
  "artifacts": [{
    "artifactId": "artifact-mb-webhook-def456",
    "name": "media_buy_confirmation",
    "parts": [
      {"kind": "data", "data": {
        "media_buy_id": "mb_789456",
        "buyer_ref": "large_campaign_2024",
        "creative_deadline": "2024-01-30T23:59:59Z",
        "packages": [...]
      }}
    ]
  }]
}
```

## Key Concepts

### Format Specification

Format IDs are **required** for each package because:
- Publishers create placeholder creatives in ad servers
- Both parties know exactly what creative assets are needed
- Validation ensures products support requested formats
- Progress tracking shows which assets are missing

See [Format Workflow](#format-workflow) below for complete details.

### Brand Manifest

The `brand_manifest` field identifies the advertiser for policy compliance and business purposes.

**Minimal manifests are acceptable** for sales agents:

```json
{
  "brand_manifest": {
    "name": "ACME Corporation",
    "url": "https://acmecorp.com"
  }
}
```

Full manifests with colors, fonts, and product catalogs are only needed for creative generation. See [Brand Manifest](/docs/creative/brand-manifest).

### Pricing & Currency

Each package specifies its `pricing_option_id`, which determines:
- Currency (USD, EUR, etc.)
- Pricing model (CPM, CPCV, CPP, etc.)
- Rate and whether it's fixed or auction-based

Packages can use different currencies when sellers support it. See [Pricing Models](/docs/media-buy/advanced-topics/pricing-models).

### Targeting Overlays

**Use sparingly** - most targeting should be in your brief and handled through product selection.

Use overlays only for:
- Geographic restrictions (RCT testing, regulatory compliance)
- Frequency capping
- AXE segment inclusion/exclusion

See [Targeting](/docs/media-buy/advanced-topics/targeting) for details.

## Format Workflow

### Why Format Specification Matters

When creating a media buy, format specification enables:

1. **Placeholder Creation** - Publisher creates placeholders in ad server with correct specs
2. **Validation** - System validates products support requested formats
3. **Clear Expectations** - Both parties know exactly what's needed
4. **Progress Tracking** - Track which assets are missing vs. required
5. **Technical Setup** - Ad server configured before creatives arrive

### Complete Workflow

```
1. list_creative_formats → Get available format specifications
2. get_products → Find products (returns format_ids they support)
3. Validate compatibility → Ensure products support desired formats
4. create_media_buy → Specify formats (REQUIRED)
   └── Publisher creates placeholders
   └── Clear creative requirements established
5. sync_creatives → Upload actual files matching formats
6. Campaign activation → Replace placeholders with real creatives
```

### Format Validation

Publishers MUST validate:
- All formats are supported by the product
- Format specifications match `list_creative_formats` output
- Creative requirements can be fulfilled within timeline

Invalid format example:

```json
{
  "errors": [{
    "code": "FORMAT_INCOMPATIBLE",
    "message": "Product 'ctv_sports_premium' does not support format 'audio_standard_30s'",
    "field": "packages[0].format_ids",
    "supported_formats": [
      { "agent_url": "https://creative.adcontextprotocol.org", "id": "video_standard_30s" },
      { "agent_url": "https://creative.adcontextprotocol.org", "id": "video_standard_15s" }
    ]
  }]
}
```

## Asynchronous Operations

This operation can complete instantly or take days depending on complexity and approval requirements.

### Response Patterns

**Synchronous (completed immediately)**:
```json
{
  "media_buy_id": "mb_12345",
  "buyer_ref": "summer_campaign_2025",
  "packages": []
}
```

**Asynchronous (processing)**:
```json
{
  "status": "working",
  "message": "Creating media buy..."
}
```
Poll for completion or use webhooks/streaming.

**Manual Approval Required**:
```json
{
  "status": "submitted",
  "message": "Large budget requires sales approval (2-4 hours)"
}
```
Will take hours to days.

### Protocol-Specific Handling

AdCP tasks work across multiple protocols (MCP, A2A, REST). Each protocol handles async operations differently:

- **Status checking**: Polling, webhooks, or streaming
- **Updates**: Protocol-specific mechanisms
- **Long-running tasks**: Different timeout and notification patterns

See [Task Management](/docs/protocols/task-management) for protocol-specific async patterns and examples.

## Usage Notes

- Total budget is distributed across packages based on individual `budget` values
- Both media buys and packages have `buyer_ref` fields for tracking
- Creative assets must be uploaded before deadline for campaign activation
- AXE segments enable advanced audience targeting
- Pending states (`working`, `submitted`) are normal, not errors
- Orchestrators MUST handle pending states as part of normal workflow

## Policy Compliance

Brand and products are validated during creation. Policy violations return errors:

```json
{
  "errors": [{
    "code": "POLICY_VIOLATION",
    "message": "Brand or product category not permitted on this publisher",
    "field": "brand_manifest",
    "suggestion": "Contact publisher for category approval process"
  }]
}
```

Publishers should ensure:
- Brand/products align with selected packages
- Creatives match declared brand/products
- Campaign complies with all advertising policies

## Next Steps

After creating a media buy:

1. **Upload Creatives**: Use [`sync_creatives`](/docs/media-buy/task-reference/sync_creatives) before deadline
2. **Monitor Status**: Use [`get_media_buy_delivery`](/docs/media-buy/task-reference/get_media_buy_delivery)
3. **Optimize**: Use [`provide_performance_feedback`](/docs/media-buy/task-reference/provide_performance_feedback)
4. **Update**: Use [`update_media_buy`](/docs/media-buy/task-reference/update_media_buy) to modify campaign

## Learn More

- [Media Buy Lifecycle](/docs/media-buy/media-buys/) - Complete campaign workflow
- [get_products](/docs/media-buy/task-reference/get_products) - Discover inventory
- [Targeting](/docs/media-buy/advanced-topics/targeting) - Targeting strategies
- [Pricing Models](/docs/media-buy/advanced-topics/pricing-models) - Currency and pricing
