---
title: Refinement
description: Iterate on discovered products and proposals using the refine object before committing to a media buy.
---

Refinement turns product discovery into a conversation. After an initial `brief` or `wholesale` discovery, use `buying_mode: "refine"` to iterate on specific products and proposals — adjusting the selection, requesting changes, and exploring alternatives — before committing to a [`create_media_buy`](/docs/media-buy/task-reference/create_media_buy).

## The refinement lifecycle

A typical media buying workflow follows this pattern:

```
discover → refine → refine → ... → buy
```

1. **Discover** — Call `get_products` with `buying_mode: "brief"` or `"wholesale"` to find matching inventory. The seller returns products (and optionally proposals).

2. **Refine** — Call `get_products` with `buying_mode: "refine"` and a `refine` object that declares what to do with each product: keep it, drop it, or find more like it. The seller returns updated products with revised pricing and configurations.

3. **Repeat** — Refine as many times as needed. Each call is self-contained and stateless.

4. **Buy** — When satisfied, execute the final selection via `create_media_buy`.

<Tip>
Refinement is not required. Simple campaigns can go straight from discovery to purchase. But for campaigns involving multiple products, proposals with budget allocations, or iterative negotiation, refinement is where the value is.
</Tip>

## The refine object

The `refine` object is the single payload for all refinement intent. It consolidates product selection, adjustment instructions, and proposal references into one structure:

| Field | Type | Purpose |
|-------|------|---------|
| `overall` | string | Guide the seller to adjust the overall composition of the product set |
| `products[]` | array | Per-product instructions with explicit actions |
| `proposals[]` | array | Per-proposal adjustment instructions |

The `refine` object requires at least one field. The seller considers all fields together when composing the response.

### Product actions

Each product in `refine.products` declares an explicit action:

| Action | Behavior | `notes` |
|--------|----------|---------|
| `include` | Return this product with updated pricing and data | Optional adjustment instructions (e.g., "add 16:9 format") |
| `omit` | Exclude this product from the response | Ignored |
| `more_like_this` | Find additional products similar to this one. The original product is also returned. | Optional guidance on what "similar" means (e.g., "same audience but video format") |

```json
{
  "buying_mode": "refine",
  "refine": {
    "products": [
      { "product_id": "prod_video_premium", "action": "include", "notes": "add 16:9 format option" },
      { "product_id": "prod_display_ros", "action": "omit" },
      { "product_id": "prod_native", "action": "more_like_this", "notes": "same audience but video format" }
    ]
  }
}
```

### Overall direction

Use `overall` to describe what you want from the selection as a whole:

```json
{
  "buying_mode": "refine",
  "refine": {
    "overall": "good selection but I want more video options and less display",
    "products": [
      { "product_id": "prod_video_premium", "action": "include" },
      { "product_id": "prod_display_ros", "action": "include" },
      { "product_id": "prod_native", "action": "include" }
    ]
  }
}
```

The seller may add, remove, or rebalance products based on this guidance. Products not in `refine.products` may appear in the response if the seller determines they fit the direction.

### Proposal refinement

Reference proposals by ID to request adjustments or remove them:

```json
{
  "buying_mode": "refine",
  "refine": {
    "products": [
      { "product_id": "prod_video_premium", "action": "include" },
      { "product_id": "prod_display_ros", "action": "include" }
    ],
    "proposals": [
      { "proposal_id": "prop_balanced_v1", "notes": "shift 20% from display to video" }
    ]
  }
}
```

| Field | Type | Description |
|-------|------|-------------|
| `proposal_id` | string | Proposal ID from the previous response |
| `omit` | boolean | Remove this proposal from the response. When `true`, `notes` is ignored. |
| `notes` | string | Adjustment instructions for this proposal |

### Combining fields

All three fields work together. A single refinement call can adjust the overall selection, act on specific products, and request changes to a proposal:

```json
{
  "buying_mode": "refine",
  "refine": {
    "overall": "increase emphasis on video across the plan",
    "products": [
      { "product_id": "prod_video_premium", "action": "include" },
      { "product_id": "prod_display_ros", "action": "include" },
      { "product_id": "prod_native", "action": "omit" },
      { "product_id": "prod_audio_spot", "action": "include" }
    ],
    "proposals": [
      { "proposal_id": "prop_awareness_q2", "notes": "reallocate native budget to video products" }
    ]
  },
  "filters": {
    "budget_range": { "min": 200000, "max": 200000, "currency": "USD" }
  }
}
```

## Common refinement patterns

### Find similar products

Use `more_like_this` to discover products similar to ones you like. The seller returns the original product plus additional options matching its characteristics:

```json
{
  "buying_mode": "refine",
  "refine": {
    "products": [
      { "product_id": "prod_video_premium", "action": "more_like_this", "notes": "same premium audience but different formats" }
    ]
  }
}
```

### Adjust filters

Filters on a refine request represent the complete target state, not a delta. Always send the full filter set you want applied:

```json
{
  "buying_mode": "refine",
  "refine": {
    "products": [
      { "product_id": "prod_video_premium", "action": "include" },
      { "product_id": "prod_display_ros", "action": "include" }
    ]
  },
  "filters": {
    "start_date": "2026-04-01",
    "end_date": "2026-06-30",
    "budget_range": { "min": 150000, "max": 150000, "currency": "USD" }
  }
}
```

### Narrow or expand a proposal

The products in `refine.products` define which products the seller should consider for the proposal. Combined with `refine.proposals`, this narrows or expands the proposal's product set:

```json
{
  "buying_mode": "refine",
  "refine": {
    "products": [
      { "product_id": "prod_video_premium", "action": "include" },
      { "product_id": "prod_display_ros", "action": "include" }
    ],
    "proposals": [
      { "proposal_id": "prop_balanced_v1", "notes": "rebalance for just these two products" }
    ]
  }
}
```

## Proposals in refine mode

Sellers MAY return proposals alongside refined products, even when the buyer did not include `refine.proposals`. For example, a buyer refining three products may receive those products back with updated pricing *and* a proposal suggesting how to combine them.

Key points:

- **Proposals are not guaranteed.** Sellers are not required to generate proposals in refine mode. Allocation and campaign optimization are primarily orchestrator (buyer-side agent) responsibilities.
- **Signal interest via `refine.overall`.** Include a message like `"suggest how to combine these products"` to indicate you'd welcome a proposal.
- **Unsolicited proposals can be refined or ignored.** If a seller returns a proposal you didn't request, you can refine it in a follow-up call, or simply ignore it and build packages manually via `create_media_buy`.

Publishers typically omit proposals in `wholesale` mode, where the buyer is directing targeting and allocation themselves.

## Statelessness

Each `get_products` request with `buying_mode: "refine"` is self-contained. The `refine` object and `filters` on each request fully specify the refinement intent. Sales agents MUST NOT depend on transport-level session state.

This design enables:
- **Stateless implementations** — sellers don't need to maintain session state between calls
- **Safe retries** — a failed refinement call can be retried with the same parameters
- **Parallel exploration** — an orchestrator can explore multiple refinement paths simultaneously

## Client validation

Orchestrators should validate refinement requests before sending:

- **Non-empty refine** — The `refine` object requires at least one field (`overall`, `products`, or `proposals`). An empty `{}` is rejected by schema validation.
- **Valid actions** — Each product entry requires `product_id` and `action`. Action must be `include`, `omit`, or `more_like_this`.
- **Filters are absolute** — Send the full filter set you want applied, not a delta from the previous request.

Client implementations should validate refinement requests against the [request schema](/docs/building/schemas-and-sdks) before sending.

## Error handling

| Error Code | When | Resolution |
|------------|------|------------|
| `PRODUCT_NOT_FOUND` | One or more product IDs in `refine.products` are unknown or expired | Remove invalid IDs and retry, or re-discover with a `brief` request |
| `PROPOSAL_EXPIRED` | A proposal ID in `refine.proposals` has passed its `expires_at` | Re-discover with a new `brief` or `wholesale` request |
| `INVALID_REQUEST` | `refine` provided in `brief` or `wholesale` mode, empty `refine` object (`{}`), or missing required fields | Check `buying_mode` and required fields |

## Normative requirements

The [Media Buy Specification](/docs/media-buy/specification#get_products) defines the following normative requirements for refinement:

**Orchestrators:**
- MUST include `refine` when `buying_mode` is `"refine"`
- MUST NOT include `refine` when `buying_mode` is `"brief"` or `"wholesale"`
- MUST provide `product_id` and `action` for each entry in `refine.products`

**Sales agents:**
- MUST omit products with `action: "omit"` from the response
- MUST omit proposals marked with `refine.proposals[].omit: true` from the response
- MUST return products with `action: "include"`, with updated pricing
- SHOULD apply adjustment instructions from `notes` on products with `action: "include"`
- SHOULD return additional products similar to those with `action: "more_like_this"`, plus the original product
- SHOULD consider `refine.overall` when composing the response — this MAY result in additional products beyond those in `refine.products`
- SHOULD apply adjustment instructions from `refine.proposals[].notes`
- MAY return proposals even when the buyer did not include `refine.proposals`

## See also

- [`get_products` task reference](/docs/media-buy/task-reference/get_products#refinement) — API reference with request/response schemas
- [Media Products](/docs/media-buy/product-discovery/media-products) — product model and proposal structure
- [Media Buy Specification](/docs/media-buy/specification#get_products) — normative requirements
- [Orchestrator Design](/docs/building/implementation/orchestrator-design) — building buyer-side agents
