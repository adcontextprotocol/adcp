#!/bin/sh

# Verify version sync before pushing
npm run verify-version-sync

# Validate Mintlify docs before pushing
# Production uses Mintlify, so we validate with Mintlify checks
echo "üîç Validating Mintlify documentation..."

# Check for broken internal links
# Temporarily remove archived docs which have version-specific links
rm -rf dist/docs
npx --yes mintlify@latest broken-links
BROKEN_LINKS_EXIT=$?
git checkout dist/docs 2>/dev/null || true
if [ $BROKEN_LINKS_EXIT -ne 0 ]; then
  echo "‚ùå Mintlify broken links check failed. Please fix broken links before pushing."
  exit 1
fi

# Check for accessibility issues (warn only, don't fail)
npx --yes mintlify@latest a11y || {
  echo "‚ö†Ô∏è  Mintlify accessibility check found issues. Review and fix if needed."
  # Don't fail on a11y warnings, just warn
}

echo "‚úÖ Mintlify documentation validation passed"
