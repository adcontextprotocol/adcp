<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>brand.json Builder - AdCP Brand Protocol</title>
    <link rel="icon" href="/AAo.svg" type="image/svg+xml">
    <link rel="stylesheet" href="/design-system.css">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <style>
      /* CSS Custom Properties for Theming - mapped to design system */
      :root {
        --primary-gradient: linear-gradient(135deg, var(--color-primary-700) 0%, var(--color-primary-600) 100%);
        --success-gradient: linear-gradient(135deg, var(--color-primary-700) 0%, var(--color-primary-500) 100%);
        --warning-gradient: linear-gradient(135deg, var(--color-warning-400) 0%, var(--color-error-400) 100%);

        --glass-bg: rgba(255, 255, 255, 0.1);
        --glass-border: rgba(255, 255, 255, 0.2);
        --glass-shadow: var(--shadow-lg);

        --surface-primary: var(--color-bg-card);
        --surface-secondary: var(--color-bg-subtle);
        --text-primary: var(--color-text-heading);
        --text-secondary: var(--color-text-secondary);
        --text-muted: var(--color-text-muted);

        --accent-blue: var(--color-primary-700);
        --accent-purple: var(--color-primary-600);
        --accent-green: var(--color-primary-700);
        --accent-orange: var(--color-warning-500);

        --timing-fast: 0.2s;
        --timing-normal: 0.4s;
        --easing: var(--ease-out);
      }

      body {
        font-family: var(--font-sans);
        font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
        line-height: var(--leading-normal);
        color: var(--text-primary);
        font-weight: var(--font-normal);
        margin: 0;
        padding: 60px 0 0 0;
        min-height: 100vh;
        background: linear-gradient(135deg, var(--color-primary-700) 0%, var(--color-primary-600) 100%);
        position: relative;
      }

      body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background:
          radial-gradient(circle at 20% 50%, rgba(164, 194, 244, 0.3) 0%, transparent 50%),
          radial-gradient(circle at 80% 20%, rgba(164, 194, 244, 0.3) 0%, transparent 50%),
          radial-gradient(circle at 40% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
        pointer-events: none;
        z-index: 1;
      }

      .main-content {
        max-width: var(--container-wide);
        margin: 0 auto;
        padding: var(--space-10) var(--space-5);
        position: relative;
        z-index: 2;
      }

      .page-header {
        text-align: center;
        margin-bottom: var(--space-12);
      }

      .page-header h1 {
        color: white;
        font-size: var(--text-4xl);
        font-weight: var(--font-bold);
        margin: 0 0 var(--space-4) 0;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .page-header p {
        color: rgba(255, 255, 255, 0.9);
        font-size: var(--text-lg);
        margin: 0;
        max-width: 700px;
        margin: 0 auto;
      }

      .section {
        background: var(--surface-primary);
        backdrop-filter: blur(10px);
        border: var(--border-1) solid rgba(255, 255, 255, 0.2);
        border-radius: var(--radius-xl);
        padding: var(--space-8);
        margin-bottom: var(--space-8);
        box-shadow: var(--shadow-lg);
        transition: var(--transition-all);
        position: relative;
        overflow: hidden;
      }

      .section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--primary-gradient);
        border-radius: var(--radius-xl) var(--radius-xl) 0 0;
      }

      .section h3 {
        color: var(--text-primary);
        margin: 0 0 var(--space-5) 0;
        font-size: var(--text-2xl);
        font-weight: var(--font-semibold);
        display: flex;
        align-items: center;
        gap: var(--space-3);
      }

      .section h4 {
        color: var(--text-secondary);
        margin: 0 0 var(--space-4) 0;
        font-size: var(--text-xl);
        font-weight: var(--font-semibold);
      }

      .btn {
        background: var(--primary-gradient);
        color: white;
        border: none;
        padding: var(--space-3) var(--space-6);
        border-radius: var(--radius-md);
        font-weight: var(--font-semibold);
        font-size: var(--text-sm);
        cursor: pointer;
        transition: var(--transition-all);
        text-decoration: none;
        display: inline-block;
        text-align: center;
        box-shadow: var(--shadow-primary-sm);
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-primary-md);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .btn-secondary {
        background: var(--color-gray-500);
        box-shadow: var(--shadow-sm);
      }

      .btn-secondary:hover {
        box-shadow: var(--shadow-md);
      }

      input[type='text'],
      input[type='url'],
      select,
      textarea {
        width: 100%;
        padding: var(--space-3) var(--space-4);
        border: var(--border-2) solid var(--color-border);
        border-radius: var(--radius-md);
        font-size: var(--text-sm);
        transition: var(--transition-all);
        font-family: inherit;
        box-sizing: border-box;
      }

      input[type='text']:focus,
      input[type='url']:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: var(--accent-blue);
        box-shadow: var(--ring-primary);
      }

      textarea {
        resize: vertical;
        min-height: 120px;
        font-family: var(--font-mono);
      }

      .form-group {
        margin-bottom: var(--space-5);
      }

      .form-group label {
        display: block;
        margin-bottom: var(--space-2);
        font-weight: var(--font-semibold);
        color: var(--text-primary);
      }

      .form-group .hint {
        font-size: var(--text-sm);
        color: var(--text-muted);
        margin-top: var(--space-1);
      }

      .variant-selector {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-4);
        margin-bottom: var(--space-6);
      }

      @media (max-width: 768px) {
        .variant-selector {
          grid-template-columns: 1fr;
        }
      }

      .variant-card {
        background: var(--color-bg-subtle);
        border: var(--border-2) solid var(--color-border);
        border-radius: var(--radius-lg);
        padding: var(--space-5);
        cursor: pointer;
        transition: var(--transition-all);
      }

      .variant-card:hover {
        border-color: var(--accent-blue);
        background: var(--color-primary-50);
      }

      .variant-card.selected {
        border-color: var(--accent-blue);
        background: var(--color-primary-50);
        box-shadow: var(--ring-primary);
      }

      .variant-card h4 {
        margin: 0 0 var(--space-2) 0;
        font-size: var(--text-lg);
        color: var(--text-primary);
      }

      .variant-card p {
        margin: 0;
        font-size: var(--text-sm);
        color: var(--text-secondary);
      }

      .variant-card .icon {
        font-size: 24px;
        margin-bottom: var(--space-2);
      }

      .brand-entry {
        background: var(--color-bg-subtle);
        border: var(--border-2) solid var(--color-border);
        border-radius: var(--radius-lg);
        padding: var(--space-5);
        margin-bottom: var(--space-4);
        transition: var(--transition-all);
      }

      .brand-entry:hover {
        border-color: var(--accent-purple);
      }

      .brand-entry-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: var(--space-4);
      }

      .property-entry {
        background: var(--color-bg-card);
        border: var(--border-1) solid var(--color-border);
        border-radius: var(--radius-md);
        padding: var(--space-3);
        margin-bottom: var(--space-2);
        display: flex;
        gap: var(--space-2);
        align-items: center;
      }

      .property-entry select,
      .property-entry input {
        margin: 0;
      }

      .property-entry select {
        width: auto;
        min-width: 120px;
      }

      .property-entry input {
        flex: 1;
      }

      .json-preview {
        background: #1a202c;
        color: #f7fafc;
        padding: var(--space-5);
        border-radius: var(--radius-lg);
        overflow-x: auto;
        font-family: var(--font-mono);
        font-size: var(--text-sm);
        white-space: pre-wrap;
        word-wrap: break-word;
        max-height: 400px;
        overflow-y: auto;
      }

      .validation-result {
        padding: var(--space-4);
        border-radius: var(--radius-md);
        margin-bottom: var(--space-4);
      }

      .result-success {
        background: var(--color-primary-50);
        border: 1px solid var(--color-primary-200);
        color: var(--color-primary-800);
      }

      .result-warning {
        background: var(--color-warning-50);
        border: 1px solid var(--color-warning-200);
        color: var(--color-warning-800);
      }

      .result-error {
        background: var(--color-error-50);
        border: 1px solid var(--color-error-200);
        color: var(--color-error-800);
      }

      .dashboard-header {
        background: #e8f4fd;
        border: 1px solid #bee5eb;
        border-radius: var(--radius-lg);
        padding: var(--space-4);
        margin-bottom: var(--space-5);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: var(--space-3);
      }

      .dashboard-header h4 {
        margin: 0 0 var(--space-1) 0;
        color: #0c5460;
      }

      .dashboard-header p {
        margin: 0;
        font-size: var(--text-sm);
        color: #0c5460;
      }

      .dashboard-actions {
        display: flex;
        gap: var(--space-2);
        flex-wrap: wrap;
      }

      .dashboard-actions .btn {
        padding: var(--space-2) var(--space-4);
        font-size: var(--text-sm);
      }

      .hidden {
        display: none !important;
      }

      /* Decision Tree Styles */
      .decision-step {
        margin-bottom: var(--space-6);
      }

      .decision-step h4 {
        margin: 0 0 var(--space-2) 0;
        font-size: var(--text-lg);
      }

      .step-hint {
        color: var(--text-secondary);
        font-size: var(--text-sm);
        margin: 0 0 var(--space-4) 0;
      }

      .decision-options {
        display: flex;
        flex-direction: column;
        gap: var(--space-3);
        margin-bottom: var(--space-4);
      }

      .decision-option {
        display: flex;
        align-items: center;
        gap: var(--space-4);
        padding: var(--space-4);
        border: 2px solid var(--color-border);
        border-radius: var(--radius-lg);
        background: var(--color-bg);
        cursor: pointer;
        text-align: left;
        transition: all 0.15s ease;
      }

      .decision-option:hover {
        border-color: var(--color-brand);
        background: var(--color-bg-subtle);
      }

      .decision-option.recommended {
        position: relative;
        border-color: var(--color-brand);
      }

      .option-badge {
        position: absolute;
        top: -10px;
        right: var(--space-4);
        background: var(--color-brand);
        color: white;
        font-size: var(--text-xs);
        padding: 2px 8px;
        border-radius: var(--radius-full);
        font-weight: var(--font-semibold);
      }

      .option-icon {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--color-bg-subtle);
        border-radius: var(--radius-md);
        font-size: var(--text-xl);
        font-weight: var(--font-bold);
        color: var(--color-brand);
        flex-shrink: 0;
      }

      .option-content {
        flex: 1;
      }

      .option-content strong {
        display: block;
        margin-bottom: var(--space-1);
      }

      .option-content span {
        color: var(--text-secondary);
        font-size: var(--text-sm);
      }

      .examples-row {
        font-size: var(--text-sm);
        color: var(--text-secondary);
        margin-bottom: var(--space-1);
      }

      .example-label {
        font-weight: var(--font-medium);
        color: var(--text-primary);
      }

      .back-link {
        background: none;
        border: none;
        color: var(--color-brand);
        cursor: pointer;
        padding: 0;
        font-size: var(--text-sm);
        margin-bottom: var(--space-4);
        display: inline-flex;
        align-items: center;
        gap: var(--space-1);
      }

      .back-link:hover {
        text-decoration: underline;
      }

      .info-callout {
        background: var(--color-bg-subtle);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-lg);
        padding: var(--space-4);
        margin-top: var(--space-4);
        font-size: var(--text-sm);
      }

      .info-callout strong {
        display: block;
        margin-bottom: var(--space-2);
      }

      .info-callout ol {
        margin: 0;
        padding-left: var(--space-5);
      }

      .info-callout li {
        margin-bottom: var(--space-1);
      }

      /* Success/Next Steps Styles */
      .next-steps {
        background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
        border: 1px solid #86efac;
        border-radius: var(--radius-lg);
        padding: var(--space-5);
        margin-top: var(--space-6);
      }

      .next-steps h4 {
        margin: 0 0 var(--space-4) 0;
        color: #166534;
        display: flex;
        align-items: center;
        gap: var(--space-2);
      }

      .next-steps ol {
        margin: 0;
        padding: 0;
        list-style: none;
        counter-reset: step-counter;
      }

      .next-steps li {
        counter-increment: step-counter;
        display: flex;
        gap: var(--space-3);
        margin-bottom: var(--space-4);
        align-items: flex-start;
      }

      .next-steps li:last-child {
        margin-bottom: 0;
      }

      .step-number {
        width: 28px;
        height: 28px;
        background: #166534;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: var(--text-sm);
        font-weight: var(--font-semibold);
        flex-shrink: 0;
      }

      .step-content {
        flex: 1;
      }

      .step-content strong {
        display: block;
        margin-bottom: var(--space-1);
        color: #166534;
      }

      .step-content p {
        margin: 0 0 var(--space-2) 0;
        font-size: var(--text-sm);
        color: var(--text-secondary);
      }

      .step-content code {
        background: white;
        padding: var(--space-1) var(--space-2);
        border-radius: var(--radius-sm);
        font-size: var(--text-sm);
        border: 1px solid #86efac;
      }

      .verify-result {
        margin-top: var(--space-3);
        padding: var(--space-3);
        border-radius: var(--radius-md);
        font-size: var(--text-sm);
      }

      .verify-result.success {
        background: #dcfce7;
        border: 1px solid #86efac;
        color: #166534;
      }

      .verify-result.error {
        background: #fef2f2;
        border: 1px solid #fecaca;
        color: #991b1b;
      }

      .verify-result.pending {
        background: #fefce8;
        border: 1px solid #fde047;
        color: #854d0e;
      }

      @media (max-width: 768px) {
        .page-header h1 {
          font-size: var(--text-3xl);
        }

        .section {
          padding: var(--space-5);
        }
      }
    </style>
  </head>
  <body>
    <!-- Navigation (loaded by nav.js) -->
    <div id="adcp-nav"></div>
    <script src="/nav.js"></script>

    <div class="main-content">
      <!-- Page Header -->
      <div class="page-header">
        <h1>brand.json Builder</h1>
        <p>
          Make your brand discoverable by AI. When AI agents look up your domain,
          they'll find your official brand name and identity instead of guessing.
        </p>
        <p style="font-size: var(--text-sm); opacity: 0.9; margin-top: var(--space-2);">
          Similar to how robots.txt tells search engines how to crawl your site, brand.json tells AI agents who you are.
        </p>
      </div>

      <!-- Domain Input Section -->
      <div class="section">
        <h3>Build Your brand.json</h3>
        <p style="color: var(--text-secondary); margin-bottom: var(--space-5)">
          Enter your domain to validate an existing brand.json or create a new one.
        </p>

        <div style="display: flex; gap: var(--space-3); margin-bottom: var(--space-5)">
          <input
            type="text"
            id="domain-input"
            placeholder="example.com"
            style="flex: 1"
            onkeypress="if(event.key === 'Enter') startBuilding()"
          />
          <button class="btn" onclick="startBuilding()" id="start-btn">Get Started</button>
        </div>

        <!-- Validation Results -->
        <div id="validation-results" class="hidden"></div>

        <!-- Builder Form (hidden initially) -->
        <div id="builder-form" class="hidden">
          <!-- Dashboard Header -->
          <div class="dashboard-header">
            <div>
              <h4>brand.json for <span id="domain-display"></span></h4>
              <p id="file-status">Creating new brand.json</p>
            </div>
            <div class="dashboard-actions">
              <button class="btn btn-secondary" onclick="copyJson()">Copy JSON</button>
              <button class="btn" onclick="downloadJson()">Download</button>
            </div>
          </div>

          <!-- Decision Tree -->
          <div id="decision-tree">
            <!-- Step 1: Brand Count -->
            <div id="step-brand-count" class="decision-step">
              <h4>How many brands does your company have?</h4>
              <p class="step-hint">If you're unsure, you probably have just one brand.</p>

              <div class="decision-options">
                <button class="decision-option" onclick="selectBrandCount('single')">
                  <div class="option-icon">1</div>
                  <div class="option-content">
                    <strong>Just one brand</strong>
                    <span>My company name IS my brand name</span>
                  </div>
                </button>

                <button class="decision-option" onclick="selectBrandCount('multiple')">
                  <div class="option-icon">+</div>
                  <div class="option-content">
                    <strong>Multiple brands</strong>
                    <span>We own several distinct brand names</span>
                  </div>
                </button>
              </div>

              <div class="examples-row">
                <span class="example-label">Single brand:</span> Allbirds, Warby Parker, Stripe
              </div>
              <div class="examples-row">
                <span class="example-label">Multiple brands:</span> Nike Inc (Nike, Jordan, Converse), P&G (Tide, Pampers)
              </div>
            </div>

            <!-- Step 2a: Single Brand Hosting -->
            <div id="step-single-hosting" class="decision-step hidden">
              <button class="back-link" onclick="goBackTo('step-brand-count')">‚Üê Back</button>
              <h4>Where will you host your brand.json file?</h4>

              <div class="decision-options">
                <button class="decision-option recommended" onclick="selectVariant('single')">
                  <div class="option-badge">Recommended</div>
                  <div class="option-icon">üìÑ</div>
                  <div class="option-content">
                    <strong>On my website</strong>
                    <span>I'll put the file at <span id="single-domain-hint"></span>/.well-known/brand.json</span>
                  </div>
                </button>

                <button class="decision-option" onclick="selectVariant('hosted')">
                  <div class="option-icon">‚òÅÔ∏è</div>
                  <div class="option-content">
                    <strong>Hosted elsewhere</strong>
                    <span>A CDN or managed service hosts it for me</span>
                  </div>
                </button>

                <button class="decision-option" onclick="selectVariant('agent')">
                  <div class="option-icon">ü§ñ</div>
                  <div class="option-content">
                    <strong>I have an MCP agent</strong>
                    <span>My brand info is served dynamically by an AI agent</span>
                  </div>
                </button>
              </div>
            </div>

            <!-- Step 2b: Multiple Brands - Which Domain -->
            <div id="step-multiple-domain" class="decision-step hidden">
              <button class="back-link" onclick="goBackTo('step-brand-count')">‚Üê Back</button>
              <h4>Which domain are you setting up?</h4>
              <p class="step-hint">Your domain: <strong id="multi-domain-hint"></strong></p>

              <div class="decision-options">
                <button class="decision-option" onclick="selectVariant('portfolio')">
                  <div class="option-icon">üè¢</div>
                  <div class="option-content">
                    <strong>This is the parent company domain</strong>
                    <span>All brand info lives here (e.g., nikeinc.com for Nike Inc)</span>
                  </div>
                </button>

                <button class="decision-option" onclick="selectVariant('redirect')">
                  <div class="option-icon">‚Ü™Ô∏è</div>
                  <div class="option-content">
                    <strong>This is one of our brand domains</strong>
                    <span>This brand is owned by a larger company</span>
                  </div>
                </button>
              </div>

              <div class="info-callout">
                <strong>How multi-brand setup works:</strong>
                <ol>
                  <li>Create the full portfolio on your parent company domain</li>
                  <li>Add a small redirect file on each brand domain</li>
                </ol>
              </div>
            </div>
          </div>

          <!-- Single Brand Form (simplest case) -->
          <div id="form-single">
            <h4 style="margin-bottom: var(--space-4)">Brand Information</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-4); margin-bottom: var(--space-5)">
              <div class="form-group" style="margin-bottom: 0">
                <label>Brand ID</label>
                <input
                  type="text"
                  id="single-brand-id"
                  placeholder="allbirds"
                  oninput="updatePreview()"
                />
                <p class="hint">Lowercase identifier</p>
              </div>
              <div class="form-group" style="margin-bottom: 0">
                <label>Brand Name</label>
                <input
                  type="text"
                  id="single-brand-name"
                  placeholder="Allbirds"
                  oninput="updatePreview()"
                />
              </div>
            </div>
            <div>
              <label style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-2); font-size: var(--text-sm); font-weight: var(--font-medium);">
                Properties (websites, apps)
                <button class="btn" onclick="addSingleBrandProperty()" style="padding: var(--space-1) var(--space-2); font-size: var(--text-xs);">+ Add</button>
              </label>
              <div id="single-brand-properties">
                <p style="color: var(--text-muted); font-size: var(--text-sm); margin: 0;">No properties yet</p>
              </div>
            </div>
          </div>

          <!-- Brand Portfolio Form (multi-brand) -->
          <div id="form-portfolio" class="hidden">
            <h4 style="margin-bottom: var(--space-4)">House Information</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-4); margin-bottom: var(--space-5)">
              <div class="form-group" style="margin-bottom: 0">
                <label>House Domain</label>
                <input
                  type="text"
                  id="portfolio-house-domain"
                  placeholder="nikeinc.com"
                  oninput="updatePreview()"
                />
                <p class="hint">Corporate/parent company domain</p>
              </div>
              <div class="form-group" style="margin-bottom: 0">
                <label>House Name</label>
                <input
                  type="text"
                  id="portfolio-house-name"
                  placeholder="Nike, Inc."
                  oninput="updatePreview()"
                />
              </div>
            </div>

            <h4 style="margin: var(--space-6) 0 var(--space-4) 0; display: flex; justify-content: space-between; align-items: center;">
              Brands in Portfolio
              <button class="btn" onclick="addBrand()" style="padding: var(--space-2) var(--space-4); font-size: var(--text-sm)">+ Add Brand</button>
            </h4>
            <div id="brands-container">
              <!-- Brand entries added here -->
            </div>

            <!-- Redirect Files Section -->
            <div id="redirect-files-section" class="hidden" style="margin-top: var(--space-6); padding: var(--space-4); background: var(--color-bg-subtle); border-radius: var(--radius-lg); border: 1px solid var(--color-border);">
              <h4 style="margin: 0 0 var(--space-3) 0; font-size: var(--text-lg);">üìÅ Redirect Files Needed</h4>
              <p style="color: var(--text-secondary); font-size: var(--text-sm); margin: 0 0 var(--space-3) 0;">
                Each brand domain needs a redirect file pointing to this house:
              </p>
              <div id="redirect-files-list"></div>
            </div>
          </div>

          <!-- Brand Redirect Form -->
          <div id="form-redirect" class="hidden">
            <div class="form-group">
              <label>House Domain</label>
              <input
                type="text"
                id="redirect-house-domain"
                placeholder="nikeinc.com"
                oninput="updatePreview()"
              />
              <p class="hint">The corporate/house domain that contains the full brand portfolio</p>
            </div>
          </div>

          <!-- Brand Agent Form -->
          <div id="form-agent" class="hidden">
            <div class="form-group">
              <label>Agent URL</label>
              <input
                type="url"
                id="agent-url"
                placeholder="https://agent.example.com/mcp"
                oninput="updatePreview()"
              />
              <p class="hint">The MCP endpoint URL for the brand agent</p>
            </div>
            <div class="form-group">
              <label>Agent ID</label>
              <input
                type="text"
                id="agent-id"
                placeholder="my_brand_agent"
                oninput="updatePreview()"
              />
              <p class="hint">Unique identifier for the agent</p>
            </div>
          </div>

          <!-- Hosted Location Form -->
          <div id="form-hosted" class="hidden">
            <div class="form-group">
              <label>Hosted URL</label>
              <input
                type="url"
                id="hosted-url"
                placeholder="https://cdn.example.com/brands/brand.json"
                oninput="updatePreview()"
              />
              <p class="hint">The HTTPS URL where your brand.json is hosted</p>
            </div>
          </div>

          <!-- JSON Preview -->
          <div style="margin-top: var(--space-6)">
            <h4 style="margin-bottom: var(--space-3)">Generated brand.json</h4>
            <pre class="json-preview" id="json-preview">{}</pre>
          </div>

          <!-- Next Steps / Success State -->
          <div class="next-steps" id="next-steps">
            <h4>‚úÖ Next Steps</h4>
            <ol>
              <li>
                <div class="step-number">1</div>
                <div class="step-content">
                  <strong>Download your file</strong>
                  <p>Save the generated brand.json to your computer.</p>
                  <button class="btn" onclick="downloadJson()" style="padding: var(--space-2) var(--space-4);">Download brand.json</button>
                </div>
              </li>
              <li>
                <div class="step-number">2</div>
                <div class="step-content">
                  <strong>Upload to your website</strong>
                  <p>Place the file at this exact location on your server:</p>
                  <code id="deploy-path">https://example.com/.well-known/brand.json</code>
                  <p style="margin-top: var(--space-2);">Create the <code>.well-known</code> folder if it doesn't exist.</p>
                </div>
              </li>
              <li>
                <div class="step-number">3</div>
                <div class="step-content">
                  <strong>Verify it works</strong>
                  <p>Test that your brand.json is accessible and valid.</p>
                  <button class="btn btn-secondary" onclick="verifyDeployment()" id="verify-btn" style="padding: var(--space-2) var(--space-4);">Test My Domain</button>
                  <div id="verify-result"></div>
                </div>
              </li>
            </ol>
          </div>
        </div>
      </div>

      <!-- Help Section -->
      <div class="section">
        <h3>Need Help?</h3>
        <p style="color: var(--text-secondary); margin-bottom: var(--space-4)">
          Learn more about the Brand Protocol and brand.json format:
        </p>
        <div style="display: flex; gap: var(--space-3); flex-wrap: wrap">
          <a href="https://docs.adcontextprotocol.org/docs/brand-protocol" target="_blank" class="btn" style="text-decoration: none">
            Brand Protocol Docs
          </a>
          <a href="https://docs.adcontextprotocol.org/docs/brand-protocol/brand-json" target="_blank" class="btn btn-secondary" style="text-decoration: none">
            brand.json Spec
          </a>
        </div>
      </div>
    </div>

    <!-- Footer (loaded by nav.js) -->
    <div id="adcp-footer"></div>

    <script>
      // ============================================================================
      // State
      // ============================================================================

      let currentDomain = '';
      let currentVariant = 'single'; // single, portfolio, redirect, agent, hosted
      let brands = [];
      let brandIdCounter = 0;
      let singleBrandProperties = [];

      // ============================================================================
      // Main Functions
      // ============================================================================

      async function startBuilding() {
        const domain = document.getElementById('domain-input').value.trim().toLowerCase();
        if (!domain) {
          alert('Please enter a domain name');
          return;
        }

        currentDomain = domain;
        document.getElementById('domain-display').textContent = domain;
        document.getElementById('portfolio-house-domain').value = domain;

        // Try to validate existing brand.json
        const btn = document.getElementById('start-btn');
        btn.disabled = true;
        btn.textContent = 'Checking...';

        try {
          const response = await fetch(`/api/brands/resolve?domain=${encodeURIComponent(domain)}`);
          const result = await response.json();

          const validationResults = document.getElementById('validation-results');

          if (result.success && result.brand) {
            // Found existing brand.json
            validationResults.innerHTML = `
              <div class="validation-result result-success">
                <strong>Found existing brand.json</strong><br>
                Domain resolves to: ${result.brand.house_domain || domain}
                ${result.brand.brand_id ? ` (Brand: ${result.brand.brand_id})` : ''}
              </div>
            `;
            validationResults.classList.remove('hidden');
            document.getElementById('file-status').textContent = 'Existing brand.json found';
          } else {
            // No existing file
            validationResults.innerHTML = `
              <div class="validation-result result-warning">
                <strong>No brand.json found</strong><br>
                Create a new brand.json for ${domain}
              </div>
            `;
            validationResults.classList.remove('hidden');
            document.getElementById('file-status').textContent = 'Creating new brand.json';
          }
        } catch (error) {
          document.getElementById('validation-results').classList.add('hidden');
          document.getElementById('file-status').textContent = 'Creating new brand.json';
        }

        btn.disabled = false;
        btn.textContent = 'Get Started';

        // Show builder
        document.getElementById('builder-form').classList.remove('hidden');

        // Reset state
        brands = [];
        brandIdCounter = 0;
        singleBrandProperties = [];

        // Pre-fill brand ID from domain for single brand
        const brandId = currentDomain.split('.')[0].toLowerCase().replace(/[^a-z0-9]/g, '_');
        document.getElementById('single-brand-id').value = brandId;

        // Reset decision tree to step 1 and populate domain hints
        showDecisionStep('step-brand-count');
        document.getElementById('single-domain-hint').textContent = currentDomain;
        document.getElementById('multi-domain-hint').textContent = currentDomain;

        // Hide all forms initially
        document.getElementById('form-single').classList.add('hidden');
        document.getElementById('form-portfolio').classList.add('hidden');
        document.getElementById('form-redirect').classList.add('hidden');
        document.getElementById('form-agent').classList.add('hidden');
        document.getElementById('form-hosted').classList.add('hidden');

        updatePreview();
      }

      // ============================================================================
      // Decision Tree Functions
      // ============================================================================

      function showDecisionStep(stepId) {
        // Hide all steps
        document.querySelectorAll('.decision-step').forEach(step => {
          step.classList.add('hidden');
        });
        // Show the requested step
        const step = document.getElementById(stepId);
        if (step) {
          step.classList.remove('hidden');
          step.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        // Show the decision tree container
        document.getElementById('decision-tree').classList.remove('hidden');
      }

      function selectBrandCount(count) {
        if (count === 'single') {
          showDecisionStep('step-single-hosting');
        } else {
          showDecisionStep('step-multiple-domain');
        }
      }

      function goBackTo(stepId) {
        showDecisionStep(stepId);
      }

      function selectVariant(variant) {
        currentVariant = variant;

        // Hide decision tree, show selected form
        document.getElementById('decision-tree').classList.add('hidden');

        // Show/hide forms based on variant
        document.getElementById('form-single').classList.toggle('hidden', variant !== 'single');
        document.getElementById('form-portfolio').classList.toggle('hidden', variant !== 'portfolio');
        document.getElementById('form-redirect').classList.toggle('hidden', variant !== 'redirect');
        document.getElementById('form-agent').classList.toggle('hidden', variant !== 'agent');
        document.getElementById('form-hosted').classList.toggle('hidden', variant !== 'hosted');

        // Initialize portfolio with one brand if empty
        if (variant === 'portfolio' && brands.length === 0) {
          document.getElementById('portfolio-house-domain').value = currentDomain;
          addBrand();
        }

        // Update deploy path in next steps
        document.getElementById('deploy-path').textContent = `https://${currentDomain}/.well-known/brand.json`;

        // Clear any previous verification result
        document.getElementById('verify-result').innerHTML = '';

        updatePreview();

        // Scroll to the form
        const formElement = document.getElementById(`form-${variant}`);
        if (formElement) {
          setTimeout(() => {
            formElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }, 100);
        }
      }

      async function verifyDeployment() {
        const btn = document.getElementById('verify-btn');
        const resultDiv = document.getElementById('verify-result');

        btn.disabled = true;
        btn.textContent = 'Testing...';
        resultDiv.innerHTML = '<div class="verify-result pending">üîç Checking your domain...</div>';

        try {
          const response = await fetch(`/api/brands/resolve?domain=${encodeURIComponent(currentDomain)}`);
          const result = await response.json();

          if (result.success && result.brand) {
            resultDiv.innerHTML = `
              <div class="verify-result success">
                ‚úÖ <strong>Success!</strong> Your brand.json is live and valid.<br>
                <span style="font-size: 12px; opacity: 0.8;">
                  House: ${result.brand.house_domain || currentDomain}
                  ${result.brand.brand_id ? ` ‚Ä¢ Brand: ${result.brand.brand_id}` : ''}
                </span>
              </div>
            `;
          } else {
            resultDiv.innerHTML = `
              <div class="verify-result error">
                ‚ùå <strong>Not found yet.</strong> Make sure you've uploaded the file to:<br>
                <code style="background: white; padding: 2px 6px; border-radius: 3px; margin-top: 4px; display: inline-block;">
                  https://${currentDomain}/.well-known/brand.json
                </code>
              </div>
            `;
          }
        } catch (error) {
          resultDiv.innerHTML = `
            <div class="verify-result error">
              ‚ùå <strong>Error checking domain.</strong> Please try again later.
            </div>
          `;
        }

        btn.disabled = false;
        btn.textContent = 'Test My Domain';
      }

      // ============================================================================
      // Single Brand Property Functions
      // ============================================================================

      function addSingleBrandProperty() {
        singleBrandProperties.push({ type: 'website', identifier: '', primary: singleBrandProperties.length === 0 });
        renderSingleBrandProperties();
        updatePreview();
      }

      function removeSingleBrandProperty(index) {
        singleBrandProperties.splice(index, 1);
        renderSingleBrandProperties();
        updatePreview();
      }

      function updateSingleBrandProperty(index, field, value) {
        if (field === 'primary') {
          value = value === 'true' || value === true;
        }
        singleBrandProperties[index][field] = value;
        updatePreview();
      }

      function renderSingleBrandProperties() {
        const container = document.getElementById('single-brand-properties');
        if (singleBrandProperties.length === 0) {
          container.innerHTML = `<p style="color: var(--text-muted); font-size: var(--text-sm); margin: 0;">No properties yet</p>`;
          return;
        }

        container.innerHTML = singleBrandProperties.map((prop, i) => `
          <div class="property-entry">
            <select onchange="updateSingleBrandProperty(${i}, 'type', this.value)">
              <option value="website" ${prop.type === 'website' ? 'selected' : ''}>Website</option>
              <option value="mobile_app" ${prop.type === 'mobile_app' ? 'selected' : ''}>Mobile App</option>
              <option value="ctv_app" ${prop.type === 'ctv_app' ? 'selected' : ''}>CTV App</option>
              <option value="desktop_app" ${prop.type === 'desktop_app' ? 'selected' : ''}>Desktop App</option>
              <option value="dooh" ${prop.type === 'dooh' ? 'selected' : ''}>DOOH</option>
              <option value="podcast" ${prop.type === 'podcast' ? 'selected' : ''}>Podcast</option>
            </select>
            <input type="text" value="${prop.identifier}" placeholder="${prop.type === 'website' ? 'example.com' : 'com.example.app'}" oninput="updateSingleBrandProperty(${i}, 'identifier', this.value)" />
            <label style="display: flex; align-items: center; gap: var(--space-1); white-space: nowrap; font-size: var(--text-sm);">
              <input type="checkbox" ${prop.primary ? 'checked' : ''} onchange="updateSingleBrandProperty(${i}, 'primary', this.checked)" />
              Primary
            </label>
            <button class="btn btn-secondary" onclick="removeSingleBrandProperty(${i})" style="padding: var(--space-1) var(--space-2); font-size: var(--text-xs);">√ó</button>
          </div>
        `).join('');
      }

      // ============================================================================
      // Brand Management
      // ============================================================================

      function addBrand() {
        const brandId = ++brandIdCounter;
        brands.push({
          id: brandId,
          brand_id: '',
          name: '',
          domain: '', // Primary domain for this brand
          properties: []
        });
        renderBrands();
        updatePreview();
      }

      function removeBrand(brandId) {
        brands = brands.filter(b => b.id !== brandId);
        renderBrands();
        updatePreview();
      }

      function updateBrand(brandId, field, value) {
        const brand = brands.find(b => b.id === brandId);
        if (brand) {
          brand[field] = value;
          updatePreview();
        }
      }

      function addProperty(brandId) {
        const brand = brands.find(b => b.id === brandId);
        if (brand) {
          brand.properties.push({ type: 'website', identifier: '', primary: false });
          renderBrands();
          updatePreview();
        }
      }

      function removeProperty(brandId, propIndex) {
        const brand = brands.find(b => b.id === brandId);
        if (brand) {
          brand.properties.splice(propIndex, 1);
          renderBrands();
          updatePreview();
        }
      }

      function updateProperty(brandId, propIndex, field, value) {
        const brand = brands.find(b => b.id === brandId);
        if (brand && brand.properties[propIndex]) {
          if (field === 'primary') {
            value = value === 'true' || value === true;
          }
          brand.properties[propIndex][field] = value;
          updatePreview();
        }
      }

      function renderBrands() {
        const container = document.getElementById('brands-container');

        if (brands.length === 0) {
          container.innerHTML = `
            <div style="text-align: center; padding: var(--space-8); color: var(--text-muted); background: var(--color-bg-subtle); border-radius: var(--radius-lg); border: 2px dashed var(--color-border);">
              <p style="margin: 0 0 var(--space-3) 0">No brands added yet</p>
              <button class="btn" onclick="addBrand()">+ Add Brand</button>
            </div>
          `;
          return;
        }

        container.innerHTML = brands.map((brand, index) => `
          <div class="brand-entry">
            <div class="brand-entry-header">
              <h4 style="margin: 0; font-size: var(--text-lg);">Brand ${index + 1}</h4>
              <button class="btn btn-secondary" onclick="removeBrand(${brand.id})" style="padding: var(--space-1) var(--space-3); font-size: var(--text-xs);">Remove</button>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: var(--space-3); margin-bottom: var(--space-4);">
              <div>
                <label style="display: block; margin-bottom: var(--space-1); font-size: var(--text-sm); font-weight: var(--font-medium);">Brand ID</label>
                <input type="text" value="${brand.brand_id}" placeholder="nike" oninput="updateBrand(${brand.id}, 'brand_id', this.value)" />
              </div>
              <div>
                <label style="display: block; margin-bottom: var(--space-1); font-size: var(--text-sm); font-weight: var(--font-medium);">Brand Name</label>
                <input type="text" value="${brand.name}" placeholder="Nike" oninput="updateBrand(${brand.id}, 'name', this.value)" />
              </div>
              <div>
                <label style="display: block; margin-bottom: var(--space-1); font-size: var(--text-sm); font-weight: var(--font-medium);">Brand Domain</label>
                <input type="text" value="${brand.domain || ''}" placeholder="nike.com" oninput="updateBrand(${brand.id}, 'domain', this.value)" />
                <p class="hint" style="font-size: 11px; margin-top: 2px;">Needs redirect file</p>
              </div>
            </div>

            <div>
              <label style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-2); font-size: var(--text-sm); font-weight: var(--font-medium);">
                Other Properties (apps, etc.)
                <button class="btn" onclick="addProperty(${brand.id})" style="padding: var(--space-1) var(--space-2); font-size: var(--text-xs);">+ Add</button>
              </label>
              <div id="properties-${brand.id}">
                ${brand.properties.length === 0 ? `
                  <p style="color: var(--text-muted); font-size: var(--text-sm); margin: 0;">No additional properties</p>
                ` : brand.properties.map((prop, i) => `
                  <div class="property-entry">
                    <select onchange="updateProperty(${brand.id}, ${i}, 'type', this.value)">
                      <option value="website" ${prop.type === 'website' ? 'selected' : ''}>Website</option>
                      <option value="mobile_app" ${prop.type === 'mobile_app' ? 'selected' : ''}>Mobile App</option>
                      <option value="ctv_app" ${prop.type === 'ctv_app' ? 'selected' : ''}>CTV App</option>
                      <option value="desktop_app" ${prop.type === 'desktop_app' ? 'selected' : ''}>Desktop App</option>
                      <option value="dooh" ${prop.type === 'dooh' ? 'selected' : ''}>DOOH</option>
                      <option value="podcast" ${prop.type === 'podcast' ? 'selected' : ''}>Podcast</option>
                    </select>
                    <input type="text" value="${prop.identifier}" placeholder="${prop.type === 'website' ? 'example.com' : 'com.example.app'}" oninput="updateProperty(${brand.id}, ${i}, 'identifier', this.value)" />
                    <button class="btn btn-secondary" onclick="removeProperty(${brand.id}, ${i})" style="padding: var(--space-1) var(--space-2); font-size: var(--text-xs);">√ó</button>
                  </div>
                `).join('')}
              </div>
            </div>
          </div>
        `).join('');

        // Update redirect files list
        updateRedirectFilesList();
      }

      function updateRedirectFilesList() {
        const section = document.getElementById('redirect-files-section');
        const list = document.getElementById('redirect-files-list');
        const houseDomain = document.getElementById('portfolio-house-domain').value.trim();

        // Get all brand domains that need redirects
        const brandDomains = brands
          .filter(b => b.domain && b.domain !== houseDomain)
          .map(b => b.domain);

        if (brandDomains.length === 0) {
          section.classList.add('hidden');
          return;
        }

        section.classList.remove('hidden');
        list.innerHTML = brandDomains.map(domain => `
          <div style="display: flex; align-items: center; gap: var(--space-3); padding: var(--space-2) 0; border-bottom: 1px solid var(--color-border);">
            <code style="flex: 1; font-size: var(--text-sm);">${domain}/.well-known/brand.json</code>
            <button class="btn btn-secondary" onclick="copyRedirectJson('${domain}')" style="padding: var(--space-1) var(--space-3); font-size: var(--text-xs);">Copy JSON</button>
          </div>
        `).join('');
      }

      function copyRedirectJson(domain) {
        const houseDomain = document.getElementById('portfolio-house-domain').value.trim();
        const redirectJson = {
          "$schema": "https://adcontextprotocol.org/schemas/v1/brand.json",
          "house": houseDomain
        };
        navigator.clipboard.writeText(JSON.stringify(redirectJson, null, 2))
          .then(() => alert(`Copied redirect JSON for ${domain}!`))
          .catch(() => alert('Failed to copy'));
      }

      // ============================================================================
      // JSON Generation
      // ============================================================================

      function generateJson() {
        const json = {
          "$schema": "https://adcontextprotocol.org/schemas/v1/brand.json"
        };

        switch (currentVariant) {
          case 'single':
            // Single brand - simplest case
            json.version = "1.0";
            json.house = {
              domain: currentDomain,
              architecture: "branded_house"
            };

            const singleBrandId = document.getElementById('single-brand-id').value.trim();
            const singleBrandName = document.getElementById('single-brand-name').value.trim();

            const singleBrandObj = {
              id: singleBrandId || 'unnamed',
              names: singleBrandName ? [{ en: singleBrandName }] : [],
              keller_type: 'master'
            };

            // Add domain as primary property
            if (currentDomain) {
              singleBrandObj.properties = [{ type: 'website', identifier: currentDomain, primary: true }];
            }

            // Add additional properties
            if (singleBrandProperties.length > 0) {
              if (!singleBrandObj.properties) singleBrandObj.properties = [];
              singleBrandProperties
                .filter(p => p.identifier)
                .forEach(p => {
                  singleBrandObj.properties.push({ type: p.type, identifier: p.identifier });
                });
            }

            json.brands = [singleBrandObj];
            break;

          case 'portfolio':
            // Multi-brand portfolio
            json.version = "1.0";

            const portfolioDomain = document.getElementById('portfolio-house-domain').value.trim();
            const portfolioName = document.getElementById('portfolio-house-name').value.trim();

            json.house = {
              domain: portfolioDomain || currentDomain,
              architecture: "house_of_brands"
            };
            if (portfolioName) json.house.name = portfolioName;

            json.brands = brands
              .filter(b => b.brand_id || b.name)
              .map(brand => {
                const brandObj = {
                  id: brand.brand_id || 'unnamed',
                  names: brand.name ? [{ en: brand.name }] : []
                };

                // Build properties array starting with domain
                const props = [];
                if (brand.domain) {
                  props.push({ type: 'website', identifier: brand.domain, primary: true });
                }
                if (brand.properties && brand.properties.length > 0) {
                  brand.properties
                    .filter(p => p.identifier)
                    .forEach(p => props.push({ type: p.type, identifier: p.identifier }));
                }
                if (props.length > 0) {
                  brandObj.properties = props;
                }

                return brandObj;
              });
            break;

          case 'redirect':
            // Simple redirect to house
            const redirectHouse = document.getElementById('redirect-house-domain').value.trim();
            if (redirectHouse) {
              json.house = redirectHouse;
            }
            break;

          case 'agent':
            // Brand agent reference
            const agentUrl = document.getElementById('agent-url').value.trim();
            const agentId = document.getElementById('agent-id').value.trim();
            if (agentUrl || agentId) {
              json.version = "1.0";
              json.brand_agent = {};
              if (agentUrl) json.brand_agent.url = agentUrl;
              if (agentId) json.brand_agent.id = agentId;
            }
            break;

          case 'hosted':
            // Hosted location redirect
            const hostedUrl = document.getElementById('hosted-url').value.trim();
            if (hostedUrl) {
              json.authoritative_location = hostedUrl;
            }
            break;
        }

        return json;
      }

      function updatePreview() {
        const json = generateJson();
        document.getElementById('json-preview').textContent = JSON.stringify(json, null, 2);
      }

      // ============================================================================
      // Export Functions
      // ============================================================================

      function copyJson() {
        const json = generateJson();
        navigator.clipboard.writeText(JSON.stringify(json, null, 2))
          .then(() => alert('Copied to clipboard!'))
          .catch(() => alert('Failed to copy'));
      }

      function downloadJson() {
        const json = generateJson();
        const blob = new Blob([JSON.stringify(json, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'brand.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      // ============================================================================
      // Initialize
      // ============================================================================

      document.addEventListener('DOMContentLoaded', () => {
        // Check for domain in URL params
        const params = new URLSearchParams(window.location.search);
        const domain = params.get('domain');
        if (domain) {
          document.getElementById('domain-input').value = domain;
          startBuilding();
        }
      });
    </script>
  </body>
</html>
