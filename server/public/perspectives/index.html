<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Perspectives | AgenticAdvertising.org</title>
  <meta name="description" content="Thought leadership on agentic AI, open standards, and the future of advertising. Educational resources from AgenticAdvertising.org.">
  <link rel="icon" href="/AAo.svg" type="image/svg+xml">
  <link rel="stylesheet" href="/design-system.css">
  <style>
    /* Page-specific: nav offset */
    body { padding-top: 60px; }

    /* Page-specific: narrower container for perspectives listing */
    .container { max-width: 1000px; }

    /* Loading and empty states */
    .loading-state,
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--color-text-muted);
    }
    .loading-state {
      font-size: 1.1rem;
    }
    .empty-state h2 {
      color: var(--color-text-heading);
      margin-bottom: 0.5rem;
    }

    /* Filter bar styling */
    .filter-bar {
      margin-bottom: var(--space-8);
      padding: var(--space-4) 0;
    }
    .filter-bar select {
      padding: var(--space-3) var(--space-4);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-lg);
      font-size: var(--text-sm);
      background: var(--color-bg-card);
      color: var(--color-text-heading);
      cursor: pointer;
      min-width: 180px;
    }
    .filter-bar select:focus {
      outline: none;
      border-color: var(--color-brand);
      box-shadow: 0 0 0 3px var(--color-primary-100);
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <div id="adcp-nav"></div>
  <script src="/nav.js"></script>

  <!-- Hero Section -->
  <section class="hero hero--article">
    <div class="hero-container">
      <h1>Perspectives</h1>
      <p class="hero-subtitle">Thought leadership on agentic AI and the future of advertising</p>
    </div>
  </section>

  <!-- Main Content -->
  <div class="container">
    <div id="perspectivesLoading" class="loading-state">
      Loading perspectives...
    </div>
    <div id="perspectivesEmpty" class="empty-state" style="display: none;">
      <h2>No perspectives yet</h2>
      <p>Check back soon for thought leadership content.</p>
    </div>
    <div id="filterBar" class="filter-bar" style="display: none;">
      <select id="categoryFilter" onchange="filterPerspectives()">
        <option value="">All Categories</option>
        <!-- Categories populated dynamically -->
      </select>
    </div>
    <div id="articlesGrid" class="articles-grid" style="display: none;">
      <!-- Perspectives will be loaded here dynamically -->
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer footer--centered">
    <div class="footer-links">
      <a href="/">Home</a>
      <a href="https://docs.adcontextprotocol.org">AdCP Documentation</a>
      <a href="/members">Members</a>
      <a href="https://github.com/adcontextprotocol/adcp">GitHub</a>
      <a href="https://join.slack.com/t/agenticads/shared_invite/zt-3h15gj6c0-FRTrD_y4HqmeXDKBl2TDEA">Slack Community</a>
    </div>
    <div class="footer-copyright">
      &copy; 2025 AgenticAdvertising.org
    </div>
  </footer>

  <script>
    let allPerspectives = [];

    async function loadPerspectives() {
      const loadingEl = document.getElementById('perspectivesLoading');
      const emptyEl = document.getElementById('perspectivesEmpty');
      const gridEl = document.getElementById('articlesGrid');
      const filterBar = document.getElementById('filterBar');

      try {
        const response = await fetch('/api/perspectives');
        if (!response.ok) {
          throw new Error('Failed to load perspectives');
        }

        allPerspectives = await response.json();

        if (allPerspectives.length === 0) {
          loadingEl.style.display = 'none';
          emptyEl.style.display = 'block';
          return;
        }

        // Populate category filter
        populateCategoryFilter(allPerspectives);

        // Render perspectives
        renderPerspectives(allPerspectives);

        loadingEl.style.display = 'none';
        filterBar.style.display = 'flex';
        gridEl.style.display = 'grid';

      } catch (error) {
        console.error('Error loading perspectives:', error);
        loadingEl.innerHTML = '<p style="color: var(--color-error-600);">Failed to load perspectives. Please refresh the page.</p>';
      }
    }

    function populateCategoryFilter(perspectives) {
      const select = document.getElementById('categoryFilter');
      const categories = new Set();

      perspectives.forEach(p => {
        if (p.category) categories.add(p.category);
      });

      // Sort and add options
      Array.from(categories).sort().forEach(cat => {
        const option = document.createElement('option');
        option.value = cat;
        option.textContent = cat;
        select.appendChild(option);
      });
    }

    function filterPerspectives() {
      const category = document.getElementById('categoryFilter').value;

      let filtered = allPerspectives;
      if (category) {
        filtered = allPerspectives.filter(p => p.category === category);
      }

      renderPerspectives(filtered);
    }

    function renderPerspectives(perspectives) {
      const gridEl = document.getElementById('articlesGrid');

      if (perspectives.length === 0) {
        gridEl.innerHTML = '<div class="empty-state"><p>No perspectives match the selected filter.</p></div>';
        return;
      }

      let html = '';
      perspectives.forEach(perspective => {
        const isExternal = perspective.content_type === 'link';
        const href = isExternal ? perspective.external_url : `/perspectives/${perspective.slug}`;
        const target = isExternal ? ' target="_blank" rel="noopener"' : '';
        const readMoreText = isExternal
          ? `Read on ${perspective.external_site_name || 'external site'}`
          : 'Read article';

        // Format date and check if new (within 14 days)
        const dateInfo = formatDate(perspective.published_at);
        const isNew = isWithin14Days(perspective.published_at);

        html += `
          <a href="${escapeHtml(href)}" class="article-card"${target}>
            <div class="article-card-content">
              <div class="article-meta">
                ${perspective.category ? `<span class="article-category">${escapeHtml(perspective.category)}</span>` : ''}
                ${isNew ? '<span class="article-badge-new">New</span>' : ''}
              </div>
              <h2>${escapeHtml(perspective.title)}</h2>
              <p>${escapeHtml(perspective.excerpt || perspective.subtitle || '')}</p>
              ${dateInfo ? `<span class="article-date">${dateInfo}</span>` : ''}
            </div>
            <div class="article-card-footer">
              <span class="read-more">
                ${readMoreText}
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span>
            </div>
          </a>
        `;
      });

      gridEl.innerHTML = html;
    }

    function formatDate(dateStr) {
      if (!dateStr) return null;
      const date = new Date(dateStr);
      if (isNaN(date.getTime())) return null;
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    }

    function isWithin14Days(dateStr) {
      if (!dateStr) return false;
      const date = new Date(dateStr);
      if (isNaN(date.getTime())) return false;
      const now = new Date();
      const diffTime = now - date;
      const diffDays = diffTime / (1000 * 60 * 60 * 24);
      return diffDays <= 14 && diffDays >= 0;
    }

    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Load perspectives when page loads
    loadPerspectives();
  </script>
</body>
</html>
