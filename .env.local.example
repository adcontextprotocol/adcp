# AdCP Registry - Environment Configuration Template
# Copy this file to .env.local and fill in your values

# ============================================================================
# SERVER CONFIGURATION
# ============================================================================

# Server port (default: 3000)
# Note: In Conductor workspaces, CONDUCTOR_PORT is automatically assigned during setup
# and overrides this value. Mintlify docs use CONDUCTOR_PORT + 1.
PORT=3000
# CONDUCTOR_PORT=<auto-assigned-port>

# Environment: development | production
NODE_ENV=development

# Server mode: http | mcp (stdio)
MODE=http

# Log level: trace | debug | info | warn | error | fatal
# Default: debug in development, info in production
LOG_LEVEL=debug

# ============================================================================
# DATABASE CONFIGURATION (Required)
# ============================================================================

# PostgreSQL connection string (REQUIRED)
# Format: postgresql://username:password@host:port/database
# Note: Port is automatically assigned by Docker and written to .env.local during setup
# Example for local development:
DATABASE_URL=postgresql://adcp:localdev@localhost:<auto-assigned-port>/adcp_registry

# Enable SSL for database connection (default: false)
DATABASE_SSL=false

# Verify SSL certificates when SSL is enabled (default: true)
DATABASE_SSL_REJECT_UNAUTHORIZED=true

# Connection pool configuration
DATABASE_MAX_POOL_SIZE=20
DATABASE_IDLE_TIMEOUT_MS=30000
DATABASE_CONNECTION_TIMEOUT_MS=5000

# ============================================================================
# AUTHENTICATION - WorkOS (Required for Registry Features)
# ============================================================================

# WorkOS API Key (REQUIRED)
# Get this from: https://dashboard.workos.com/api-keys
# Format: sk_live_... or sk_test_...
WORKOS_API_KEY=sk_test_your_api_key_here

# WorkOS Client ID (REQUIRED)
# Get this from: https://dashboard.workos.com/configuration
# Format: client_...
WORKOS_CLIENT_ID=client_your_client_id_here

# Session encryption secret (REQUIRED, min 32 characters)
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
WORKOS_COOKIE_PASSWORD=generate_a_random_32_character_secret_here

# OAuth callback URL (default: http://localhost:3000/auth/callback)
# Update this for production to use https:// and your domain
WORKOS_REDIRECT_URI=http://localhost:3000/auth/callback

# Admin access control (comma-separated list of email addresses)
# Users with these emails will have access to /admin/* endpoints
# ADMIN_EMAILS=admin@example.com,owner@example.com

# ============================================================================
# BILLING - Stripe (Optional, required for subscriptions)
# ============================================================================

# Stripe Secret Key
# Get this from: https://dashboard.stripe.com/apikeys
# Format: sk_test_... or sk_live_...
# STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key

# Stripe Publishable Key
# Format: pk_test_... or pk_live_...
# STRIPE_PUBLISHABLE_KEY=pk_test_your_stripe_publishable_key

# Stripe Pricing Table ID (for embedded pricing table)
# Get this from: https://dashboard.stripe.com/pricing-tables
# Format: prctbl_...
# STRIPE_PRICING_TABLE_ID=prctbl_your_pricing_table_id

# Stripe Webhook Secret (for webhook signature verification)
# Get this from: https://dashboard.stripe.com/webhooks
# Format: whsec_...
# STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret

# ============================================================================
# ANALYTICS - Metabase (Optional, required for embedded dashboards)
# ============================================================================

# Metabase Secret Key (REQUIRED for analytics)
# Get this from: Metabase Admin → Settings → Embedding → Secret Key
# Used for signing JWT tokens for embedded dashboards
# METABASE_SECRET_KEY=your_metabase_secret_key_here

# Metabase Site URL (default: http://localhost:3001)
# The URL where Metabase is hosted
# Production: Use your Metabase cloud URL or self-hosted URL with HTTPS
# METABASE_SITE_URL=https://metabase.yourdomain.com

# Metabase Dashboard ID (REQUIRED for analytics)
# The ID of the dashboard to embed in /admin/analytics
# Get this from the Metabase dashboard URL (e.g., /dashboard/2 → ID is 2)
# METABASE_DASHBOARD_ID=2

# ============================================================================
# PRODUCTION DEPLOYMENT NOTES
# ============================================================================
#
# 1. HTTPS is REQUIRED in production for secure cookie transmission
#    - Set NODE_ENV=production to enable secure cookies
#    - Use a reverse proxy (nginx, Caddy, cloud load balancer) for TLS
#    - Update WORKOS_REDIRECT_URI to use https://
#
# 2. Generate strong secrets for production:
#    - WORKOS_COOKIE_PASSWORD: min 32 characters, cryptographically random
#    - Never commit real secrets to version control
#
# 3. Database:
#    - Use SSL in production (DATABASE_SSL=true)
#    - Ensure DATABASE_URL uses strong password
#    - Consider connection pooling with PgBouncer for high traffic
#
# 4. Stripe keys:
#    - Use live keys (sk_live_..., pk_live_...) in production
#    - Configure webhook endpoint in Stripe dashboard
#    - Test webhooks with Stripe CLI before deploying
#
# 5. Monitoring:
#    - Set LOG_LEVEL=info in production
#    - Configure log aggregation (CloudWatch, Datadog, etc.)
#    - Monitor DATABASE_MAX_POOL_SIZE and adjust if needed
#
# 6. Metabase Analytics (if using):
#    - Deploy Metabase separately (Metabase Cloud or self-hosted container)
#    - Configure Metabase to connect to production database (read-only user recommended)
#    - Set METABASE_SITE_URL to your Metabase URL (HTTPS required)
#    - Generate and set METABASE_SECRET_KEY from Metabase embedding settings
#    - Create dashboard, enable embedding, and set METABASE_DASHBOARD_ID
#    - Never expose Metabase admin interface publicly without authentication
#
